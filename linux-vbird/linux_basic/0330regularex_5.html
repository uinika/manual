<html><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf8">
	<meta name="Author" content="2011/04/18,lee">
	<meta name="Description" content="介绍正规表示法的应用与相关技巧">
	<title>鸟哥的 Linux 私房菜 -- 正规表示法 (regular expression, RE) 与文件格式化处理</title>
    <script src="../script/SpryMenuBar.js" type="text/javascript"></script>
	<script src="../script/index.js" type="text/javascript"></script>
	<link href="../css/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
    <link href="../css/main.css" rel="stylesheet" type="text/css" />
    </head><body style="margin: 0pt; padding: 0pt;" class="table"onload="MM_preloadImages('../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html')">

<center>
<div id="apDiv5">
<div> <LINK REL="SHORTCUT ICON" HREF="../index-2.html">
<!-- ImageReady Slices (title3.ai) -->
<table id="___01" width="898" height="81" border="0" align="center" cellpadding="0" cellspacing="0";>
	<tr>
		<td colspan="15">
			<img src="image/title/title_01.png" width="900" height="1" alt=""></td>
	</tr>
	<tr>
		<td rowspan="4" bgcolor="#182448"><p><img src="http://linux.vbird.org/cgi-bin/Count.cgi?dd=C&amp;ft=5&amp;sh=T&amp;md=8&amp;pad=Y&amp;df=vbird.dic.ksu.edu.tw.dat" width="93" align="left" title="計數器" /></p>
	    <p><font color="#FFFFFF" size="-1">since2012/04/23</font></p></td>
		<td rowspan="4" align="left" valign="top"><a href="../index.html"><img src="image/title/title_03.png" alt="" width="263" height="79" border="0"></a></td>
		<td colspan="13">
			<img src="image/title/title_04.png" alt="" width="535" height="9" border="0"></td>
	</tr>
	<tr>
		<td rowspan="3">
			<img src="image/title/title_05.png" alt="" width="53" height="70" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="0110whatislinux.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image51','','image/title/title_06.png',1)"><img src="image/title/title3_06.png" name="Image51" width="106" height="25" border="0" id="Image51" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_07.png" alt="" width="27" height="37" border="0"></td>
		<td colspan="3" align="left" valign="top"><a href="../linux_server/0110network_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image52','','image/title/title_08.png',1)"><img src="image/title/title3_08.png" name="Image52" width="107" height="25" border="0" id="Image52" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_09.png" alt="" width="37" height="37" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../about.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image53','','image/title/title_10.png',1)"><img src="image/title/title3_10.png" name="Image53" width="75" height="25" border="0" id="Image53" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_11.png" alt="" width="35" height="70" border="0"></td>
		<td align="left" valign="top"><a href="mailto:vbird@mail.vbird.idv.tw" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image54','','image/title/title_12.png',1)"><img src="image/title/title3_12.png" name="Image54" width="74" height="25" border="0" id="Image54" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_13.png" alt="" width="21" height="70" border="0"></td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="image/title/title_14.png" alt="" width="106" height="12" border="0"></td>
		<td colspan="3">
			<img src="image/title/title_15.png" alt="" width="107" height="12" border="0"></td>
		<td colspan="2">
			<img src="image/title/title_16.png" width="75" height="12" alt=""></td>
		<td rowspan="2">
			<img src="image/title/title_17.png" alt="" width="74" height="45" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/title_18.png" alt="" width="15" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar1" class="MenuBarHorizontal">
	  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image44','','image/title/title_19.png',1)"><img src="image/title/title3_19.png" name="Image44" width="123" height="33" border="0" id="Image44" /></a>
			    <ul>
			      <li><a href="Mandrake9.0/mandrake9.0.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image46','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image46" width="120" height="26" border="0" id="Image46" alt="" /></a></li>
                  <li><a href="fedora_4/fc4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image47','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image47" width="120" height="26" border="0" id="Image47" alt="" /></a></li>
                  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image48','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image48" width="120" height="26" border="0" id="Image48" alt="" /></a></li>
                </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_20.png" alt="" width="42" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar2" class="MenuBarHorizontal">
	  <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image45','','image/title/title_21.png',1)"><img src="image/title/title3_21.png" name="Image45" width="125" height="33" border="0" id="Image45" /></a>
			    <ul>
			      <li><a href="../linux_server/linux_redhat9/redhat9.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image43','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image43" width="120" height="26" border="0" id="Image43" alt=""/></a></li>
			      <li><a href="../linux_server/centos4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image49','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image49" width="120" height="26" border="0" id="Image49" alt="" /></a></li>
			      <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image50','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image50" width="120" height="26" border="0" id="Image50" alt="" /></a></li>
		        </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_22.png" alt="" width="47" height="33" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/Spacer.gif" width="101" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="263" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="53" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="15" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="91" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="27" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="5" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="42" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="60" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="37" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="28" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="47" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="35" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="74" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="22" height="1" alt=""></td>
	</tr>
</table>
<!-- End ImageReady Slices -->
<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</div>
<table summary="本文内容的排版" style="width: 898px;" border="0" cellpadding="0" cellspacing="0">
<tbody><tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
<tr><td style="width: 16px; font-size: 6px;">　</td>
    <td width="866">

<!-- 本文的档头部分 -->
<div style="text-align: center;">
    <a href="0330regularex.html">
    <span class="text_head0">第十二章、正规表示法与文件格式化处理</span></a><br>
</div>
    <div style="text-align: right;">
        <span class="text_history">最近升级日期：2009/08/26</span>
    </div>
<!-- 本文的连结区部分 -->
<div class="block1">
<span class="text_h1">
5. <a href="#hint">重点回顾</a><br>
6. <a href="#ex">本章习题</a><br>
7. <a href="#reference">参考数据与延伸阅读</a><br>
<span class="text_h2">
8. <a href="http://phorum.vbird.org/viewtopic.php?t=23885" target="_blank">针对本文的建议：http://phorum.vbird.org/viewtopic.php?t=23885</a>
</span>
</span></div>
<!-- 本文的正式部分 -->
<hr><a name="hint"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">重点回顾</span><br>
<div class="block1">
<ul class="text_import2">
	<li>正规表示法就是处理字串的方法，他是以行为单位来进行字串的处理行为；</li>
	<li>正规表示法透过一些特殊符号的辅助，可以让使用者轻易的达到『搜寻/删除/取代』某特定字串的处理程序；</li>
	<li>只要工具程序支持正规表示法，那么该工具程序就可以用来作为正规表示法的字串处理之用；</li>
	<li>正规表示法与万用字节是完全不一样的东西！万用字节 (wildcard) 代表的是 bash 操作介面的一个功能，
		但正规表示法则是一种字串处理的表示方式！</li>
	<li>使用 grep 或其他工具进行正规表示法的字串比对时，因为编码的问题会有不同的状态，因此，
 		你最好将 LANG 等变量配置为 C 或者是 en 等英文语系！</li>
	<li>grep 与 egrep 在正规表示法里面是很常见的两支程序，其中， egrep 支持更严谨的正规表示法的语法；</li>
	<li>由於编码系统的不同，不同的语系 (LANG) 会造成正规表示法撷取数据的差异。因此可利用特殊符号如 [:upper:] 
		来替代编码范围较佳；</li>
	<li>由於严谨度的不同，正规表示法之上还有更严谨的延伸正规表示法；</li>
	<li>基础正规表示法的特殊字符有： *, ?, [], [-], [^], ^, $ 等！</li>
	<li>常见的正规表示法工具有： grep , sed, vim 等等</li>
	<li>printf 可以透过一些特殊符号来将数据进行格式化输出；</li>
	<li>awk 可以使用『栏位』为依据，进行数据的重新整理与输出；</li>
	<li>文件的比对中，可利用 diff 及 cmp 进行比对，其中 diff 主要用在纯文字文件方面的新旧版本比对</li>
	<li>patch 命令可以将旧版数据升级到新版 (主要亦由 diff 创建 patch 的补丁来源文件)</li>
</ul>
</div>


<hr><a name="ex"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">本章习题</span><br>
( 要看答案请将鼠标移动到『答：』底下的空白处，按下左键圈选空白处即可察看 )
<div class="block1">
<ul>
	<li>情境模拟题一：透过 grep 搜寻特殊字串，并配合数据流重导向来处理大量的文件搜寻问题。<br><br>
	<ul>
		<li>目标：正确的使用正规表示法；</li>
		<li>前提：需要了解数据流重导向，以及透过子命令 $(command) 来处理档名的搜寻；</li>
	</ul><br>

	我们简单的以搜寻星号 (*) 来处理底下的任务：<br><br>

	<ol style="padding-left: 0px;">
	<li>利用正规表示法找出系统中含有某些特殊关键字的文件，举例来说，找出在 /etc 底下含有星号 (*) 的文件与内容：<br><br>
	解决的方法必须要搭配万用字节，但是星号本身就是正规表示法的字符，因此需要如此进行：

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">grep '\*' /etc/*</span>
</pre></td></tr></tbody></table>

	你必须要注意的是，在单引号内的星号是正规表示法的字符，但我们要找的是星号，因此需要加上跳脱字符 (\)。但是在 
	/etc/* 的那个 * 则是 bash  的万用字节！
	代表的是文件的档名喔！不过由上述的这个结果中，我们仅能找到 /etc 底下第一层子目录的数据，无法找到次目录的数据，
	如果想要连同完整的 /etc 次目录数据，就得要这样做：

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">grep '\*' $(find /etc -type f)</span>
</pre></td></tr></tbody></table><br></li>

	<li>但如果文件数量太多呢？如同上述的案例，如果要找的是全系统 (/) 呢？你可以这样做：

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">grep '\*' $(find / -type f)</span>
-bash: /bin/grep: Argument list too long
</pre></td></tr></tbody></table>

	真要命！由於命令列的内容长度是有限制的，因此当搜寻的对象是整个系统时，上述的命令会发生错误。那该如何是好？
	此时我们可以透过管线命令以及 xargs 来处理。举例来说，让 grep 每次仅能处理 10 个档名，此时你可以这样想：<br><br>
	<ol type="a">
		<li>先用 find 去找出文件；</li>
		<li>用 xargs 将这些文件每次丢 10 个给 grep 来作为参数处理；</li>
		<li>grep 实际开始搜寻文件内容。</li>
	</ol><br>
	所以整个作法就会变成这样：

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">find / -type f | xargs -n 10 grep '\*'</span>
</pre></td></tr></tbody></table><br></li>

	<li>从输出的结果来看，数据量实在非常庞大！那如果我只是想要知道档名而已呢？你可以透过 grep 的功能来找到如下的参数！

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">find / -type f | xargs -n 10 grep -l '\*'</span>
</pre></td></tr></tbody></table><br></li>
	</ol></li>

	<li>情境模拟题二：使用管线命令配合正规表示法创建新命令与新变量。我想要创建一个新的命令名为 myip ，
	这个命令能够将我系统的 IP 捉出来显示。而我想要有个新变量，变量名为 MYIP ，这个变量可以记录我的 IP 。<br><br>

	处理的方式很简单，我们可以这样试看看：<br><br>

	<ol style="padding-left: 0px;">
		<li>首先，我们依据本章内的 ifconfig, sed 与 awk 来取得我们的 IP ，命令为：<br>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">ifconfig eth0 | grep 'inet addr' | \</span>
&gt;  <span class="term_command">sed 's/^.*inet addr://g'| cut -d ' ' -f1</span>
</pre></td></tr></tbody></table></li>

		<li>再来，我们可以将此命令利用 alias 指定为 myip 喔！如下所示：

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">alias myip="ifconfig eth0 | grep 'inet addr' | \</span>
&gt;  <span class="term_command">sed 's/^.*inet addr://g'| cut -d ' ' -f1 "</span>
</pre></td></tr></tbody></table></li>

		<li>最终，我们可以透过变量配置来处理 MYIP 喔！

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">MYIP=$( myip )</span>
</pre></td></tr></tbody></table></li>

		<li>如果每次登陆都要生效，可以将 alias 与 MYIP 的配置那两行，写入你的 ~/.bashrc 即可！</li>
	</ol></li>
</ul><br>

<hr>简答题部分：
<ul>
	<li>我想要知道，在 /etc 底下，只要含有 XYZ 三个字节的任何一个字节的那一行就列出来，要怎样进行？
	<div class="blockex">
		grep [XYZ] /etc/*
	</div></li>

	<li>将 /etc/termcap 内容取出后，(1)去除开头为 # 的行 (2)去除空白行 (3)取出开头为英文字母的那几行 (4)最终统计总行数该如何进行？
	<div class="blockex">
		grep -v '^#' /etc/termcap | grep -v '^$' | grep '^[[:alpha:]]' | wc -l
	</div></li>
</ul>
</div>


<hr><a name="reference"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">参考数据与延伸阅读</span><br>
<div class="block1">
<ul>
	<li><a name="ps1"></a>注1：关於正规表示法与 POSIX 及特殊语法的参考网址可以查询底下的来源：<br>
		维基百科的说明：<a href="http://en.wikipedia.org/wiki/Regular_expression" target="_blank">http://en.wikipedia.org/wiki/Regular_expression</a><br>
		ZYTRAX 网站介绍：<a href="http://zytrax.com/tech/web/regex.htm" target="_blank">http://zytrax.com/tech/web/regex.htm</a><br></li>
	<li><a name="ps2"></a>注2：其他关於正规表示法的网站介绍：<br>
		洪朝贵老师的网页：<a href="http://www.cyut.edu.tw/~ckhung/b/re/index.php" target="_blank">http://www.cyut.edu.tw/~ckhung/b/re/index.php</a><br>
		龙门少尉的窝：<a href="http://main.rtfiber.com.tw/~changyj/" target="_blank">http://main.rtfiber.com.tw/~changyj/</a><br>
		PCRE 官方网站：<a href="http://perldoc.perl.org/perlre.html" target="_blank">http://perldoc.perl.org/perlre.html</a><br></li>
	<li><a name="ps3"></a>注3：关於 ASCII 编码对照表可参考维基百科的介绍：<br>
		维基百科 (ASCII) 条目： <a href="http://zh.wikipedia.org/w/index.php?title=ASCII&amp;variant=zh-tw" target="_blank">http://zh.wikipedia.org/w/index.php?title=ASCII&amp;variant=zh-tw</a></li>
	<li><a name="ps4"></a>注4：关於 awk 的进阶文献，包括有底下几个连结：<br>
		中研院计算中心 ASPAC 计画之 awk 程序介绍：<a href="http://phi.sinica.edu.tw/aspac/reports/94/94011/" target="_blank">http://phi.sinica.edu.tw/aspac/reports/94/94011/</a><br>
		鸟哥备份：<a href="../index-2.html" target="_blank">http://cn.linux.vbird.org/linux_basic/0330regularex/awk.pdf</a><br>
		这份文件写的非常棒！欢迎大家多多参考！<br>
		Study Area：<a href="http://www.study-area.org/linux/system/linux_shell.htm" target="_blank">http://www.study-area.org/linux/system/linux_shell.htm</a></li>
</ul>
</div>
<hr />
    </td>
    <td style="width: 16px; font-size: 6px;">　</td></tr>
<tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
</tbody></table>

<div style="padding-top: 0px; text-align: center;">
<span style="font-size: 80%;">
	<a href="http://linux.vbird.org/" target="_top" title="前往鸟哥的首页">http://linux.vbird.org</a>
	is designed by <a href="mailto:vbird@mail.vbird.idv.tw" title="联络鸟哥(我不要广告信！)">VBird</a>
		during 2001-2011. <a href="http://www.ksu.edu.tw/" target="_blank">ksu.edu</a></span>
         ﻿<div id="apDiv4">
      <p>本网页主要以Firefox配合解析度 1024x768 作为设计依据&nbsp;&nbsp;&nbsp;&nbsp; 鸟哥自由软件整合应用研究室</p></div></div>
</div>
</center>
</body></html>
