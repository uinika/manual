<html><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="Author" content="2010/04/16,white">
	<meta name="Description" content="说明在 Linux 底下处理文件与目录的相关命令啊～^_^">
	<title>鸟哥的 Linux 私房菜 -- 文件与目录管理</title>
    <script src="../script/SpryMenuBar.js" type="text/javascript"></script>
	<script src="../script/index.js" type="text/javascript"></script>
	<link href="../css/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
    <link href="../css/main.css" rel="stylesheet" type="text/css" />
    </head><body style="margin: 0pt; padding: 0pt;" class="table"onload="MM_preloadImages('../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html')">

<center>
<div id="apDiv5">
<div> <LINK REL="SHORTCUT ICON" HREF="../index-2.html">
<!-- ImageReady Slices (title3.ai) -->
<table id="___01" width="898" height="81" border="0" align="center" cellpadding="0" cellspacing="0";>
	<tr>
		<td colspan="15">
			<img src="image/title/title_01.png" width="900" height="1" alt=""></td>
	</tr>
	<tr>
		<td rowspan="4" bgcolor="#182448"><p><img src="http://linux.vbird.org/cgi-bin/Count.cgi?dd=C&amp;ft=5&amp;sh=T&amp;md=8&amp;pad=Y&amp;df=vbird.dic.ksu.edu.tw.dat" width="93" align="left" title="計數器" /></p>
	    <p><font color="#FFFFFF" size="-1">since2012/04/23</font></p></td>
		<td rowspan="4" align="left" valign="top"><a href="../index.html"><img src="image/title/title_03.png" alt="" width="263" height="79" border="0"></a></td>
		<td colspan="13">
			<img src="image/title/title_04.png" alt="" width="535" height="9" border="0"></td>
	</tr>
	<tr>
		<td rowspan="3">
			<img src="image/title/title_05.png" alt="" width="53" height="70" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="0110whatislinux.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image51','','image/title/title_06.png',1)"><img src="image/title/title3_06.png" name="Image51" width="106" height="25" border="0" id="Image51" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_07.png" alt="" width="27" height="37" border="0"></td>
		<td colspan="3" align="left" valign="top"><a href="../linux_server/0110network_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image52','','image/title/title_08.png',1)"><img src="image/title/title3_08.png" name="Image52" width="107" height="25" border="0" id="Image52" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_09.png" alt="" width="37" height="37" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../about.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image53','','image/title/title_10.png',1)"><img src="image/title/title3_10.png" name="Image53" width="75" height="25" border="0" id="Image53" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_11.png" alt="" width="35" height="70" border="0"></td>
		<td align="left" valign="top"><a href="mailto:vbird@mail.vbird.idv.tw" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image54','','image/title/title_12.png',1)"><img src="image/title/title3_12.png" name="Image54" width="74" height="25" border="0" id="Image54" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_13.png" alt="" width="21" height="70" border="0"></td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="image/title/title_14.png" alt="" width="106" height="12" border="0"></td>
		<td colspan="3">
			<img src="image/title/title_15.png" alt="" width="107" height="12" border="0"></td>
		<td colspan="2">
			<img src="image/title/title_16.png" width="75" height="12" alt=""></td>
		<td rowspan="2">
			<img src="image/title/title_17.png" alt="" width="74" height="45" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/title_18.png" alt="" width="15" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar1" class="MenuBarHorizontal">
	  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image44','','image/title/title_19.png',1)"><img src="image/title/title3_19.png" name="Image44" width="123" height="33" border="0" id="Image44" /></a>
			    <ul>
			      <li><a href="Mandrake9.0/mandrake9.0.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image46','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image46" width="120" height="26" border="0" id="Image46" alt="" /></a></li>
                  <li><a href="fedora_4/fc4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image47','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image47" width="120" height="26" border="0" id="Image47" alt="" /></a></li>
                  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image48','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image48" width="120" height="26" border="0" id="Image48" alt="" /></a></li>
                </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_20.png" alt="" width="42" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar2" class="MenuBarHorizontal">
	  <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image45','','image/title/title_21.png',1)"><img src="image/title/title3_21.png" name="Image45" width="125" height="33" border="0" id="Image45" /></a>
			    <ul>
			      <li><a href="../linux_server/linux_redhat9/redhat9.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image43','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image43" width="120" height="26" border="0" id="Image43" alt=""/></a></li>
			      <li><a href="../linux_server/centos4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image49','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image49" width="120" height="26" border="0" id="Image49" alt="" /></a></li>
			      <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image50','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image50" width="120" height="26" border="0" id="Image50" alt="" /></a></li>
		        </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_22.png" alt="" width="47" height="33" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/Spacer.gif" width="101" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="263" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="53" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="15" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="91" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="27" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="5" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="42" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="60" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="37" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="28" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="47" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="35" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="74" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="22" height="1" alt=""></td>
	</tr>
</table>
<!-- End ImageReady Slices -->
<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</div>
<table summary="本文内容的排版" style="width: 898px;" border="0" cellpadding="0" cellspacing="0">
<tbody><tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
<tr><td style="width: 16px; font-size: 6px;">　</td>
    <td width="866">
<!-- 本文的档头部分 -->
<div style="text-align: center;">
    <a href="0220filemanager.html">
    <span class="text_head0">第七章、<span class="text_head_en">Linux </span>文件与目录管理</span></a><br>
</div>
    <div style="text-align: right;">
        <span class="text_history">最近升级日期：2009/08/26</span>
    </div>

<!-- 本文的连结区部分 -->
<div class="block1">
<span class="text_h1">
7. <a href="#hint">重点回顾</a><br>
8. <a href="#ex">本章习题</a><br>
9. <a href="#reference">参考数据与延伸阅读</a><br>
<span class="text_h2">
10. <a href="http://phorum.vbird.org/viewtopic.php?t=23879" target="_blank">针对本文的建议：http://phorum.vbird.org/viewtopic.php?t=23879</a>
</span>
</span></div>
<!-- 本文的正式部分 -->
<hr><a name="hint"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">重点回顾</span><br>
<div class="block1">
<ul class="text_import2">
	<li>绝对路径：『一定由根目录 / 写起』；相对路径：『不是由 / 写起』</li>
	<li>特殊目录有：., .., -, ~, ~account需要注意；</li>
	<li>与目录相关的命令有：cd, mkdir, rmdir, pwd 等重要命令；</li>
	<li>rmdir 仅能删除空目录，要删除非空目录需使用『 rm -r 』命令；</li>
	<li>使用者能使用的命令是依据 PATH 变量所规定的目录去搜寻的；</li>
	<li>不同的身份(root 与一般用户)系统默认的 PATH 并不相同。差异较大的地方在於 /sbin, /usr/sbin ；</li>
	<li>ls 可以检视文件的属性，尤其 -d, -a, -l 等选项特别重要！</li>
	<li>文件的复制、删除、移动可以分别使用：cp, rm , mv等命令来操作；</li>
	<li>检查文件的内容(读档)可使用的命令包括有：cat, tac, nl, more, less, head, tail, od 等</li>
	<li>cat -n 与 nl 均可显示行号，但默认的情况下，空白行会不会编号并不相同；</li>
	<li>touch 的目的在修改文件的时间参数，但亦可用来创建空文件；</li>
	<li>一个文件记录的时间参数有三种，分别是 access time(atime), status time (ctime), 
		modification time(mtime)，ls 默认显示的是 mtime。</li>
	<li>除了传统的rwx权限之外，在Ext2/Ext3文件系统中，还可以使用chattr与lsattr配置及观察隐藏属性。
		常见的包括只能新增数据的 +a 与完全不能更动文件的 +i 属性。</li>
	<li>新建文件/目录时，新文件的默认权限使用 umask 来规范。默认目录完全权限为drwxrwxrwx，
		文件则为-rw-rw-rw-。</li>
	<li>文件具有SUID的特殊权限时，代表当使用者运行此一binary程序时，在运行过程中使用者会暂时具有程序拥有者的权限</li>
	<li>目录具有SGID的特殊权限时，代表使用者在这个目录底下新建的文件之群组都会与该目录的群组名称相同。</li>
	<li>目录具有SBIT的特殊权限时，代表在该目录下使用者创建的文件只有自己与root能够删除！</li>
	<li>观察文件的类型可以使用 file 命令来观察；</li>
	<li>搜寻命令的完整档名可用 which 或 type ，这两个命令都是透过 PATH 变量来搜寻档名；</li>
	<li>搜寻文件的完整档名可以使用 whereis 或 locate  到数据库文件去搜寻，而不实际搜寻文件系统；</li>
	<li>利用 find 可以加入许多选项来直接查询文件系统，以获得自己想要知道的档名。</li>
</ul>
</div>


<hr><a name="ex"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">本章习题：</span><br>
( 要看答案请将鼠标移动到『答：』底下的空白处，按下左键圈选空白处即可察看 )
<div class="block1">
<a name="situation1"></a><hr>
情境模拟题一：假设系统中有两个帐号，分别是 alex 与 arod ，这两个人除了自己群组之外还共同支持一个名为 project 
的群组。假设这两个用户需要共同拥有 /srv/ahome/ 目录的开发权，且该目录不许其他人进入查阅。
请问该目录的权限配置应为何？请先以传统权限说明，再以 SGID 的功能解析。<br>
<ul>
	<li>目标：了解到为何专案开发时，目录最好需要配置 SGID 的权限！</li>
	<li>前提：多个帐号支持同一群组，且共同拥有目录的使用权！</li>
	<li>需求：需要使用 root 的身份来进行 chmod, chgrp 等帮用户配置好他们的开发环境才行！
	这也是管理员的重要任务之一！</li>

</ul>
	首先我们得要先制作出这两个帐号的相关数据，帐号/群组的管理在后续我们会介绍，
	您这里先照著底下的命令来制作即可：<br>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">groupadd project       </span> <span class="term_note">&lt;==添加新的群组</span>
[root@www ~]# <span class="term_command">useradd -G project alex</span> <span class="term_note">&lt;==创建 alex 帐号，且支持 project</span>
[root@www ~]# <span class="term_command">useradd -G project arod</span> <span class="term_note">&lt;==创建 arod 帐号，且支持 project</span>
[root@www ~]# <span class="term_command">id alex                </span> <span class="term_note">&lt;==查阅 alex 帐号的属性</span>
uid=501(alex) gid=502(alex) groups=502(alex),<span class="term_write">501(project)</span> <span class="term_note">&lt;==确实有支持！</span>
[root@www ~]# <span class="term_command">id arod</span>
uid=502(arod) gid=503(arod) groups=503(arod),<span class="term_write">501(project)</span>
</pre></td></tr></tbody></table>

	然后开始来解决我们所需要的环境吧！<br>
<ol>
	<li>首先创建所需要开发的专案目录：<br>
<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">mkdir /srv/ahome</span>
[root@www ~]# <span class="term_command">ll -d /srv/ahome</span>
drwxr-xr-x 2 root root 4096 Sep 29 22:36 /srv/ahome
</pre></td></tr></tbody></table></li>

	<li>从上面的输出结果可发现 alex 与 arod 都不能在该目录内创建文件，因此需要进行权限与属性的修改。
		由於其他人均不可进入此目录，因此该目录的群组应为project，权限应为770才合理。<br>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">chgrp project /srv/ahome</span>
[root@www ~]# <span class="term_command">chmod 770 /srv/ahome</span>
[root@www ~]# <span class="term_command">ll -d /srv/ahome</span>
drwx<span class="term_write">rwx</span>--- 2 root <span class="term_write">project</span> 4096 Sep 29 22:36 /srv/ahome
<span class="term_say"># 从上面的权限结果来看，由於 alex/arod 均支持 project，因此似乎没问题了！</span>
</pre></td></tr></tbody></table></li>

	<li>实际分别以两个使用者来测试看看，情况会是如何？先用 alex 创建文件，然后用 arod 去处理看看。<br>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">su - alex      </span> <span class="term_note">&lt;==先切换身份成为 alex 来处理</span>
[alex@www ~]$ <span class="term_command">cd /srv/ahome  </span> <span class="term_note">&lt;==切换到群组的工作目录去</span>
[alex@www ahome]$ <span class="term_command">touch abcd </span> <span class="term_note">&lt;==创建一个空的文件出来！</span>
[alex@www ahome]$ <span class="term_command">exit       </span> <span class="term_note">&lt;==离开 alex 的身份</span>

[root@www ~]# <span class="term_command">su - arod</span>
[arod@www ~]$ <span class="term_command">cd /srv/ahome</span>
[arod@www ahome]$ <span class="term_command">ll abcd</span>
-rw-rw-r-- 1 alex <span class="term_write">alex</span> 0 Sep 29 22:46 abcd
<span class="term_say"># 仔细看一下上面的文件，由於群组是 alex ，arod并不支持！
# 因此对於 abcd 这个文件来说， arod 应该只是其他人，只有 r 的权限而已啊！</span>
[arod@www ahome]$ <span class="term_command">exit</span>
</pre></td></tr></tbody></table>
	由上面的结果我们可以知道，若单纯使用传统的 rwx 而已，则对刚刚 alex 创建的 abcd 这个文件来说，
	<span class="text_import2">arod 可以删除他，但是却不能编辑他！</span>这不是我们要的样子啊！赶紧来重新规划一下。<br><br></li>

	<li>加入 SGID 的权限在里面，并进行测试看看：<br>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">chmod 2770 /srv/ahome</span>
[root@www ~]# <span class="term_command">ll -d /srv/ahome</span>
drwxrws--- 2 root project 4096 Sep 29 22:46 /srv/ahome

<span class="term_hd">测试：使用 alex 去创建一个文件，并且查阅文件权限看看：</span>
[root@www ~]# <span class="term_command">su - alex</span>
[alex@www ~]$ <span class="term_command">cd /srv/ahome</span>
[alex@www ahome]$ <span class="term_command">touch 1234</span>
[alex@www ahome]$ <span class="term_command">ll 1234</span>
-rw-<span class="term_write">rw-</span>r-- 1 alex <span class="term_write">project</span> 0 Sep 29 22:53 1234
<span class="term_say"># 没错！这才是我们要的样子！现在 alex, arod 创建的新文件所属群组都是 project，
# 由於两人均属於此群组，加上 umask 都是 002，这样两人才可以互相修改对方的文件！</span>
</pre></td></tr></tbody></table>
	所以最终的结果显示，此目录的权限最好是『2770』，所属文件拥有者属於root即可，至於群组必须要为两人共同支持的project
	这个群组才行！</li>
</ol>

<hr>简答题部分：
<ul>
	<li>什么是绝对路径与相对路径
	<div class="blockex">
		绝对路径的写法为由 / 开始写，至於相对路径则不由 / 开始写！此外，相对路径为相对於目前工作目录的路径！
	</div></li>

	<li>如何更改一个目录的名称？例如由 /home/test 变为 /home/test2
	<div class="blockex">
		mv /home/test /home/test2
	</div></li>

	<li>PATH 这个环境变量的意义？
	<div class="blockex">
		这个是用来指定运行档运行的时候，命令搜寻的目录路径。
	</div></li>

	<li>umask 有什么用处与优点？
	<div class="blockex">
		umask 可以拿掉一些权限，因此，适当的定义 umask 有助於系统的安全，
		因为他可以用来创建默认的目录或文件的权限。
	</div></li>

	<li>当一个使用者的 umask 分别为 033 与 044 他所创建的文件与目录的权限为何？
	<div class="blockex">
		在 umask 为 033 时，则默认是拿掉 group 与 other 的 w(2)x(1) 
		权限，因此权限就成为『文件 -rw-r--r-- ， 目录 drwxr--r-- 』而当
		umask 044 时，则拿掉 r 的属性，因此就成为『文件 -rw--w--w-，目录 drwx-wx-wx』
	</div></li>

	<li>什么是 SUID ？
	<div class="blockex">
		当一个命令具有 SUID 的功能时，则：
                <ul>
                <li>SUID 权限仅对二进位程序(binary program)有效；</li>
                <li>运行者对於该程序需要具有 x  的可运行权限；</li>
                <li>本权限仅在运行该程序的过程中有效 (run-time)；</li>
                <li>运行者将具有该程序拥有者 (owner) 的权限。</li>
                </ul>
	</div></li>

	<li>当我要查询 /usr/bin/passwd 这个文件的一些属性时(1)传统权限；(2)文件类型与(3)文件的隐藏属性，可以使用什么命令来查询？
	<div class="blockex">
		ls -al<br> file<br> lsattr
	</div></li>

	<li>尝试用 find 找出目前 linux 系统中，所有具有 SUID 的文件有哪些？
	<div class="blockex">
		find / -perm +4000 -print
	</div></li>

	<li>找出 /etc 底下，文件大小介於 50K 到 60K 之间的文件，并且将权限完整的列出 (ls -l)：
	<div class="blockex">
		find /etc -size +50k -a -size -60k -exec ls -l {} \;<br>
		注意到 -a ，那个 -a 是 and 的意思，为符合两者才算成功
	</div></li>

	<li>找出 /etc 底下，文件容量大於 50K 且文件所属人不是 root 的档名，且将权限完整的列出 (ls -l)；
	<div class="blockex">
		find /etc -size +50k -a ! -user root -exec ls -ld {} \;<br>
		find /etc -size +50k -a ! -user root -type f -exec ls -l {} \;<br>
		上面两式均可！注意到 ! ，那个 ! 代表的是反向选择，亦即『不是后面的项目』之意！
	</div></li>

	<li>找出 /etc 底下，容量大於 1500K 以及容量等於 0 的文件：
	<div class="blockex">
		find /etc -size +1500k -o -size 0<br>
		相对於 -a ，那个 -o 就是或 (or) 的意思罗！
	</div></li>

</ul>
</div>


<hr><a name="reference"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">参考数据与延伸阅读</span><br>
<div class="block1">
<ul>
	<li>小洲大大回答 SUID/SGID 的一篇讨论：<br>
		<a href="http://phorum.vbird.org/viewtopic.php?t=20256" target="_blank">http://phorum.vbird.org/viewtopic.php?t=20256</a></li>
</ul>
</div>
<hr />
    </td>
    <td style="width: 16px; font-size: 6px;">　</td></tr>
<tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
</tbody></table>

<div style="padding-top: 0px; text-align: center;">
<span style="font-size: 80%;">
	<a href="http://linux.vbird.org/" target="_top" title="前往鸟哥的首页">http://linux.vbird.org</a>
	is designed by <a href="mailto:vbird@mail.vbird.idv.tw" title="联络鸟哥(我不要广告信！)">VBird</a>
		during 2001-2011. <a href="http://www.ksu.edu.tw/" target="_blank">ksu.edu</a></span>
         ﻿<div id="apDiv4">
      <p>本网页主要以Firefox配合解析度 1024x768 作为设计依据&nbsp;&nbsp;&nbsp;&nbsp; 鸟哥自由软件整合应用研究室</p></div></div>
</div>
</center>
</body></html>
