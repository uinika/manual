<html><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="Author" content="2011/04/18,white">
	<meta name="Description" content="学习 bash shell">
	<title>鸟哥的 Linux 私房菜 -- 学习 bash shell</title>
    <script src="../script/SpryMenuBar.js" type="text/javascript"></script>
	<script src="../script/index.js" type="text/javascript"></script>
	<link href="../css/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
    <link href="../css/main.css" rel="stylesheet" type="text/css" />
    </head><body style="margin: 0pt; padding: 0pt;" class="table"onload="MM_preloadImages('../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html')">

<center>
<div id="apDiv5">
<div> <LINK REL="SHORTCUT ICON" HREF="../index-2.html">
<!-- ImageReady Slices (title3.ai) -->
<table id="___01" width="898" height="81" border="0" align="center" cellpadding="0" cellspacing="0";>
	<tr>
		<td colspan="15">
			<img src="image/title/title_01.png" width="900" height="1" alt=""></td>
	</tr>
	<tr>
		<td rowspan="4" bgcolor="#182448"><p><img src="http://linux.vbird.org/cgi-bin/Count.cgi?dd=C&amp;ft=5&amp;sh=T&amp;md=8&amp;pad=Y&amp;df=vbird.dic.ksu.edu.tw.dat" width="93" align="left" title="計數器" /></p>
	    <p><font color="#FFFFFF" size="-1">since2012/04/23</font></p></td>
		<td rowspan="4" align="left" valign="top"><a href="../index.html"><img src="image/title/title_03.png" alt="" width="263" height="79" border="0"></a></td>
		<td colspan="13">
			<img src="image/title/title_04.png" alt="" width="535" height="9" border="0"></td>
	</tr>
	<tr>
		<td rowspan="3">
			<img src="image/title/title_05.png" alt="" width="53" height="70" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="0110whatislinux.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image51','','image/title/title_06.png',1)"><img src="image/title/title3_06.png" name="Image51" width="106" height="25" border="0" id="Image51" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_07.png" alt="" width="27" height="37" border="0"></td>
		<td colspan="3" align="left" valign="top"><a href="../linux_server/0110network_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image52','','image/title/title_08.png',1)"><img src="image/title/title3_08.png" name="Image52" width="107" height="25" border="0" id="Image52" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_09.png" alt="" width="37" height="37" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../about.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image53','','image/title/title_10.png',1)"><img src="image/title/title3_10.png" name="Image53" width="75" height="25" border="0" id="Image53" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_11.png" alt="" width="35" height="70" border="0"></td>
		<td align="left" valign="top"><a href="mailto:vbird@mail.vbird.idv.tw" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image54','','image/title/title_12.png',1)"><img src="image/title/title3_12.png" name="Image54" width="74" height="25" border="0" id="Image54" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_13.png" alt="" width="21" height="70" border="0"></td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="image/title/title_14.png" alt="" width="106" height="12" border="0"></td>
		<td colspan="3">
			<img src="image/title/title_15.png" alt="" width="107" height="12" border="0"></td>
		<td colspan="2">
			<img src="image/title/title_16.png" width="75" height="12" alt=""></td>
		<td rowspan="2">
			<img src="image/title/title_17.png" alt="" width="74" height="45" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/title_18.png" alt="" width="15" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar1" class="MenuBarHorizontal">
	  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image44','','image/title/title_19.png',1)"><img src="image/title/title3_19.png" name="Image44" width="123" height="33" border="0" id="Image44" /></a>
			    <ul>
			      <li><a href="Mandrake9.0/mandrake9.0.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image46','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image46" width="120" height="26" border="0" id="Image46" alt="" /></a></li>
                  <li><a href="fedora_4/fc4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image47','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image47" width="120" height="26" border="0" id="Image47" alt="" /></a></li>
                  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image48','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image48" width="120" height="26" border="0" id="Image48" alt="" /></a></li>
                </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_20.png" alt="" width="42" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar2" class="MenuBarHorizontal">
	  <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image45','','image/title/title_21.png',1)"><img src="image/title/title3_21.png" name="Image45" width="125" height="33" border="0" id="Image45" /></a>
			    <ul>
			      <li><a href="../linux_server/linux_redhat9/redhat9.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image43','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image43" width="120" height="26" border="0" id="Image43" alt=""/></a></li>
			      <li><a href="../linux_server/centos4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image49','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image49" width="120" height="26" border="0" id="Image49" alt="" /></a></li>
			      <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image50','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image50" width="120" height="26" border="0" id="Image50" alt="" /></a></li>
		        </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_22.png" alt="" width="47" height="33" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/Spacer.gif" width="101" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="263" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="53" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="15" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="91" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="27" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="5" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="42" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="60" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="37" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="28" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="47" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="35" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="74" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="22" height="1" alt=""></td>
	</tr>
</table>
<!-- End ImageReady Slices -->
<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</div>
<table summary="本文内容的排版" style="width: 898px;" border="0" cellpadding="0" cellspacing="0">
<tbody><tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
<tr><td style="width: 16px; font-size: 6px;">　</td>
    <td width="866">
<!-- 本文的档头部分 -->
<div style="text-align: center;">
    <a href="0320bash.html">
    <span class="text_head0">第十一章、认识与学习<span class="text_head_en"> BASH </span></span></a><br>
</div>
    <div style="text-align: right;">
        <span class="text_history">最近升级日期：2009/08/25</span>
    </div>
<!-- 本文的连结区部分 -->
<div class="block1">
<span class="text_h1">
3. <a href="#alias_history">命令别名与历史命令</a><br>
	<span class="text_h2">
	　　3.1 <a href="#alias">命令别名配置： alias, unalias</a><br>
	　　3.2 <a href="#history">历史命令： history, HISTSIZE</a><br>
	</span>
</span></div>
<!-- 本文的正式部分 -->
<hr><a name="alias_history"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">命令别名与历史命令：</span><br>
<div class="block1">
	<p>我们知道在早期的 DOS 年代，清除屏幕上的信息可以使用 cls 来清除，但是在 Linux 里面，
	我们则是使用 clear 来清除画面的。那么可否让 cls 等于 clear 呢？可以啊！用啥方法？
	link file 还是什么的？别急！底下我们介绍不用 link file 的命令别名来达成。那么什么又是历史命令？
	曾经做过的举动我们可以将他记录下来喔！那就是历史命令啰～底下分别来谈一谈这两个玩意儿。<br><br></p>

	<hr><a name="alias"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">命令别名配置： alias, unalias</span><br>
	<div class="block2">
		<p>命令别名是一个很有趣的东西，特别是你的惯用命令特别长的时候！还有，
		增设默认的选项在一些惯用的命令上面，可以预防一些不小心误杀文件的情况发生的时候！
		举个例子来说，如果你要查询隐藏档，并且需要长的列出与一页一页翻看，那么需要下达『
		<span class="text_import2">ls -al | more </span>』这个命令，我是觉得很烦啦！
		要输入好几个单字！那可不可以使用 lm 来简化呢？当然可以，你可以在命令行下面下达：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">alias lm='ls -al | more'</span>
</pre></td></tr></tbody></table>

		<p>立刻多出了一个可以运行的命令喔！这个命令名称为 lm ，且其实他是运行 ls -al | more 啊！真是方便。不过，
		要注意的是：『alias 的定义守则与<a href="#variable_rule">变量定义守则</a>几乎相同』，
		所以你只要在 alias 后面加上你的 {<span class="text_import2">『别名』='命令 选项...'</span> }，
		以后你只要输入 lm 就相当于输入了 ls -al|more 这一串命令！很方便吧！</p>

		<p>另外，命令别名的配置还可以取代既有的命令喔！举例来说，我们知道 root
		可以移除 (rm) 任何数据！所以当你以 root 的身份在进行工作时，需要特别小心，
		但是总有失手的时候，那么 rm 提供了一个选项来让我们确认是否要移除该文件，那就是 -i 
		这个选项！所以，你可以这样做：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">alias rm='rm -i'</span>
</pre></td></tr></tbody></table>

		<p>那么以后使用 rm 的时候，就不用太担心会有错误删除的情况了！这也是命令别名的优点啰！
		那么如何知道目前有哪些的命令别名呢？就使用 alias 呀！</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">alias</span>
alias cp='cp -i'
alias l.='ls -d .* --color=tty'
alias ll='ls -l --color=tty'
alias lm='ls -l | more'
alias ls='ls --color=tty'
alias mv='mv -i'
alias rm='rm -i'
alias which='alias | /usr/bin/which --tty-only --show-dot --show-tilde'
</pre></td></tr></tbody></table>

		<p>由上面的数据当中，你也会发现一件事情啊，我们在<a href="0310vi.html">第十章的 vim 程序编辑器</a>里面提到 
		vi 与 vim 是不太一样的，vim 可以多作一些额外的语法检验与颜色显示，默认的 root 是单纯使用 vi 而已。
		如果你想要使用 vi 就直接以 vim 来开启文件的话，使用『 alias vi='vim' 』这个配置即可。
		至于如果要取消命令别名的话，那么就使用 unalias 吧！例如要将刚刚的 lm 命令别名拿掉，就使用：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">unalias lm</span>
</pre></td></tr></tbody></table>

		<p><span class="text_import2">那么命令别名与变量有什么不同呢</span>？命令别名是『新创一个新的命令，
		你可以直接下达该命令』的，至于变量则需要使用类似『 echo 』命令才能够呼叫出变量的内容！
		这两者当然不一样！很多初学者在这里老是搞不清楚！要注意啊！ ^_^</p>

<table border="1" cellpadding="5" cellspacing="0" width="90%"><tbody><tr><td>
例题：<div class="block2">
DOS 年代，列出目录与文件就是 dir ，而清除屏幕就是 cls ，那么如果我想要在
linux 里面也使用相同的命令呢？
</div>
答：<div class="block2">
很简单，透过 clear 与 ls 来进行命令别名的建置：
<blockquote style="font-family: '细明体';" class="text_import2">
alias cls='clear'<br>alias dir='ls -l'</blockquote>
</div>
</td></tr></tbody></table><br>

	</div>

	<hr><a name="history"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">历史命令：history</span><br>
	<div class="block2">
		<p>前面我们提过 bash 有提供命令历史的服务！那么如何查询我们曾经下达过的命令呢？就使用
		history 啰！当然，如果觉得 histsory 要输入的字符太多太麻烦，可以使用命令别名来配置呢！
		不要跟我说还不会配置呦！ ^_^</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">alias h='history'</span>
</pre></td></tr></tbody></table>

		<p>如此则输入 h 等于输入 history 啰！好了，我们来谈一谈 history 的用法吧！</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">history [n]</span>
[root@www ~]# <span class="term_command">history [-c]</span>
[root@www ~]# <span class="term_command">history [-raw] histfiles</span>
<span class="term_say">选项与参数：
n   ：数字，意思是『要列出最近的 n 笔命令行表』的意思！
-c  ：将目前的 shell 中的所有 history 内容全部消除
-a  ：将目前新增的 history 命令新增入 histfiles 中，若没有加 histfiles ，
      则默认写入 ~/.bash_history
-r  ：将 histfiles 的内容读到目前这个 shell 的 history 记忆中；
-w  ：将目前的 history 记忆内容写入 histfiles 中！</span>

<span class="term_hd">范例一：列出目前内存内的所有 history 记忆</span>
[root@www ~]# <span class="term_command">history</span>
<span class="term_say"># 前面省略</span>
 1017  man bash
 1018  ll
 1019  history 
 1020  history
<span class="term_say"># 列出的信息当中，共分两栏，第一栏为该命令在这个 shell 当中的代码，
# 另一个则是命令本身的内容喔！至于会秀出几笔命令记录，则与 HISTSIZE 有关！</span>

<span class="term_hd">范例二：列出目前最近的 3 笔数据</span>
[root@www ~]# <span class="term_command">history 3</span>
 1019  history 
 1020  history
 1021  history 3

<span class="term_hd">范例三：立刻将目前的数据写入 histfile 当中</span>
[root@www ~]# <span class="term_command">history -w</span>
<span class="term_say"># 在默认的情况下，会将历史纪录写入 ~/.bash_history 当中！</span>
[root@www ~]# <span class="term_command">echo $HISTSIZE</span>
1000
</pre></td></tr></tbody></table>

		<p>在正常的情况下，历史命令的读取与记录是这样的：</p>

		<ul>
		<li>当我们以 bash 登陆 Linux 主机之后，系统会主动的由家目录的 ~/.bash_history
		读取以前曾经下过的命令，那么 ~/.bash_history 会记录几笔数据呢？这就与你 bash 的
		HISTFILESIZE 这个变量配置值有关了！<br><br></li>
		<li>假设我这次登陆主机后，共下达过 100 次命令，『<span class="text_import2">等我注销时，
		系统就会将 101~1100 这总共 1000 笔历史命令<b>升级</b>到 ~/.bash_history 当中。</span>』
		也就是说，历史命令在我注销时，会将最近的 HISTFILESIZE 笔记录到我的纪录文件当中啦！<br><br></li>
		<li>当然，也可以用 history -w 强制立刻写入的！那为何用『升级』两个字呢？
		因为 ~/.bash_history 记录的笔数永远都是 HISTFILESIZE 那么多，旧的信息会被主动的拿掉！
		仅保留最新的！</li></ul>

		<p>那么 history 这个历史命令只可以让我查询命令而已吗？呵呵！当然不止啊！
		我们可以利用相关的功能来帮我们运行命令呢！举例来说啰：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">!number</span>
[root@www ~]# <span class="term_command">!command</span>
[root@www ~]# <span class="term_command">!!</span>
<span class="term_say">选项与参数：
number  ：运行第几笔命令的意思；
command ：由最近的命令向前搜寻『命令串开头为 command』的那个命令，并运行；
!!      ：就是运行上一个命令(相当于按↑按键后，按 Enter)</span>

[root@www ~]# <span class="term_command">history</span>
   66  man rm
   67  alias
   68  man history
   69  history 
[root@www ~]# <span class="term_command">!66</span>  <span class="term_note">&lt;==运行第 66 笔命令</span>
[root@www ~]# <span class="term_command">!! </span>  <span class="term_note">&lt;==运行上一个命令，本例中亦即 !66 </span>
[root@www ~]# <span class="term_command">!al</span>  <span class="term_note">&lt;==运行最近以 al 为开头的命令(上头列出的第 67 个)</span>
</pre></td></tr></tbody></table>

		<p>经过上面的介绍，瞭乎？历史命令用法可多了！如果我想要运行上一个命令，
		除了使用上下键之外，我可以直接以『 !! 』 来下达上个命令的内容，此外，
		我也可以直接选择下达第 n 个命令，『 !n 』来运行，也可以使用命令标头，例如
		『 !vi 』来运行最近命令开头是 vi 的命令列！相当的方便而好用！</p>

		<p>基本上 history 的用途很大的！但是需要小心安全的问题！尤其是 root 的历史纪录文件，这是
		Cracker 的最爱！因为不小心的 root 会将很多的重要数据在运行的过程中会被纪录在
		~/.bash_history 当中，如果这个文件被解析的话，后果不堪吶！无论如何，使用 history 配合『
		! 』曾经使用过的命令下达是很有效率的一个命令下达方法！<br><br></p>

		<hr><ul class="list1"><li class="text_import1">同一账号同时多次登陆的 history 写入问题</li></ul>
		<p>有些朋友在练习 linux 的时候喜欢同时开好几个 bash 接口，这些 bash 的身份都是 root 。
		这样会有 ~/.bash_history 的写入问题吗？想一想，因为这些 bash 在同时以 root 的身份登陆，
		因此所有的 bash 都有自己的 1000 笔记录在内存中。因为等到注销时才会升级记录文件，所以啰，
		最后注销的那个 bash 才会是最后写入的数据。唔！如此一来其他 bash 的命令操作就不会被记录下来了
		(其实有被记录，只是被后来的最后一个 bash 所覆盖升级了) 。</p>

		<p>由于多重登陆有这样的问题，所以很多朋友都习惯单一 bash 登陆，再用<a href="0440processcontrol.html#background">工作控制 (job control, 第四篇会介绍)</a> 来切换不同工作！
		这样才能够将所有曾经下达过的命令记录下来，也才方便未来系统管理员进行命令的 debug 啊！<br><br></p>

		<hr><ul class="list1"><li class="text_import1">无法记录时间</li></ul>
		<p>历史命令还有一个问题，那就是无法记录命令下达的时间。由于这 1000 笔历史命令是依序记录的，
		但是并没有记录时间，所以在查询方面会有一些不方便。如果读者们有兴趣，其实可以透过 ~/.bash_logout 
		来进行 history 的记录，并加上 date 来添加时间参数，也是一个可以应用的方向喔！
		有兴趣的朋友可以先看看情境模拟题一吧！</p>
	</div>
</div>
<hr />
    </td>
    <td style="width: 16px; font-size: 6px;">　</td></tr>
<tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
</tbody></table>

<div style="padding-top: 0px; text-align: center;">
<span style="font-size: 80%;">
	<a href="http://linux.vbird.org/" target="_top" title="前往鸟哥的首页">http://linux.vbird.org</a>
	is designed by <a href="mailto:vbird@mail.vbird.idv.tw" title="联络鸟哥(我不要广告信！)">VBird</a>
		during 2001-2011. <a href="http://www.ksu.edu.tw/" target="_blank">ksu.edu</a></span>
         ﻿<div id="apDiv4">
      <p>本网页主要以Firefox配合解析度 1024x768 作为设计依据&nbsp;&nbsp;&nbsp;&nbsp; 鸟哥自由软件整合应用研究室</p></div></div>
</div>
</center>
</body></html>
