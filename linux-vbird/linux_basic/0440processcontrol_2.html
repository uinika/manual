<html><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="Author" content="2011/04/20,lee">
	<meta name="Description" content="程序管理与 SELinux 初探">
	<title>鸟哥的 Linux 私房菜 -- 程序管理与 SELinux 初探</title>
    <script src="../script/SpryMenuBar.js" type="text/javascript"></script>
	<script src="../script/index.js" type="text/javascript"></script>
	<link href="../css/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
    <link href="../css/main.css" rel="stylesheet" type="text/css" />
    </head><body style="margin: 0pt; padding: 0pt;" class="table"onload="MM_preloadImages('../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html')">

<center>
<div id="apDiv5">
<div> <LINK REL="SHORTCUT ICON" HREF="../index-2.html">
<!-- ImageReady Slices (title3.ai) -->
<table id="___01" width="898" height="81" border="0" align="center" cellpadding="0" cellspacing="0";>
	<tr>
		<td colspan="15">
			<img src="image/title/title_01.png" width="900" height="1" alt=""></td>
	</tr>
	<tr>
		<td rowspan="4" bgcolor="#182448"><p><img src="http://linux.vbird.org/cgi-bin/Count.cgi?dd=C&amp;ft=5&amp;sh=T&amp;md=8&amp;pad=Y&amp;df=vbird.dic.ksu.edu.tw.dat" width="93" align="left" title="計數器" /></p>
	    <p><font color="#FFFFFF" size="-1">since2012/04/23</font></p></td>
		<td rowspan="4" align="left" valign="top"><a href="../index.html"><img src="image/title/title_03.png" alt="" width="263" height="79" border="0"></a></td>
		<td colspan="13">
			<img src="image/title/title_04.png" alt="" width="535" height="9" border="0"></td>
	</tr>
	<tr>
		<td rowspan="3">
			<img src="image/title/title_05.png" alt="" width="53" height="70" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="0110whatislinux.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image51','','image/title/title_06.png',1)"><img src="image/title/title3_06.png" name="Image51" width="106" height="25" border="0" id="Image51" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_07.png" alt="" width="27" height="37" border="0"></td>
		<td colspan="3" align="left" valign="top"><a href="../linux_server/0110network_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image52','','image/title/title_08.png',1)"><img src="image/title/title3_08.png" name="Image52" width="107" height="25" border="0" id="Image52" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_09.png" alt="" width="37" height="37" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../about.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image53','','image/title/title_10.png',1)"><img src="image/title/title3_10.png" name="Image53" width="75" height="25" border="0" id="Image53" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_11.png" alt="" width="35" height="70" border="0"></td>
		<td align="left" valign="top"><a href="mailto:vbird@mail.vbird.idv.tw" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image54','','image/title/title_12.png',1)"><img src="image/title/title3_12.png" name="Image54" width="74" height="25" border="0" id="Image54" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_13.png" alt="" width="21" height="70" border="0"></td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="image/title/title_14.png" alt="" width="106" height="12" border="0"></td>
		<td colspan="3">
			<img src="image/title/title_15.png" alt="" width="107" height="12" border="0"></td>
		<td colspan="2">
			<img src="image/title/title_16.png" width="75" height="12" alt=""></td>
		<td rowspan="2">
			<img src="image/title/title_17.png" alt="" width="74" height="45" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/title_18.png" alt="" width="15" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar1" class="MenuBarHorizontal">
	  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image44','','image/title/title_19.png',1)"><img src="image/title/title3_19.png" name="Image44" width="123" height="33" border="0" id="Image44" /></a>
			    <ul>
			      <li><a href="Mandrake9.0/mandrake9.0.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image46','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image46" width="120" height="26" border="0" id="Image46" alt="" /></a></li>
                  <li><a href="fedora_4/fc4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image47','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image47" width="120" height="26" border="0" id="Image47" alt="" /></a></li>
                  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image48','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image48" width="120" height="26" border="0" id="Image48" alt="" /></a></li>
                </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_20.png" alt="" width="42" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar2" class="MenuBarHorizontal">
	  <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image45','','image/title/title_21.png',1)"><img src="image/title/title3_21.png" name="Image45" width="125" height="33" border="0" id="Image45" /></a>
			    <ul>
			      <li><a href="../linux_server/linux_redhat9/redhat9.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image43','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image43" width="120" height="26" border="0" id="Image43" alt=""/></a></li>
			      <li><a href="../linux_server/centos4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image49','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image49" width="120" height="26" border="0" id="Image49" alt="" /></a></li>
			      <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image50','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image50" width="120" height="26" border="0" id="Image50" alt="" /></a></li>
		        </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_22.png" alt="" width="47" height="33" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/Spacer.gif" width="101" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="263" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="53" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="15" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="91" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="27" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="5" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="42" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="60" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="37" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="28" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="47" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="35" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="74" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="22" height="1" alt=""></td>
	</tr>
</table>
<!-- End ImageReady Slices -->
<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</div>
<table summary="本文内容的排版" style="width: 898px;" border="0" cellpadding="0" cellspacing="0">
<tbody><tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
<tr><td style="width: 16px; font-size: 6px;">　</td>
    <td width="866">

<!-- 本文的档头部分 -->
<div style="text-align: center;">
    <a href="0440processcontrol.html">
    <span class="text_head0">第十七章、程序管理与<span class="text_head_en"> SELinux </span>初探</span></a><br>
</div>
    <div style="text-align: right;">
        <span class="text_history">最近升级日期：2009/09/11</span>
    </div>
<!-- 本文的连结区部分 -->
<div class="block1">
<span class="text_h1">
2. <a href="#background">工作管理 (job control)</a><br>
	<span class="text_h2">
	　　2.1 <a href="#background_what">什么是工作管理</a><br>
	　　2.2 <a href="#background_run">job control 的管理</a>：<a href="#the_and">&amp;</a>, <a href="#ctrl_z">[ctrl]-z</a>, 
		<a href="#jobs">jobs</a>, <a href="#fg">fg</a>, <a href="#bg">bg</a>, <a href="#killjobs">kill</a><br>
	　　2.3 <a href="#background_term">离线管理问题</a>： <a href="#nohup">nohup</a><br>
	</span>
</span></div>
<!-- 本文的正式部分 -->
<hr><a name="background"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">工作管理 (job control)</span><br>
<div class="block1">
	<p>这个工作管理 (job control) 是用在 bash 环境下的，也就是说：『<span class="text_import2">当我们登陆系统取得 bash shell
	之后，在<u>单一终端机介面</u>下同时进行多个工作的行为管理</span> 』。举例来说，我们在登陆 bash 后，
	想要一边复制文件、一边进行数据搜寻、一边进行编译，还可以一边进行 vi 程序撰写！
	当然我们可以重复登陆那六个文字介面的终端机环境中，不过，能不能在一个 bash 内达成？
	当然可以啊！就是使用 job control 啦！ ^_^<br><br></p>

	<hr><a name="background_what"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">什么是工作管理？</span><br>
	<div class="block2">
		<p>从上面的说明当中，你应该要了解的是：『<span class="text_import2">进行工作管理的行为中，
		其实每个工作都是目前 bash 的子程序，亦即彼此之间是有相关性的。
		我们无法以 job control 的方式由 tty1 的环境去管理 tty2 的 bash ！</span>』
		这个概念请你得先创建起来，后续的范例介绍之后，你就会清楚的了解罗！</p>

		<p>或许你会觉得很奇怪啊，既然我可以在六个终端介面登陆，那何必使用 job control 呢？
		真是脱裤子放屁，多此一举啊！不要忘记了呢，我们可以在 <a href="0410accountmanager.html#limits">/etc/security/limits.conf (第十四章)</a>
		里面配置使用者同时可以登陆的连线数，在这样的情况下，某些使用者可能仅能以一个连线来工作呢！
		所以罗，你就得要了解一下这种工作管理的模式了！此外，这个章节内容也会牵涉到很多的数据流重导向，所以，如果忘记的话，
		务必回到<a href="0320bash.html">第十一章 BASH Shell</a> 看一看喔！</p>

		<p>由於假设我们只有一个终端介面，因此在<span class="text_import2">可以出现提示字节让你操作的环境就称为前景 
		(foreground)，至於其他工作就可以让你放入背景 (background) 去暂停或运行。</span>要注意的是，放入背景的工作想要运行时，
		他必须不能够与使用者互动。举例来说， vim 绝对不可能在背景里面运行 (running) 的！因为你没有输入数据他就不会跑啊！
		而且<span class="text_import2">放入背景的工作是不可以使用 [ctrl]+c 来终止的</span>』！</p>

		<p>总之，要进行 bash  的 job control 必须要注意到的限制是：</p>

		<ul class="text_import2">
		<li>这些工作所触发的程序必须来自於你 shell 的子程序(只管理自己的 bash)；</li>
		<li>前景：你可以控制与下达命令的这个环境称为前景的工作 (foreground)；</li>
		<li>背景：可以自行运行的工作，你无法使用 [ctrl]+c 终止他，可使用 bg/fg 呼叫该工作；</li>
		<li>背景中『运行』的程序不能等待 terminal/shell 的输入(input)</li></ul>

		<p>接下来让我们实际来管理这些工作吧！</p>
	</div>

	<hr><a name="background_run"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">job control 的管理</span><br>
	<div class="block2">
		<p>如前所述，bash 只能够管理自己的工作而不能管理其他 bash 的工作，所以即使你是 root 也不能够将别人的 bash
		底下的 job 给他拿过来运行。此外，又分前景与背景，然后在背景里面的工作状态又可以分为『暂停 (stop)』与『运行中
		(running)』。那实际进行 job 控制的命令有哪些？底下就来谈谈。<br><br></p>

		<a name="the_and"></a>
		<hr><ul class="list1"><li class="text_import1">直接将命令丢到背景中『运行』的 &amp;</li></ul>

		<p>如同前面提到的，我们在只有一个 bash 的环境下，如果想要同时进行多个工作，
		那么可以将某些工作直接丢到背景环境当中，让我们可以继续操作前景的工作！那么如何将工作丢到背景中？
		最简单的方法就是利用『 &amp; 』这个玩意儿了！举个简单的例子，我们要将 /etc/ 整个备份成为 
		/tmp/etc.tar.gz 且不想要等待，那么可以这样做：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">tar -zpcf /tmp/etc.tar.gz /etc &amp;</span>
[1] 8400  <span class="term_note">&lt;== [job number] PID </span>
[root@www ~]# tar: Removing leading `/' from member names 
<span class="term_say"># 在中括号内的号码为工作号码 (job number)，该号码与 bash 的控制有关。
# 后续的 8400 则是这个工作在系统中的 PID。至於后续出现的数据是 tar 运行的数据流，
# 由於我们没有加上数据流重导向，所以会影响画面！不过不会影响前景的操作喔！</span>
</pre></td></tr></tbody></table>

		<p>仔细的瞧一瞧，我在输入一个命令后，在该命令的最后面加上一个『 &amp; 』代表将该命令丢到背景中，
		此时 bash 会给予这个命令一个『工作号码(job number)』，就是那个 [1] 啦！至於后面那个 8400 
		则是该命令所触发的『 PID 』了！而且，有趣的是，我们可以继续操作 bash 呢！很不赖吧！
		不过，那么丢到背景中的工作什么时候完成？完成的时候会显示什么？如果你输入几个命令后，突然出现这个数据：</p>

<table class="term"><tbody><tr><td class="term"><pre>[1]+  Done                    tar -zpcf /tmp/etc.tar.gz /etc
</pre></td></tr></tbody></table>

		<p>就代表 [1] 这个工作已经完成 (Done) ，该工作的命令则是接在后面那一串命令列。
		这样了解了吧！另外，这个 &amp; 代表：『将工作丢到背景中去运行』喔！
		注意到那个『运行』的字眼！此外，这样的情况最大的好处是： 
		<span class="text_import2">不怕被 [ctrl]+c 中断</span>的啦！
		此外，将工作丢到背景当中要特别注意数据的流向喔！包括上面的信息就有出现错误信息，导致我的前景被影响。
		虽然只要按下 [enter] 就会出现提示字节。但如果我将刚刚那个命令改成：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">tar -zpcvf /tmp/etc.tar.gz /etc &amp;</span>
</pre></td></tr></tbody></table>

		<p>情况会怎样？在背景当中运行的命令，如果有 stdout 及 stderr 时，他的数据依旧是输出到萤幕上面的，
		所以，我们会无法看到提示字节，当然也就无法完好的掌握前景工作。同时由於是背景工作的 tar ，
		此时你怎么按下 [ctrl]+c 也无法停止萤幕被搞的花花绿绿的！所以罗，最佳的状况就是利用数据流重导向，
		将输出数据传送至某个文件中。举例来说，我可以这样做：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">tar -zpcvf /tmp/etc.tar.gz /etc &gt; /tmp/log.txt 2&gt;&amp;1 &amp;</span>
[1] 8429
[root@www ~]# 
</pre></td></tr></tbody></table>

		<p>呵呵！如此一来，输出的资讯都给他传送到 /tmp/log.txt 当中，当然就不会影响到我们前景的作业了。
		这样说，您应该可以更清楚数据流重导向的重要性了吧！^_^</p>

		<div style="padding: 10pt 0pt;" align="right"><table width="90%"><tbody><tr><td><b>Tips:</b><br><span style="color: rgb(0, 144, 0);"><font size="-1">		工作号码 (job number) 只与你这个 bash 环境有关，但是他既然是个命令触发的咚咚，所以当然一定是一个程序，
		因此你会观察到有 job number 也搭配一个 PID ！
		</font></span></td><td><img src="0440processcontrol_files/vbird_face.gif" alt="鸟哥的图示" title="鸟哥的图示"></td></tr></tbody></table></div>

		<a name="ctrl_z"></a>
		<hr><ul class="list1"><li class="text_import1">将『目前』的工作丢到背景中『暂停』：[ctrl]-z</li></ul>

		<p>想个情况：如果我正在使用 vi ，却发现我有个文件不知道放在哪里，需要到 bash
		环境下进行搜寻，此时是否要结束 vi 呢？呵呵！当然不需要啊！只要暂时将 vi 给他丢到背景当中等待即可。
		例如以下的案例：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">vi ~/.bashrc</span>
<span class="term_say"># 在 vi 的一般模式下，按下 [ctrl]-z 这两个按键</span>
[1]+  Stopped                 vim ~/.bashrc
[root@www ~]#   <span class="term_note">&lt;==顺利取得了前景的操控权！</span>
[root@www ~]# <span class="term_command">find / -print</span>
<span class="term_say">....(输出省略)....
# 此时萤幕会非常的忙碌！因为萤幕上会显示所有的档名。请按下 [ctrl]-z 暂停</span>
[2]+  Stopped                 find / -print
</pre></td></tr></tbody></table>

		<p>在 vi 的一般模式下，按下 [ctrl] 及 z 这两个按键，萤幕上会出现 [1] ，表示这是第一个工作，
		而<span class="text_import2">那个 + 代表最近一个被丢进背景的工作，且目前在背景下默认会被取用的那个工作 
		(与 fg 这个命令有关 )！而那个 Stopped 则代表目前这个工作的状态。在默认的情况下，使用 [ctrl]-z 
		丢到背景当中的工作都是『暂停』的状态喔！</span><br><br></p>

		<a name="jobs"></a>
		<hr><ul class="list1"><li class="text_import1">观察目前的背景工作状态： jobs</li></ul>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">jobs [-lrs]</span>
<span class="term_say">选项与参数：
-l  ：除了列出 job number 与命令串之外，同时列出 PID 的号码；
-r  ：仅列出正在背景 run 的工作；
-s  ：仅列出正在背景当中暂停 (stop) 的工作。</span>

<span class="term_hd">范例一：观察目前的 bash 当中，所有的工作，与对应的 PID</span>
[root@www ~]# <span class="term_command">jobs -l</span>
[1]- 10314 Stopped                 vim ~/.bashrc
[2]+ 10833 Stopped                 find / -print
</pre></td></tr></tbody></table>

		<p>如果想要知道目前有多少的工作在背景当中，就用 jobs 这个命令吧！一般来说，直接下达 jobs 即可！
		不过，如果你还想要知道该 job number 的 PID 号码，可以加上 -l  这个参数啦！
		在输出的资讯当中，例如上表，仔细看到那个 + - 号喔！那个 + 代表默认的取用工作。
		所以说：『<span class="text_import2">目前我有两个工作在背景当中，两个工作都是暂停的，
		而如果我仅输入 fg 时，那么那个 [2] 会被拿到前景当中来处理</span>』！</p>

		<p><span class="text_import2">其实 + 代表最近被放到背景的工作号码， - 代表最近最后第二个被放置到背景中的工作号码。</span>
		而超过最后第三个以后的工作，就不会有 +/- 符号存在了！<br><br></p>

		<a name="fg"></a>
		<hr><ul class="list1"><li class="text_import1">将背景工作拿到前景来处理：fg</li></ul>

		<p>刚刚提到的都是将工作丢到背景当中去运行的，那么有没有可以将背景工作拿到前景来处理的？
		有啊！就是那个 fg (foreground) 啦！举例来说，我们想要将上头范例当中的工作拿出来处理时：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">fg %jobnumber</span>
<span class="term_say">选项与参数：
%jobnumber ：jobnumber 为工作号码(数字)。注意，那个 % 是可有可无的！</span>

<span class="term_hd">范例一：先以 jobs 观察工作，再将工作取出：</span>
[root@www ~]# <span class="term_command">jobs</span>
[1]- 10314 Stopped                 vim ~/.bashrc
[2]+ 10833 Stopped                 find / -print
[root@www ~]# <span class="term_command">fg   </span>   <span class="term_note">&lt;==默认取出那个 + 的工作，亦即 [2]。立即按下[ctrl]-z</span>
[root@www ~]# <span class="term_command">fg %1</span>   <span class="term_note">&lt;==直接规定取出的那个工作号码！再按下[ctrl]-z</span>
[root@www ~]# <span class="term_command">jobs</span>
[1]<span class="term_write">+</span>  Stopped                 vim ~/.bashrc
[2]-  Stopped                 find / -print
</pre></td></tr></tbody></table>

		<p>经过 fg 命令就能够将背景工作拿到前景来处理罗！不过比较有趣的是最后一个显示的结果，我们会发现 + 出现在第一个工作后！
		怎么会这样啊？这是因为你刚刚利用 fg %1 将第一号工作捉到前景后又放回背景，此时最后一个被放入背景的将变成 vi 那个命令动作，
		所以当然 [1] 后面就会出现 + 了！了解乎！另外，如果输入『<span class="text_import2"> fg - </span>』
		则代表将 - 号的那个工作号码拿出来，上面就是 [2]- 那个工作号码啦！<br><br></p>

		<a name="bg"></a>
		<hr><ul class="list1"><li class="text_import1">让工作在背景下的状态变成运行中： bg</li></ul>

		<p>我们刚刚提到，那个 [ctrl]-z 可以将目前的工作丢到背景底下去『暂停』，
		那么如何让一个工作在背景底下『 Run 』呢？我们可以在底下这个案例当中来测试！
		注意喔！底下的测试要进行的快一点！^_^</p>

<table class="term"><tbody><tr><td class="term"><pre><span class="term_hd">范例一：一运行 find / -perm +7000 &gt; /tmp/text.txt 后，立刻丢到背景去暂停！</span>
[root@www ~]# <span class="term_command">find / -perm +7000 &gt; /tmp/text.txt</span>
<span class="term_say"># 此时，请立刻按下 [ctrl]-z 暂停！</span>
[3]+  Stopped                 find / -perm +7000 &gt; /tmp/text.txt

<span class="term_hd">范例二：让该工作在背景下进行，并且观察他！！</span>
[root@www ~]# <span class="term_command">jobs ; bg %3 ; jobs</span>
[1]-  Stopped                 vim ~/.bashrc
[2]   Stopped                 find / -print
[3]+  <span class="term_write">Stopped</span>                 find / -perm +7000 &gt; /tmp/text.txt
[3]+ find / -perm +7000 &gt; /tmp/text.txt &amp;  <span class="term_note">&lt;==用 bg%3 的情况！</span>
[1]+  Stopped                 vim ~/.bashrc
[2]   Stopped                 find / -print
[3]-  <span class="term_write">Running</span>                 find / -perm +7000 &gt; /tmp/text.txt &amp;
</pre></td></tr></tbody></table>

		<p>看到哪里有差异吗？呼呼！没错！就是那个状态列～以经由 Stopping 变成了 Running 罗！
		看到差异点，嘿嘿！命令列最后方多了一个 &amp; 的符号罗！
		代表该工作被启动在背景当中了啦！ ^_^<br><br></p>

		<a name="killjobs"></a>
		<hr><ul class="list1"><li class="text_import1">管理背景当中的工作： kill</li></ul>

		<p>刚刚我们可以让一个已经在背景当中的工作继续工作，也可以让该工作以 fg 拿到前景来，
		那么，如果想要将该工作直接移除呢？或者是将该工作重新启动呢？这个时候就得需要给予该工作一个讯号 
		(signal) ，让他知道该怎么作才好啊！此时， kill 这个命令就派上用场啦！</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">kill -signal %jobnumber</span>
[root@www ~]# <span class="term_command">kill -l</span>
<span class="term_say">选项与参数：
-l  ：这个是 L 的小写，列出目前 kill 能够使用的讯号 (signal) 有哪些？
signal ：代表给予后面接的那个工作什么样的指示罗！用 man 7 signal 可知：
  -1 ：重新读取一次参数的配置档 (类似 reload)；
  -2 ：代表与由键盘输入 [ctrl]-c 同样的动作；
  -9 ：立刻强制删除一个工作；
  -15：以正常的程序方式终止一项工作。与 -9 是不一样的。</span>

<span class="term_hd">范例一：找出目前的 bash 环境下的背景工作，并将该工作『强制删除』。</span>
[root@www ~]# <span class="term_command">jobs</span>
[1]+  Stopped                 vim ~/.bashrc
[2]   Stopped                 find / -print
[root@www ~]# <span class="term_command">kill -9 %2; jobs</span>
[1]+  Stopped                 vim ~/.bashrc
[2]   <span class="term_write">Killed</span>                  find / -print
<span class="term_say"># 再过几秒你再下达 jobs 一次，就会发现 2 号工作不见了！因为被移除了！</span>

<span class="term_hd">范例：找出目前的 bash 环境下的背景工作，并将该工作『正常终止』掉。</span>
[root@www ~]# <span class="term_command">jobs</span>
[1]+  Stopped                 vim ~/.bashrc
[root@www ~]# <span class="term_command">kill -SIGTERM %1</span>
<span class="term_say"># -SIGTERM 与 -15 是一样的！您可以使用 kill -l 来查阅！</span>
</pre></td></tr></tbody></table>

		<p>特别留意一下， <span class="text_import2">-9 这个 signal 通常是用在『强制删除一个不正常的工作』时所使用的，
		-15 则是以正常步骤结束一项工作(15也是默认值)</span>，两者之间并不相同呦！举上面的例子来说，
		我用 vi 的时候，不是会产生一个 .filename.swp 的文件吗？
		那么，当使用 -15 这个 signal 时， vi 会尝试以正常的步骤来结束掉该 vi 的工作，
		所以 .filename.swp 会主动的被移除。但若是使用 -9 这个 signal 时，由於该 vi 工作会被强制移除掉，因此， 
		.filename.swp 就会继续存在文件系统当中。这样您应该可以稍微分辨一下了吧？</p>

		<p>其实， kill 的妙用是很无穷的啦！他搭配 signal 所详列的资讯 (用 man 7 signal 去查阅相关数据)
		可以让您有效的管理工作与程序 (Process)，此外，那个 killall 也是同样的用法！
		至於常用的 signal 您至少需要了解 1, 9, 15 这三个 signal 的意义才好。
		此外， signal 除了以数值来表示之外，也可以使用讯号名称喔！
		举例来说，上面的范例二就是一个例子啦！至於 signal number 与名称的对应，
		呵呵，使用 kill -l 就知道啦(L的小写)！</p>

		<p>另外， kill 后面接的数字默认会是 PID ，如果想要管理 bash 的工作控制，就得要加上 %数字 了，
		这点也得特别留意才行喔！</p>
	</div>

	<hr><a name="background_term"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">离线管理问题</span><br>
	<div class="block2">
		<p>要注意的是，我们在工作管理当中提到的『背景』指的是在终端机模式下可以避免 [crtl]-c 中断的一个情境，
		并不是放到系统的背景去喔！所以，<span class="text_import2">工作管理的背景依旧与终端机有关</span>啦！
		在这样的情况下，如果你是以远程连线方式连接到你的 Linux 主机，并且将工作以 &amp; 的方式放到背景去，
		请问，在工作尚未结束的情况下你离线了，该工作还会继续进行吗？答案是『否』！不会继续进行，而是会被中断掉。</p>

		<a name="nohup"></a>
		<p>那怎么办？如果我的工作需要进行一大段时间，我又不能放置在背景底下，那该如何处理呢？
		首先，你可以参考前一章的 <a href="0430cron.html#at">at</a> 来处理即可！因为 at 是将工作放置到系统背景，
		而与终端机无关。如果不想要使用 at 的话，那你也可以尝试使用 nohup 这个命令来处理喔！这个 nohup 
		可以让你在离线或注销系统后，还能够让工作继续进行。他的语法有点像这样：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">nohup [命令与参数]  </span> <span class="term_note">&lt;==在终端机前景中工作</span>
[root@www ~]# <span class="term_command">nohup [命令与参数] &amp;</span> <span class="term_note">&lt;==在终端机背景中工作</span>
</pre></td></tr></tbody></table>

		<p>有够好简单的命令吧！上述命令需要注意的是， nohup 并不支持 bash 内建的命令，因此你的命令必须要是外部命令才行。
		我们来尝试玩一下底下的任务吧！</p>

<table class="term"><tbody><tr><td class="term"><pre><span class="term_hd"># 1. 先编辑一支会『睡著 500 秒』的程序：</span>
[root@www ~]# <span class="term_command">vim sleep500.sh</span>
#!/bin/bash
/bin/sleep 500s
/bin/echo "I have slept 500 seconds."

<span class="term_hd"># 2. 丢到背景中去运行，并且立刻注销系统：</span>
[root@www ~]# <span class="term_command">chmod a+x sleep500.sh</span>
[root@www ~]# <span class="term_command">nohup ./sleep500.sh &amp;</span>
[1] 5074
[root@www ~]# nohup: appending output to ‘nohup.out’ <span class="term_note">&lt;==会告知这个信息！</span>
[root@www ~]# <span class="term_command">exit</span>
</pre></td></tr></tbody></table>

		<p>如果你再次登陆的话，再使用 pstree 去查阅你的程序，会发现 sleep500.sh 还在运行中喔！并不会被中断掉！
		这样了解意思了吗？由於我们的程序最后会输出一个信息，但是 nohup 与终端机其实无关了，
		因此这个信息的输出就会被导向『 ~/nohup.out 』，所以你才会看到上述命令中，当你输入 nohup 后，
		会出现那个提示信息罗。</p>

		<p>如果你想要让在背景的工作在你注销后还能够继续的运行，那么使用 nohup 搭配 &amp; 是不错的运行情境喔！
		可以参考看看！</p>
	</div>
</div>
<hr />
    </td>
    <td style="width: 16px; font-size: 6px;">　</td></tr>
<tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
</tbody></table>

<div style="padding-top: 0px; text-align: center;">
<span style="font-size: 80%;">
	<a href="http://linux.vbird.org/" target="_top" title="前往鸟哥的首页">http://linux.vbird.org</a>
	is designed by <a href="mailto:vbird@mail.vbird.idv.tw" title="联络鸟哥(我不要广告信！)">VBird</a>
		during 2001-2011. <a href="http://www.ksu.edu.tw/" target="_blank">ksu.edu</a></span>
         ﻿<div id="apDiv4">
      <p>本网页主要以Firefox配合解析度 1024x768 作为设计依据&nbsp;&nbsp;&nbsp;&nbsp; 鸟哥自由软件整合应用研究室</p></div></div>
</div>
</center>
</body></html>
