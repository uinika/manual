<html><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf8">
	<meta name="Author" content="2011/04/19,lee">
	<meta name="Description" content="在 Linux 系统下管理用户的身份与账号！">
	<title>鸟哥的 Linux 私房菜 -- Linux 账号管理</title>
    <script src="../script/SpryMenuBar.js" type="text/javascript"></script>
	<script src="../script/index.js" type="text/javascript"></script>
	<link href="../css/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
    <link href="../css/main.css" rel="stylesheet" type="text/css" />
    </head><body style="margin: 0pt; padding: 0pt;" class="table"onload="MM_preloadImages('../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html')">

<center>
<div id="apDiv5">
<div> <LINK REL="SHORTCUT ICON" HREF="../index-2.html">
<!-- ImageReady Slices (title3.ai) -->
<table id="___01" width="898" height="81" border="0" align="center" cellpadding="0" cellspacing="0";>
	<tr>
		<td colspan="15">
			<img src="image/title/title_01.png" width="900" height="1" alt=""></td>
	</tr>
	<tr>
		<td rowspan="4" bgcolor="#182448"><p><img src="http://linux.vbird.org/cgi-bin/Count.cgi?dd=C&amp;ft=5&amp;sh=T&amp;md=8&amp;pad=Y&amp;df=vbird.dic.ksu.edu.tw.dat" width="93" align="left" title="計數器" /></p>
	    <p><font color="#FFFFFF" size="-1">since2012/04/23</font></p></td>
		<td rowspan="4" align="left" valign="top"><a href="../index.html"><img src="image/title/title_03.png" alt="" width="263" height="79" border="0"></a></td>
		<td colspan="13">
			<img src="image/title/title_04.png" alt="" width="535" height="9" border="0"></td>
	</tr>
	<tr>
		<td rowspan="3">
			<img src="image/title/title_05.png" alt="" width="53" height="70" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="0110whatislinux.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image51','','image/title/title_06.png',1)"><img src="image/title/title3_06.png" name="Image51" width="106" height="25" border="0" id="Image51" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_07.png" alt="" width="27" height="37" border="0"></td>
		<td colspan="3" align="left" valign="top"><a href="../linux_server/0110network_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image52','','image/title/title_08.png',1)"><img src="image/title/title3_08.png" name="Image52" width="107" height="25" border="0" id="Image52" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_09.png" alt="" width="37" height="37" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../about.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image53','','image/title/title_10.png',1)"><img src="image/title/title3_10.png" name="Image53" width="75" height="25" border="0" id="Image53" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_11.png" alt="" width="35" height="70" border="0"></td>
		<td align="left" valign="top"><a href="mailto:vbird@mail.vbird.idv.tw" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image54','','image/title/title_12.png',1)"><img src="image/title/title3_12.png" name="Image54" width="74" height="25" border="0" id="Image54" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_13.png" alt="" width="21" height="70" border="0"></td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="image/title/title_14.png" alt="" width="106" height="12" border="0"></td>
		<td colspan="3">
			<img src="image/title/title_15.png" alt="" width="107" height="12" border="0"></td>
		<td colspan="2">
			<img src="image/title/title_16.png" width="75" height="12" alt=""></td>
		<td rowspan="2">
			<img src="image/title/title_17.png" alt="" width="74" height="45" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/title_18.png" alt="" width="15" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar1" class="MenuBarHorizontal">
	  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image44','','image/title/title_19.png',1)"><img src="image/title/title3_19.png" name="Image44" width="123" height="33" border="0" id="Image44" /></a>
			    <ul>
			      <li><a href="Mandrake9.0/mandrake9.0.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image46','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image46" width="120" height="26" border="0" id="Image46" alt="" /></a></li>
                  <li><a href="fedora_4/fc4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image47','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image47" width="120" height="26" border="0" id="Image47" alt="" /></a></li>
                  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image48','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image48" width="120" height="26" border="0" id="Image48" alt="" /></a></li>
                </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_20.png" alt="" width="42" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar2" class="MenuBarHorizontal">
	  <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image45','','image/title/title_21.png',1)"><img src="image/title/title3_21.png" name="Image45" width="125" height="33" border="0" id="Image45" /></a>
			    <ul>
			      <li><a href="../linux_server/linux_redhat9/redhat9.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image43','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image43" width="120" height="26" border="0" id="Image43" alt=""/></a></li>
			      <li><a href="../linux_server/centos4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image49','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image49" width="120" height="26" border="0" id="Image49" alt="" /></a></li>
			      <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image50','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image50" width="120" height="26" border="0" id="Image50" alt="" /></a></li>
		        </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_22.png" alt="" width="47" height="33" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/Spacer.gif" width="101" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="263" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="53" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="15" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="91" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="27" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="5" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="42" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="60" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="37" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="28" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="47" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="35" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="74" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="22" height="1" alt=""></td>
	</tr>
</table>
<!-- End ImageReady Slices -->
<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</div>
<table summary="本文内容的排版" style="width: 898px;" border="0" cellpadding="0" cellspacing="0">
<tbody><tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
<tr><td style="width: 16px; font-size: 6px;">　</td>
    <td width="866">

<!-- 本文的档头部分 -->
<div style="text-align: center;">
    <a href="0410accountmanager.html">
    <span class="text_head0">第十四章、<span class="text_head_en">Linux </span>账号管理与<span class="text_head_en"> ACL </span>权限配置</span></a><br>
</div>
    <div style="text-align: right;">
        <span class="text_history">最近升级日期：2009/09/09</span>
    </div>
<!-- 本文的连结区部分 -->
<div class="block1">
<span class="text_h1">
7. <a href="#manual">手动新增使用者</a><br>
	<span class="text_h2">
	　　7.1 <a href="#manual_tools">一些检查工具</a>：<a href="#pwck">pwck</a>, 
		<a href="#pwconv">pwconv</a>, <a href="#pwunconv">pwunconv</a>, <a href="#chpasswd">chpasswd</a><br>
	　　7.2 <a href="#manual_normal">特殊账号，如纯数字账号的手工创建</a><br>
	　　7.3 <a href="#manual_account_1">大量建置账号模板(适用 passwd --stdin 选项)</a><br>
	　　7.4 <a href="#manual_amount">大量建置账号的范例(适用于连续数字，如学号)</a><br>
	</span>
</span></div>
<!-- 本文的正式部分 -->
<hr><a name="manual"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">手动新增使用者</span><br>
<div class="block1">
	<p>一般来说，我们不很建议大家使用手动的方式来新增使用者，为什么呢？
	因为使用者的创建涉及到 GID/UID 等权限的关系，而且，与文件/目录的权限也有关系，
	使用 useradd 可以帮我们自动配置好 UID/GID 家目录以及家目录相关的权限配置，
	但是，手动来添加的时候，有可能会忘东忘西，结果导致一些困扰的发生。</p>

	<p>不过，要了解整个系统，最好还是手动来修改过比较好，至少我们的账号问题可以完全依照自己的意思去修订，
	而不必迁就于系统的默认值啊！但是，还是要告诫一下朋友们，要手动配置账号时，
	您必须要真的很了解自己在作什么，尤其是与权限有关的配置方面喔！好吧！底下就让我们来玩一玩啰～ ^_^<br><br></p>

	<hr><a name="manual_tools"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">一些检查工具</span><br>
	<div class="block2">
		<p>既然要手动修改账号的相关配置文件，那么一些检查群组、账号相关的命令就不可不知道啊～
		尤其是那个口令转换的 pwconv 及 pwuconv 这两个玩意～可重要的很呢！底下我们稍微介绍一下这些命令吧！<br><br></p>

		<a name="pwck"></a>
		<hr><ul class="list1"><li class="text_import1">pwck</li></ul>

		<p>pwck 这个命令在检查 /etc/passwd 这个账号配置文件内的信息，与实际的家目录是否存在等信息，
		还可以比对 /etc/passwd /etc/shadow 的信息是否一致，另外，如果 /etc/passwd 内的数据字段错误时，会提示使用者修订。
		一般来说，我只是利用这个玩意儿来检查我的输入是否正确就是了。</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">pwck</span>
user adm: directory /var/adm does not exist
user uucp: directory /var/spool/uucp does not exist
user gopher: directory /var/gopher does not exist
</pre></td></tr></tbody></table>

		<p>瞧！上面仅是告知我，这些账号并没有家目录，由于那些账号绝大部分都是系统账号，
		确实也不需要家目录的，所以，那是『正常的错误！』呵呵！不理他。 ^_^。
		相对应的群组检查可以使用 grpck 这个命令的啦！<br><br></p>

		<a name="pwconv"></a>
		<hr><ul class="list1"><li class="text_import1">pwconv</li></ul>

		<p>这个命令主要的目的是在『将 /etc/passwd 内的账号与口令，移动到 /etc/shadow 当中！』
		早期的 Unix 系统当中并没有 /etc/shadow 呢，所以，用户的登陆口令早期是在 /etc/passwd
		的第二栏，后来为了系统安全，才将口令数据移动到 /etc/shadow 内的。使用 pwconv 后，可以：</p>

		<ul>
		<li>比对 /etc/passwd 及 /etc/shadow ，若 /etc/passwd 内存在的账号并没有对应的
		/etc/shadow 口令时，则 pwconv 会去 /etc/login.defs 取用相关的口令数据，并创建该账号的 /etc/shadow 数据；<br><br></li>

		<li>若 /etc/passwd 内存在加密后的口令数据时，则 pwconv 会将该口令栏移动到 /etc/shadow 内，并将原本的 
		/etc/passwd 内相对应的口令栏变成 x ！</li>
		</ul>
		<p>一般来说，如果您正常使用 useradd 添加使用者时，使用 pwconv  并不会有任何的动作，因为 /etc/passwd 与 
		/etc/shadow 并不会有上述两点问题啊！ ^_^。不过，如果手动配置账号，这个 pwconv 就很重要啰！<br><br></p>


		<a name="pwunconv"></a>
		<hr><ul class="list1"><li class="text_import1">pwunconv</li></ul>
		<p>相对于 pwconv ， pwunconv 则是『将 /etc/shadow 内的口令栏数据写回 /etc/passwd 当中，
		并且删除 /etc/shadow 文件。』这个命令说实在的，最好不要使用啦！
		因为他会将你的 /etc/shadow 删除喔！如果你忘记备份，又不会使用 pwconv 的话，粉严重呢！<br><br></p>


		<a name="chpasswd"></a>
		<hr><ul class="list1"><li class="text_import1">chpasswd</li></ul>

		<p>chpasswd 是个挺有趣的命令，他可以『读入未加密前的口令，并且经过加密后，
		将加密后的口令写入 /etc/shadow 当中。』这个命令很常被使用在大量建置账号的情况中喔！
		他可以由 Standard input 读入数据，每笔数据的格式是『 username:password 』。
		举例来说，我的系统当中有个用户账号为 dmtsai ，我想要升级他的口令 (update) ，
		假如他的口令是 abcdefg 的话，那么我可以这样做：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">echo "dmtsai:abcdefg" | chpasswd -m</span>
</pre></td></tr></tbody></table>

		<p>神奇吧！这样就可以升级了呢！在默认的情况中， chpasswd 使用的是 DES 加密方法来加密，
		我们可以使用 chpasswd -m 来使用 CentOS 5.x 默认的 MD5 加密方法。这个命令虽然已经很好用了，不过 CentOS 5.x
		其实已经提供了『 passwd --stdin 』的选项，老实说，这个 chpasswd 可以不必使用了。但考虑其他版本不见得会提供
		--stdin 给 passwd 这个命令，所以您还是得要了解一下这个命令用途！</p>
	</div>

	<hr><a name="manual_normal"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">特殊账号，如纯数字账号的手工创建</span><br>
	<div class="block2">
		<p>在我们了解了 UID/GID 与账号的关系之后，基本上，您应该了解了，为啥<span class="text_import2">我们不建议使用纯数字的账号了！因为很多时候，系统会搞不清楚那组数字是『账号』还是『 UID
		』</span>，这不是很好啦～也因此，在早期某些版本底下，是没有办法使用数字来创建账号的。例如在 Red Hat 9 的环境中，
		使用『 useradd 1234 』他会显示『 useradd: invalid user name '1234' 』了解了吗？</p>

		<div style="padding: 10pt 0pt;" align="right"><table width="90%"><tbody><tr><td><b>Tips:</b><br><span style="color: rgb(0, 144, 0);"><font size="-1">		在较新的 distribution 当中，纯数字的账号已经可以被 useradd 创建了。不过鸟哥还是非常不建议使用纯数字账号。
		例如在 setfacl 的配置值中，若使用『 setfacl -m u:501:rwx filename 』那个 501 代表的是 UID 还是账号？
		因为 setfacl 的配置是支持使用 UID 或账号的，纯数字账号很容易造成系统的误解！
		</font></span></td><td><img src="0410accountmanager_files/vbird_face.gif" alt="鸟哥的图示" title="鸟哥的图示"></td></tr></tbody></table></div>
		<p>不过，有的时候，长官的命令难为啊 @_@ 有时还是得要创建这方面的账号的，那该如何是好？
		呵呵！当然可以手动来创建这样的账号啦！不过，为了系统安全起见，鸟哥还是不建议使用纯数字的账号的啦！
		因此，底下的范例当中，我们使用手动的方式来创建一个名为 normaluser 的账号，
		而且这个账号属于 normalgroup 这个群组。OK！那么整个步骤该如何是好呢？
		由前面的说明来看，您应该了解了账号与群组是与 /etc/group, /etc/shadow, /etc/passwd, /etc/gshadow 
		有关，因此，整个动作是这样的：</p>

		<ol class="text_import2">
		<li>先创建所需要的群组 ( vi /etc/group )；</li>
		<li>将 /etc/group 与 /etc/gshadow 同步化 ( grpconv )；</li>
		<li>创建账号的各个属性 ( vi /etc/passwd )；</li>
		<li>将 /etc/passwd 与 /etc/shadow 同步化 ( pwconv )；</li>
		<li>创建该账号的口令 ( passwd accountname )；</li>
		<li>创建用户家目录 ( cp -a /etc/skel /home/accountname )；</li>
		<li>更改用户家目录的属性 ( chown -R accountname.group /home/accountname )。</li>
		</ol>
		够简单的咯吧！让我们来玩一玩啰～<br>

<table class="term"><tbody><tr><td class="term"><pre><span class="term_hd">1. 创建群组 normalgroup ，假设 520 这个 GID 没有被使用！并且同步化 gshadow</span>
[root@www ~]# <span class="term_command">vi /etc/group</span>
<span class="term_say"># 在最后一行加入底下这一行！</span>
<span class="term_write">normalgroup:x:520:</span>
[root@www ~]# <span class="term_command">grpconv</span>
[root@www ~]# <span class="term_command">grep 'normalgroup' /etc/group /etc/gshadow</span>
/etc/group:normalgroup:x:520:
/etc/gshadow:normalgroup:x::
<span class="term_say"># 最后确定 /etc/group, /etc/gshadow 都存在这个群组才行！搞定群组啰！</span>

<span class="term_hd">2. 创建 normaluser 这个账号，假设 UID 700 没被使用掉！</span>
[root@www ~]# <span class="term_command">vi /etc/passwd</span>
<span class="term_say"># 在最后一行加入底下这一行！</span>
<span class="term_write">normaluser:x:700:520::/home/normaluser:/bin/bash</span>

<span class="term_hd">3. 同步化口令，并且创建该用户的口令</span>
[root@www ~]# <span class="term_command">pwconv</span>
[root@www ~]# <span class="term_command">grep 'normaluser' /etc/passwd /etc/shadow</span>
/etc/passwd:normaluser:x:700:520::/home/normaluser:/bin/bash
/etc/shadow:normaluser:x:14307:0:99999:7:::
<span class="term_say"># 确定 /etc/passwd, /etc/shadow 都含有 normaluser 的信息了！但是口令还不对～</span>
[root@www ~]# <span class="term_command">passwd normaluser</span>
Changing password for user normaluser.
New UNIX password:
Retype new UNIX password:
passwd: all authentication tokens updated successfully.

<span class="term_hd">4. 创建用户家目录，并且修订权限！</span>
[root@www ~]# <span class="term_command">cp -a /etc/skel /home/normaluser</span>
[root@www ~]# <span class="term_command">chown -R normaluser:normalgroup /home/normaluser</span>
[root@www ~]# <span class="term_command">chmod 700 /home/normaluser</span>
</pre></td></tr></tbody></table>

		<p>别怀疑！这样就搞定了一个账号的配置了！
		从此以后，你可以创建任何名称的账号啰～不过，还是不建议您配置一些很怪很怪的账号名称啦！</p>
	</div>


	<hr><a name="manual_account_1"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">大量建置账号范本(适用 passwd 
	--stdin 选项)</span><br>
	<div class="block2">
		<p>由于 CentOS 5.x 的 passwd 已经提供了 --stdin 的功能，因此如果我们可以提供账号口令的话，
		那么就能够很简单的建置起我们的账号口令了。底下鸟哥制作一个简单的 script 来运行新增用户的功能喔！</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">vi account1.sh</span>
#!/bin/bash
# 这支程序用来创建新增账号，功能有：
# 1. 检查 account1.txt 是否存在，并将该文件内的账号取出；
# 2. 创建上述文件的账号；
# 3. 将上述账号的口令修订成为『强制第一次进入需要修改口令』的格式。
# 2009/03/04    VBird
export PATH=/bin:/sbin:/usr/bin:/usr/sbin

# 检查 account1.txt 是否存在
if [ ! -f account1.txt ]; then
        echo "所需要的账号文件不存在，请创建 account1.txt ，每行一个账号名称"
        exit 1
fi

usernames=$(cat account1.txt)

for username in $usernames
do
        useradd $username                         <span class="term_note">&lt;==新增账号</span>
        echo $username | passwd --stdin $username <span class="term_note">&lt;==与账号相同的口令</span>
        chage -d 0 $username                      <span class="term_note">&lt;==强制登陆修改口令</span>
done
</pre></td></tr></tbody></table>

		<p>接下来只要创建 account1.txt 这个文件即可！鸟哥创建这个文件里面共有十行，你可以自行创建该文件！
		内容每一行一个账号。注意，最终的结果会是每个账号具有与账号相同的口令，且初次登陆后，
		必须要重新配置口令后才能够再次登陆使用系统资源！</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">vi account1.txt</span>
std01
std02
std03
std04
std05
std06
std07
std08
std09
std10

[root@www ~]# <span class="term_command">sh account1.sh</span>
Changing password for user std01.
passwd: all authentication tokens updated successfully.
<span class="term_say">....(后面省略)....</span>
</pre></td></tr></tbody></table>

		<p>这支简单的脚本你可以在按如下的连结下载：</p>
		<ul><li><a href="../index-2.html" target="_blank">http://cn.linux.vbird.org/linux_basic/0410accountmanager/account1.sh</a></li></ul>

		<p>另外，鸟哥的 script 是在 zh_TW.big5 的语系下创建的，如果你需要转成万国码 (utf8) 的编码格式，
		请下载上述文件后，利用<a href="0310vi.html#tips_translate">第十章谈到的 iconv</a> 来处理语系的问题！</p>
	</div>

	<hr><a name="manual_amount"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">大量建置账号的范例(适用于连续数字，如学号)</span><br>
	<div class="block2">
		<p>前一小节的内容已经可以满足很多朋友的账号建置方法了，不过，某些时候上述的 script 还是很麻烦！
		因为需要手动编辑 account1.txt 嘛！如果是类似学校单位这种学号非常类似的账号时，有没有更快的方案？
		此外，如果需要每个班级同属于一个群组，不同班级的群组不同，又该如何建置？这是比较麻烦啦！</p>

		<p>目前很多网站都有提供大量创建账号的工具，例如台南县网中心的卧龙大师：</p>

		<ul><li><a href="http://news.ols3.net/techdoc/old/howtouse_cmpwd101.htm" target="_blank">http://news.ols3.net/techdoc/old/howtouse_cmpwd101.htm</a></li></ul>

		<p>提供的好用的 cmpwd 程序，但是小三大师的程序仅供学术单位使用，一般个人是无权使用的(参考上述连结的授权)。
		不过，其实我们也可以利用简单的 script 来帮我们达成喔！例如底下这支程序，
		他的运行结果与小三大师提供的程序差不多啦～但是因为我是直接以 useradd 来新增的，
		所以，即使不了解 UID ，也是可以适用的啦～整支程序的特色是：</p>

		<ul>
		<li>默认不允许使用纯数字方式创建账号；</li>
		<li>可加入年级来区分账号；</li>
		<li>可配置账号的起始号码与账号数量；</li>
		<li>有两种口令创建方式，可以与账号相同或程序自行以随机数创建口令文件。</li>
		</ul>

		<p>运行方法也简单的要命～请自行参考的啦！不再多说～使用时请注意，不要在公家使用的主机上面进行测试，因为.....
		这支程序会大量创建账号嘛！^_^</p>

<table class="term"><tbody><tr><td class="term"><pre>#!/bin/bash
#
# 这支程序主要在帮您创建大量的账号之用，更多的使用方法请参考：
# http://cn.linux.vbird.org/linux_basic/0410accountmanager.php#manual_amount
#
# 本程序为鸟哥自行开发，在 CentOS 5.x 上使用没有问题，
# 但不保证绝不会发生错误！使用时，请自行负担风险～
#
# History:
# 2005/09/05    VBird   刚刚才写完，使用看看先～
# 2009/03/04    VBird   加入一些语系的修改与说明，修改口令产生方式 (用 openssl)
export LANG=zh_TW.big5
export PATH=/sbin:/usr/sbin:/bin:/usr/bin
accountfile="user.passwd"

# 1. 进行账号相关的输入先！
echo ""
echo "例如我们昆山四技的学号为： 4960c001 到 4960c060 ，那么："
echo "账号开头代码为         ：4"
echo "账号层级或年级为       ：960c"
echo "号码数字位数为(001~060)：3"
echo "账号开始号码为         ：1"
echo "账号数量为             ：60"
echo ""
read -p "账号开头代码 ( Input title name, ex&gt; std )======&gt; " username_start
read -p "账号层级或年级 ( Input degree, ex&gt; 1 or enter )=&gt; " username_degree
read -p "号码部分的数字位数 ( Input \# of digital )======&gt; " nu_nu
read -p "起始号码 ( Input start number, ex&gt; 520 )========&gt; " nu_start
read -p "账号数量 ( Input amount of users, ex&gt; 100 )=====&gt; " nu_amount
read -p "口令标准 1) 与账号相同 2)随机数自定义 ==============&gt; " pwm
if [ "$username_start" == "" ]; then
        echo "没有输入开头的代码，不给你运行哩！" ; exit 1
fi
# 判断数字系统
testing0=$(echo $nu_nu     | grep '[^0-9]' )
testing1=$(echo $nu_amount | grep '[^0-9]' )
testing2=$(echo $nu_start  | grep '[^0-9]' )
if [ "$testing0" != "" -o "$testing1" != "" -o "$testing2" != "" ]; then
        echo "输入的号码不对啦！有非为数字的内容！" ; exit 1
fi
if [ "$pwm" != "1" ]; then
        pwm="2"
fi

# 2. 开始输出账号与口令文件！
[ -f "$accountfile" ] &amp;&amp; mv $accountfile "$accountfile"$(date +%Y%m%d)
nu_end=$(($nu_start+$nu_amount-1))
for (( i=$nu_start; i&lt;=$nu_end; i++ ))
do
        nu_len=${#i}
        if [ $nu_nu -lt $nu_len ]; then
                echo "数值的位数($i-&gt;$nu_len)已经比你配置的位数($nu_nu)还大！"
                echo "程序无法继续"
                exit 1
        fi
        nu_diff=$(( $nu_nu - $nu_len ))
        if [ "$nu_diff" != "0" ]; then
                nu_nn=0000000000
                nu_nn=${nu_nn:1:$nu_diff}
        fi
        account=${username_start}${username_degree}${nu_nn}${i}
        if [ "$pwm" == "1" ]; then
                password="$account"
        else
                password=$(openssl rand -base64 6)
        fi
        echo "$account":"$password" | tee -a "$accountfile"
done

# 3. 开始创建账号与口令！
cat "$accountfile" | cut -d':' -f1 | xargs -n 1 useradd -m
chpasswd &lt; "$accountfile"
pwconv
echo "OK！创建完成！"
</pre></td></tr></tbody></table>

		<p>如果有需要创建同一班级具有同一群组的话，可以先使用 <a href="#groupadd">groupadd</a> 创建群组后，
		将该群组加入『 cat "$accountfile" | cut -d':' -f1 | xargs -n 1 useradd -m <span class="text_import2">-g 
		groupname</span> 』那行！这支脚本可以在底下连结下载：</p>

		<ul><li><a href="../index-2.html" target="_blank">http://cn.linux.vbird.org/linux_basic/0410accountmanager/account2.sh</a></li></ul>

		<p>如果仅是测试而已，想要将刚刚创建的使用者整个删除，则可以使用如下的脚本来进行删除！</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">vi delaccount2.sh</span>
<span class="term_write">#!/bin/bash
usernames=$(cat user.passwd | cut -d ':' -f 1)
for username in $usernames
do
	echo "userdel -r $username"
	userdel -r $username
done</span>
[root@www ~]# <span class="term_command">sh delaccount2.sh</span>
</pre></td></tr></tbody></table>

		<p>总之，账号管理是很重要的！希望上面的说明能够对大家有点帮助啦！</p>
	</div>
</div>
<hr />
    </td>
    <td style="width: 16px; font-size: 6px;">　</td></tr>
<tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
</tbody></table>

<div style="padding-top: 0px; text-align: center;">
<span style="font-size: 80%;">
	<a href="http://linux.vbird.org/" target="_top" title="前往鸟哥的首页">http://linux.vbird.org</a>
	is designed by <a href="mailto:vbird@mail.vbird.idv.tw" title="联络鸟哥(我不要广告信！)">VBird</a>
		during 2001-2011. <a href="http://www.ksu.edu.tw/" target="_blank">ksu.edu</a></span>
         ﻿<div id="apDiv4">
      <p>本网页主要以Firefox配合解析度 1024x768 作为设计依据&nbsp;&nbsp;&nbsp;&nbsp; 鸟哥自由软件整合应用研究室</p></div></div>
</div>
</center>
</body></html>
