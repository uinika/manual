<html><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="Author" content="2011/04/20,white">
	<meta name="Description" content="包括了 crontab 与 at 这两支程序啦！">
	<title>鸟哥的 Linux 私房菜 -- 例行性工作排程的创建</title>
    <script src="../script/SpryMenuBar.js" type="text/javascript"></script>
	<script src="../script/index.js" type="text/javascript"></script>
	<link href="../css/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
    <link href="../css/main.css" rel="stylesheet" type="text/css" />
    </head><body style="margin: 0pt; padding: 0pt;" class="table"onload="MM_preloadImages('../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html')">

<center>
<div id="apDiv5">
<div> <LINK REL="SHORTCUT ICON" HREF="../index-2.html">
<!-- ImageReady Slices (title3.ai) -->
<table id="___01" width="898" height="81" border="0" align="center" cellpadding="0" cellspacing="0";>
	<tr>
		<td colspan="15">
			<img src="image/title/title_01.png" width="900" height="1" alt=""></td>
	</tr>
	<tr>
		<td rowspan="4" bgcolor="#182448"><p><img src="http://linux.vbird.org/cgi-bin/Count.cgi?dd=C&amp;ft=5&amp;sh=T&amp;md=8&amp;pad=Y&amp;df=vbird.dic.ksu.edu.tw.dat" width="93" align="left" title="計數器" /></p>
	    <p><font color="#FFFFFF" size="-1">since2012/04/23</font></p></td>
		<td rowspan="4" align="left" valign="top"><a href="../index.html"><img src="image/title/title_03.png" alt="" width="263" height="79" border="0"></a></td>
		<td colspan="13">
			<img src="image/title/title_04.png" alt="" width="535" height="9" border="0"></td>
	</tr>
	<tr>
		<td rowspan="3">
			<img src="image/title/title_05.png" alt="" width="53" height="70" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="0110whatislinux.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image51','','image/title/title_06.png',1)"><img src="image/title/title3_06.png" name="Image51" width="106" height="25" border="0" id="Image51" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_07.png" alt="" width="27" height="37" border="0"></td>
		<td colspan="3" align="left" valign="top"><a href="../linux_server/0110network_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image52','','image/title/title_08.png',1)"><img src="image/title/title3_08.png" name="Image52" width="107" height="25" border="0" id="Image52" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_09.png" alt="" width="37" height="37" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../about.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image53','','image/title/title_10.png',1)"><img src="image/title/title3_10.png" name="Image53" width="75" height="25" border="0" id="Image53" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_11.png" alt="" width="35" height="70" border="0"></td>
		<td align="left" valign="top"><a href="mailto:vbird@mail.vbird.idv.tw" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image54','','image/title/title_12.png',1)"><img src="image/title/title3_12.png" name="Image54" width="74" height="25" border="0" id="Image54" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_13.png" alt="" width="21" height="70" border="0"></td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="image/title/title_14.png" alt="" width="106" height="12" border="0"></td>
		<td colspan="3">
			<img src="image/title/title_15.png" alt="" width="107" height="12" border="0"></td>
		<td colspan="2">
			<img src="image/title/title_16.png" width="75" height="12" alt=""></td>
		<td rowspan="2">
			<img src="image/title/title_17.png" alt="" width="74" height="45" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/title_18.png" alt="" width="15" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar1" class="MenuBarHorizontal">
	  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image44','','image/title/title_19.png',1)"><img src="image/title/title3_19.png" name="Image44" width="123" height="33" border="0" id="Image44" /></a>
			    <ul>
			      <li><a href="Mandrake9.0/mandrake9.0.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image46','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image46" width="120" height="26" border="0" id="Image46" alt="" /></a></li>
                  <li><a href="fedora_4/fc4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image47','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image47" width="120" height="26" border="0" id="Image47" alt="" /></a></li>
                  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image48','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image48" width="120" height="26" border="0" id="Image48" alt="" /></a></li>
                </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_20.png" alt="" width="42" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar2" class="MenuBarHorizontal">
	  <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image45','','image/title/title_21.png',1)"><img src="image/title/title3_21.png" name="Image45" width="125" height="33" border="0" id="Image45" /></a>
			    <ul>
			      <li><a href="../linux_server/linux_redhat9/redhat9.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image43','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image43" width="120" height="26" border="0" id="Image43" alt=""/></a></li>
			      <li><a href="../linux_server/centos4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image49','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image49" width="120" height="26" border="0" id="Image49" alt="" /></a></li>
			      <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image50','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image50" width="120" height="26" border="0" id="Image50" alt="" /></a></li>
		        </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_22.png" alt="" width="47" height="33" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/Spacer.gif" width="101" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="263" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="53" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="15" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="91" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="27" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="5" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="42" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="60" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="37" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="28" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="47" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="35" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="74" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="22" height="1" alt=""></td>
	</tr>
</table>
<!-- End ImageReady Slices -->
<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</div>
<table summary="本文内容的排版" style="width: 898px;" border="0" cellpadding="0" cellspacing="0">
<tbody><tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
<tr><td style="width: 16px; font-size: 6px;">　</td>
    <td width="866">

<!-- 本文的档头部分 -->
<div style="text-align: center;">
    <a href="0430cron.html">
    <span class="text_head0">第十六章、例行性工作排程<span class="text_head_en"> (crontab)</span></span></a><br>
</div>
    <div style="text-align: right;">
        <span class="text_history">最近升级日期：2009/09/11</span>
    </div>
<!-- 本文的连结区部分 -->
<div class="block1">
<span class="text_h1">
3. <a href="#cron">循环运行的例行性工作排程</a><br>
	<span class="text_h2">
	　　3.1 <a href="#crontab_user">使用者的配置</a>： <a href="#cron_deny">/etc/cron.deny</a>, <a href="#crontab">crontab</a><br>
	　　3.2 <a href="#etc_crontab1">系统的配置档</a>： <a href="#etc_crontab">/etc/crontab</a><br>
	　　3.3 <a href="#security">一些注意事项</a><br>
	</span>
</span></div>
<!-- 本文的正式部分 -->
<hr><a name="cron"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">循环运行的例行性工作排程</span><br>
<div class="block1">
	<p>相对於 at 是仅运行一次的工作，<span class="text_import2">循环运行的例行性工作排程则是由 cron (crond)
	这个系统服务来控制的</span>。刚刚谈过 Linux 系统上面原本就有非常多的例行性工作，因此这个系统服务是默认启动的。另外，
	由於使用者自己也可以进行例行性工作排程，所以罗， Linux 也提供使用者控制例行性工作排程的命令 (crontab)。
	底下我们分别来聊一聊罗！<br><br></p>

	<hr><a name="crontab_user"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">使用者的配置</span><br>
	<div class="block2">
		<a name="cron_deny"></a>
		<p>使用者想要创建循环型工作排程时，使用的是 crontab 这个命令啦～不过，为了安全性的问题，
		与 at 同样的，我们可以限制使用 crontab 的使用者帐号喔！使用的限制数据有：</p>

		<ul>
		<li><span class="text_import2">/etc/cron.allow</span>：<br>
		将可以使用 crontab 的帐号写入其中，若不在这个文件内的使用者则不可使用 crontab；<br><br></li>

		<li><span class="text_import2">/etc/cron.deny</span>：<br>
		将不可以使用 crontab 的帐号写入其中，若未记录到这个文件当中的使用者，就可以使用 crontab 。</li></ul>

		<p>与 at 很像吧！同样的，以优先顺序来说， /etc/cron.allow 比 /etc/cron.deny 要优先，
		而判断上面，这两个文件只选择一个来限制而已，因此，建议你只要保留一个即可，
		免得影响自己在配置上面的判断！一般来说，系统默认是保留 /etc/cron.deny ，
		你可以将不想让他运行 crontab 的那个使用者写入 /etc/cron.deny 当中，一个帐号一行！</p>

		<p><span class="text_import2">当使用者使用 crontab 这个命令来创建工作排程之后，该项工作就会被纪录到 /var/spool/cron/ 
		里面去了，而且是以帐号来作为判别的喔</span>！举例来说， dmtsai 使用 crontab 后，
		他的工作会被纪录到 /var/spool/cron/dmtsai 里头去！但请注意，<span class="text_import2">不要使用 vi 直接编辑该文件，
		因为可能由於输入语法错误，会导致无法运行 cron 喔</span>！另外， cron 运行的每一项工作都会被纪录到
		/var/log/cron 这个登录档中，所以罗，如果你的 Linux 不知道有否被植入木马时，也可以搜寻一下 /var/log/cron 
		这个登录档呢！</p>

		<a name="crontab"></a>
		<p>好了，那么我们就来聊一聊 crontab 的语法吧！</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">crontab [-u username] [-l|-e|-r]</span>
<span class="term_say">选项与参数：
-u  ：只有 root 才能进行这个任务，亦即帮其他使用者创建/移除 crontab 工作排程；
-e  ：编辑 crontab 的工作内容
-l  ：查阅 crontab 的工作内容
-r  ：移除所有的 crontab 的工作内容，若仅要移除一项，请用 -e 去编辑。</span>

<span class="term_hd">范例一：用 dmtsai 的身份在每天的 12:00 发信给自己</span>
[dmtsai@www ~]$ <span class="term_command">crontab -e</span>
<span class="term_say"># 此时会进入 vi 的编辑画面让您编辑工作！注意到，每项工作都是一行。</span>
<span class="term_write">0   12  *  *  * mail dmtsai -s "at 12:00" &lt; /home/dmtsai/.bashrc</span>
<span class="term_say">#分 时 日 月 周 |&lt;==============命令串========================&gt;|</span>
</pre></td></tr></tbody></table>

		<p>默认情况下，任何使用者只要不被列入 /etc/cron.deny 当中，那么他就可以直接下达『 crontab -e 
		』去编辑自己的例行性命令了！整个过程就如同上面提到的，会进入 vi 的编辑画面，
		然后以一个工作一行来编辑，编辑完毕之后输入『 :wq 』储存后离开 vi 就可以了！
		而每项工作 (每行) 的格式都是具有六个栏位，这六个栏位的意义为：</p>

<table bgcolor="lightyellow" border="1" cellpadding="3" cellspacing="0" width="95%">
<tbody><tr align="center" bgcolor="#182448"><td><font color="#FFFFFF">代表意义</font></td><td><font color="#FFFFFF">分钟</font></td><td><font color="#FFFFFF">小时</font></td><td><font color="#FFFFFF">日期</font></td><td><font color="#FFFFFF">月份</font></td><td><font color="#FFFFFF">周</font></td><td><font color="#FFFFFF">命令</font></td></tr>
<tr align="center"><td bgcolor="#182448"><font color="#FFFFFF">数字范围</font></td><td>0-59</td><td>0-23</td><td>1-31</td><td>1-12</td><td>0-7</td>
	<td>呀就命令啊</td></tr>
</tbody></table><br>

		<p>比较有趣的是那个『周』喔！周的数字为 0 或 7 时，都代表『星期天』的意思！另外，
		还有一些辅助的字符，大概有底下这些：</p>

<table bgcolor="lightyellow" border="1" cellpadding="3" cellspacing="0" width="95%">
<tbody><tr align="center" bgcolor="#182448"><td width="70"><font color="#FFFFFF">特殊字符</font></td><td><font color="#FFFFFF">代表意义</font></td></tr>
<tr><td align="center">*(星号)</td><td>代表任何时刻都接受的意思！举例来说，范例一内那个日、月、周都是 * ，
	就代表著『不论何月、何日的礼拜几的 12:00 都运行后续命令』的意思！</td></tr>
<tr><td align="center">,(逗号)</td><td>代表分隔时段的意思。举例来说，如果要下达的工作是 3:00 与 6:00 时，就会是：
	<blockquote class="text_import2" style="font-family: '细明体';">0 3,6 * * * command</blockquote>
	时间参数还是有五栏，不过第二栏是 3,6 ，代表 3 与 6 都适用！</td></tr>
<tr><td align="center">-(减号)</td><td>代表一段时间范围内，举例来说， 8 点到 12 点之间的每小时的 20 分都进行一项工作：
	<blockquote class="text_import2" style="font-family: '细明体';">20 8-12 * * * command</blockquote>
	仔细看到第二栏变成 8-12 喔！代表 8,9,10,11,12 都适用的意思！</td></tr>
<tr><td align="center">/n(斜线)</td><td>那个 n 代表数字，亦即是『每隔 n 单位间隔』的意思，例如每五分钟进行一次，则：<br>
	<blockquote class="text_import2" style="font-family: '细明体';">*/5 * * * * command</blockquote>
	很简单吧！用 * 与 /5 来搭配，也可以写成 0-59/5 ，相同意思！</td></tr>
</tbody></table>

		<p>我们就来搭配几个例子练习看看吧！底下的案例请实际用 dmtsai 
		这个身份作看看喔！后续的动作才能够搭配起来！</p>

<table border="1" cellpadding="5" cellspacing="0" width="90%"><tbody><tr><td>
例题：<div class="block2">
假若你的女朋友生日是 5 月 2 日，你想要在 5 月 1 日的 23:59 发一封信给他，这封信的内容已经写在
/home/dmtsai/lover.txt 内了，该如何进行？
</div>
答：<div class="block2">
直接下达 crontab -e 之后，编辑成为：<blockquote class="text_import2" style="font-family: '细明体';">
59 23 1 5  *  mail kiki &lt; /home/dmtsai/lover.txt</blockquote>
那样的话，每年 kiki 都会收到你的这封信喔！（当然罗，信的内容就要每年变一变啦！）
</div>
</td></tr></tbody></table><br>

<table border="1" cellpadding="5" cellspacing="0" width="90%"><tbody><tr><td>
例题：<div class="block2">
假如每五分钟需要运行  /home/dmtsai/test.sh 一次，又该如何？
</div>
答：<div class="block2">
同样使用 crontab -e 进入编辑：<blockquote class="text_import2" style="font-family: '细明体';">
*/5 * * * * /home/dmtsai/test.sh</blockquote>
</div>
</td></tr></tbody></table>

		<p>那个 crontab 每个人都只有一个文件存在，就是在 /var/spool/cron 里面啊！
		还有建议您：『<span class="text_import2">命令下达时，最好使用绝对路径，这样比较不会找不到运行档喔</span>！』</p>

<table border="1" cellpadding="5" cellspacing="0" width="90%"><tbody><tr><td>
例题：<div class="block2">
假如你每星期六都与朋友有约，那么想要每个星期五下午 4:30 告诉你朋友星期六的约会不要忘记，则：
</div>
答：<div class="block2">
还是使用 crontab -e 啊！<blockquote class="text_import2">
30 16 * * 5 mail friend@his.server.name &lt; /home/dmtsai/friend.txt</blockquote>
</div>
</td></tr></tbody></table><br>

		<p>真的是很简单吧！呵呵！那么，该如何查询使用者目前的 crontab 内容呢？我们可以这样来看看：</p>

<table class="term"><tbody><tr><td class="term"><pre>[dmtsai@www ~]$ <span class="term_command">crontab -l</span>
59 23 1 5 * mail kiki &lt; /home/dmtsai/lover.txt
*/5 * * * * /home/dmtsai/test.sh
30 16 * * 5 mail friend@his.server.name &lt; /home/dmtsai/friend.txt

<span class="term_hd"># 注意，若仅想要移除一项工作而已的话，必须要用 crontab -e 去编辑～
# 如果想要全部的工作都移除，才使用 crontab -r 喔！</span>
[dmtsai@www ~]$ <span class="term_command">crontab -r</span>
[dmtsai@www ~]$ <span class="term_command">crontab -l</span>
no crontab for dmtsai
</pre></td></tr></tbody></table>

		<p>看到了吗？ crontab 『整个内容都不见了！』所以请注意：『如果只是要删除某个 
		crontab 的工作项目，那么请使用 crontab -e 来重新编辑即可！』如果使用 -r 的参数，是会将所有的 
		crontab 数据内容都删掉的！千万注意了！</p>
	</div>

	<hr><a name="etc_crontab1"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">系统的配置档： /etc/crontab</span><br>
	<div class="block2">
		<p>这个『 crontab -e 』是针对使用者的 cron 来设计的，如果是『系统的例行性任务』时，
		该怎么办呢？是否还是需要以 crontab -e 来管理你的例行性工作排程呢？当然不需要，你只要编辑
		<span class="text_import2">/etc/crontab</span> 这个文件就可以啦！有一点需要特别注意喔！那就是
		crontab -e 这个 crontab 其实是 /usr/bin/crontab 这个运行档，但是 /etc/crontab
		可是一个『纯文字档』喔！你可以 root 的身份编辑一下这个文件哩！</p>

		<p>基本上，<span class="text_import2"> cron 这个服务的最低侦测限制是『分钟』，所以『 cron
		会每分钟去读取一次 /etc/crontab 与 /var/spool/cron 里面的数据内容</span>
		』，因此，只要你编辑完 /etc/crontab 这个文件，并且将他储存之后，那么 
		cron 的配置就自动的会来运行了！</p>

		<div style="padding: 10pt 0pt;" align="right"><table width="90%"><tbody><tr><td><b>Tips:</b><br><span style="color: rgb(0, 144, 0);"><font size="-1">		在 Linux 底下的 crontab 会自动的帮我们每分钟重新读取一次 /etc/crontab 
		的例行工作事项，但是某些原因或者是其他的 Unix 系统中，由於 crontab 
		是读到内存当中的，所以在你修改完 /etc/crontab 之后，可能并不会马上运行，
		这个时候请重新启动 crond 这个服务吧！『/etc/init.d/crond restart』
		</font></span></td><td><img src="0430cron_files/vbird_face.gif" alt="鸟哥的图示" title="鸟哥的图示"></td></tr></tbody></table></div>
		<a name="etc_crontab"></a>
		<p>废话少说，我们就来看一下这个 /etc/crontab 的内容吧！</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">cat /etc/crontab</span>
SHELL=/bin/bash                     <span class="term_note">&lt;==使用哪种 shell 介面</span>
PATH=/sbin:/bin:/usr/sbin:/usr/bin  <span class="term_note">&lt;==运行档搜寻路径</span>
MAILTO=root                         <span class="term_note">&lt;==若有额外STDOUT，以 email将数据送给谁</span>
HOME=/                              <span class="term_note">&lt;==默认此 shell 的家目录所在</span>

# run-parts
01  *  *  *  *   root      run-parts /etc/cron.hourly   <span class="term_note">&lt;==每小时</span>
02  4  *  *  *   root      run-parts /etc/cron.daily    <span class="term_note">&lt;==每天</span>
22  4  *  *  0   root      run-parts /etc/cron.weekly   <span class="term_note">&lt;==每周日</span>
42  4  1  *  *   root      run-parts /etc/cron.monthly  <span class="term_note">&lt;==每个月 1 号</span>
<span class="term_say">分 时 日 月 周 运行者身份  命令串</span>
</pre></td></tr></tbody></table>

		<p>看到这个文件的内容你大概就了解了吧！呵呵，没错！这个文件与将刚刚我们下达 
		crontab -e 的内容几乎完全一模一样！只是有几个地方不太相同：</p>

		<ul>
		<li><span class="text_import1">MAILTO=root</span>：<br><br>
		这个项目是说，当 /etc/crontab 这个文件中的例行性工作的命令发生错误时，或者是该工作的运行结果有 
		STDOUT/STDERR 时，会将错误信息或者是萤幕显示的信息传给谁？默认当然是由系统直接寄发一封 mail 给 root 啦！不过，
		由於 root 并无法在用户端中以 POP3 之类的软件收信，因此，鸟哥通常都将这个 e-mail 
		改成自己的帐号，好让我随时了解系统的状况！例如： 
		<span class="text_import2">MAILTO=dmtsai@my.host.name</span><br><br></li>

		<li><span class="text_import1">PATH=....</span>：<br><br>
		还记得我们在<a href="0320bash.html#env">第十一章的 BASH</a> 当中一直提到的运行档路径问题吧！
		没错啦！这里就是输入运行档的搜寻路径！使用默认的路径配置就已经很足够了！<br><br></li>

		<li><span class="text_import1">01 * * * * root run-parts /etc/cron.hourly</span>：<br><br>
		这个 /etc/crontab 里面预配置义出四项工作任务，分别是每小时、每天、每周及每个月分别进行一次的工作！
		但是在五个栏位后面接的并不是命令，而是一个新的栏位，那就是『<span class="text_import2">运行后面那串命令的身份</span>』为何！这与使用者的 crontab -e 不相同。由於使用者自己的 
		crontab 并不需要指定身份，但 /etc/crontab 里面当然要指定身份啦！以上表的内容来说，系统默认的例行性工作是以 root
		的身份来进行的。<br><br>

		那么后面那串命令是什么呢？你可以使用『 <a href="0220filemanager.html#file_find_cmd">which</a> 
		run-parts 』搜寻看看，其实那是一个 bash script 啦！如果你直接进入 /usr/bin/run-parts 去看看，
		会发现这支命令会将后面接的『目录』内的所有文件捉出来运行！这也就是说『<span class="text_import2">
		如果你想让系统每小时主动帮你运行某个命令，将该命令写成 script，并将该文件放置到 /etc/cron.hourly/ 
		目录下即可</span>』的意思！<br><br>

		现在你知道系统是如何进行他默认的一堆例行性工作排程了吗？如果你下达『 ll /etc/cron.daily 』就可以看到一堆文件，
		那些文件就是系统提供的 script ，而这堆 scripts 将会在每天的凌晨 4:02 开始运行！这也是为啥如果你是夜猫族，
		就会发现奇怪的是，Linux 系统为何早上 4:02 开始会很忙碌的发出一些硬盘跑动的声音！因为他必须要进行
		makewhatis, updatedb, rpm rebuild 等等的任务嘛！
		</li></ul>

		<p>由於 CentOS 提供的 run-parts 这个 script 的辅助，因此 /etc/crontab 这个文件里面支持两种下达命令的方式，
		一种是直接下达命令，一种则是以目录来规划，例如：</p>

		<ul>
		<li><span class="text_import1">命令型态</span><br>
		<font face="'细明体'">01 * * * * dmtsai mail -s "testing" kiki &lt; /home/dmtsai/test.txt</font><br>
		以 dmtsai 这个使用者的身份，在每小时运行一次 mail 命令。<br><br></li>

		<li><span class="text_import1">目录规划</span><br>
		<font face="'细明体'">*/5 * * * * root run-parts /root/runcron</font><br>
		创建一个 /root/runcron 的目录，将要每隔五分钟运行的『可运行档』都写到该目录下，
		就可以让系统每五分钟运行一次该目录下的所有可运行档。</li>
		</ul>

		<p>好！你现在大概了解了这一个咚咚吧！OK！假设你现在要作一个目录，让系统可以每 
		2 分钟去运行这个目录下的所有可以运行的文件，你可以写下如下的这一行在 /etc/crontab 中：</p>
		<blockquote class="text_import2"><font face="'细明体'">*/2 * * * * root run-parts 
		/etc/cron.min</font></blockquote>

		<p>当然罗， /etc/cron.min 这个目录是需要存在的喔！那如果我需要运行的是一个『程序』而已，
		不需要用到一个目录呢？该如何是好？例如在侦测网络流量时，我们希望每五分钟侦测分析一次，
		可以这样写：</p>
		<blockquote class="text_import2"><font face="'细明体'">*/5 * * * * root 
		/bin/mrtg /etc/mrtg/mrtg.cfg</font></blockquote>

		<p>如何！创建例行性命令很简单吧！如果你是系统管理员而且你的工作又是系统维护方面的例行任务时，
		直接修改 /etc/crontab 这个文件即可喔！又便利，又方便管理呢！</p>
	</div>

	<hr><a name="security"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">一些注意事项</span><br>
	<div class="block2">
		<p>有的时候，我们以系统的 cron 来进行例行性工作的创建时，要注意一些使用方面的特性。
		举例来说，如果我们有四个工作都是五分钟要进行一次的，那么是否这四个动作全部都在同一个时间点进行？
		如果同时进行，该四个动作又很耗系统资源，如此一来，每五分钟不是会让系统忙得要死？
		呵呵！此时好好的分配一些运行时间就 OK 啦！所以，注意一下：<br><br></p>

		<hr><ul class="list1"><li class="text_import1">资源分配不均的问题</li></ul>

		<p>当大量使用 crontab 的时候，总是会有问题发生的，最严重的问题就是『系统资源分配不均』的问题，
		以鸟哥的系统为例，我有侦测主机流量的资讯，包括：</p>
		<ul>
		<li>流量</li>
		<li>区域内其他 PC 的流量侦测</li>
		<li>CPU 使用率</li>
		<li>RAM 使用率</li>
		<li>线上人数即时侦测</li></ul>
		<p>如果每个流程都在同一个时间启动的话，那么在某个时段时，我的系统会变的相当的繁忙，
		所以，这个时候就必须要分别配置啦！我可以这样做：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">vi /etc/crontab</span>
1,6,11,16,21,26,31,36,41,46,51,56 * * * * root  CMD1
2,7,12,17,22,27,32,37,42,47,52,57 * * * * root  CMD2
3,8,13,18,23,28,33,38,43,48,53,58 * * * * root  CMD3
4,9,14,19,24,29,34,39,44,49,54,59 * * * * root  CMD4
</pre></td></tr></tbody></table>

		<p>看到了没？那个『 , 』分隔的时候，请注意，不要有空白字节！（连续的意思）如此一来，
		则可以将每五分钟工作的流程分别在不同的时刻来工作！则可以让系统的运行较为顺畅呦！<br><br></p>

		<hr><ul class="list1"><li class="text_import1">取消不要的输出项目</li></ul>

		<p>另外一个困扰发生在『 <span class="text_import2">当有运行成果或者是运行的项目中有输出的数据时，该数据将会
		mail 给 MAILTO 配置的帐号</span> 』，好啦，那么当有一个排程一直出错（例如 DNS
		的侦测系统当中，若 DNS 上一级主机挂掉，那么你就会一直收到错误信息！）怎么办？呵呵！还记得<a href="0320bash.html#redirect">十一章谈到的数据流重导向</a>吧？
		直接以『命令重导向』将输出的结果输出到 <span class="text_import2">/dev/null</span> 
		这个垃圾桶当中就好了！<br><br></p>

		<hr><ul class="list1"><li class="text_import1">安全的检验</li></ul>

		<p>很多时候被植入木马都是以例行命令的方式植入的，所以可以藉由检查 /var/log/cron
		的内容来视察是否有『非您配置的 cron 被运行了？』这个时候就需要小心一点罗！<br><br></p>

		<hr><ul class="list1"><li class="text_import1">周与日月不可同时并存</li></ul>

		<p>另一个需要注意的地方在於：『你可以分别以周或者是日月为单位作为循环，但你不可使用「几月几号且为星期几」的模式工作』。
		这个意思是说，你不可以这样编写一个工作排程：</p>

<table class="term"><tbody><tr><td class="term"><pre>30 12 11 9 5 root echo "just test"   <span class="term_note">&lt;==这是错误的写法</span>
</pre></td></tr></tbody></table>

		<p>本来你以为九月十一号且为星期五才会进行这项工作，无奈的是，系统可能会判定每个星期五作一次，或每年的 9 月 11 
		号分别进行，如此一来与你当初的规划就不一样了～所以罗，得要注意这个地方！上述的写法是不对的喔！</p>
	</div>
</div>
<hr />
    </td>
    <td style="width: 16px; font-size: 6px;">　</td></tr>
<tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
</tbody></table>

<div style="padding-top: 0px; text-align: center;">
<span style="font-size: 80%;">
	<a href="http://linux.vbird.org/" target="_top" title="前往鸟哥的首页">http://linux.vbird.org</a>
	is designed by <a href="mailto:vbird@mail.vbird.idv.tw" title="联络鸟哥(我不要广告信！)">VBird</a>
		during 2001-2011. <a href="http://www.ksu.edu.tw/" target="_blank">ksu.edu</a></span>
         ﻿<div id="apDiv4">
      <p>本网页主要以Firefox配合解析度 1024x768 作为设计依据&nbsp;&nbsp;&nbsp;&nbsp; 鸟哥自由软件整合应用研究室</p></div></div>
</div>
</center>
</body></html>
