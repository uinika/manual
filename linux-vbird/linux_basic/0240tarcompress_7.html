<html><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf8">
	<meta name="Author" content="2011/04/17,lee">
	<meta name="Description" content="对 Linux 文件进行压缩与打包的动作命令介绍">
	<title>鸟哥的 Linux 私房菜 -- Linux 的文件压缩与打包</title>
    <script src="../script/SpryMenuBar.js" type="text/javascript"></script>
	<script src="../script/index.js" type="text/javascript"></script>
	<link href="../css/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
    <link href="../css/main.css" rel="stylesheet" type="text/css" />
    </head><body style="margin: 0pt; padding: 0pt;" class="table"onload="MM_preloadImages('../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html')">

<center>
<div id="apDiv5">
<div> <LINK REL="SHORTCUT ICON" HREF="../index-2.html">
<!-- ImageReady Slices (title3.ai) -->
<table id="___01" width="898" height="81" border="0" align="center" cellpadding="0" cellspacing="0";>
	<tr>
		<td colspan="15">
			<img src="image/title/title_01.png" width="900" height="1" alt=""></td>
	</tr>
	<tr>
		<td rowspan="4" bgcolor="#182448"><p><img src="http://linux.vbird.org/cgi-bin/Count.cgi?dd=C&amp;ft=5&amp;sh=T&amp;md=8&amp;pad=Y&amp;df=vbird.dic.ksu.edu.tw.dat" width="93" align="left" title="計數器" /></p>
	    <p><font color="#FFFFFF" size="-1">since2012/04/23</font></p></td>
		<td rowspan="4" align="left" valign="top"><a href="../index.html"><img src="image/title/title_03.png" alt="" width="263" height="79" border="0"></a></td>
		<td colspan="13">
			<img src="image/title/title_04.png" alt="" width="535" height="9" border="0"></td>
	</tr>
	<tr>
		<td rowspan="3">
			<img src="image/title/title_05.png" alt="" width="53" height="70" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="0110whatislinux.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image51','','image/title/title_06.png',1)"><img src="image/title/title3_06.png" name="Image51" width="106" height="25" border="0" id="Image51" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_07.png" alt="" width="27" height="37" border="0"></td>
		<td colspan="3" align="left" valign="top"><a href="../linux_server/0110network_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image52','','image/title/title_08.png',1)"><img src="image/title/title3_08.png" name="Image52" width="107" height="25" border="0" id="Image52" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_09.png" alt="" width="37" height="37" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../about.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image53','','image/title/title_10.png',1)"><img src="image/title/title3_10.png" name="Image53" width="75" height="25" border="0" id="Image53" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_11.png" alt="" width="35" height="70" border="0"></td>
		<td align="left" valign="top"><a href="mailto:vbird@mail.vbird.idv.tw" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image54','','image/title/title_12.png',1)"><img src="image/title/title3_12.png" name="Image54" width="74" height="25" border="0" id="Image54" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_13.png" alt="" width="21" height="70" border="0"></td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="image/title/title_14.png" alt="" width="106" height="12" border="0"></td>
		<td colspan="3">
			<img src="image/title/title_15.png" alt="" width="107" height="12" border="0"></td>
		<td colspan="2">
			<img src="image/title/title_16.png" width="75" height="12" alt=""></td>
		<td rowspan="2">
			<img src="image/title/title_17.png" alt="" width="74" height="45" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/title_18.png" alt="" width="15" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar1" class="MenuBarHorizontal">
	  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image44','','image/title/title_19.png',1)"><img src="image/title/title3_19.png" name="Image44" width="123" height="33" border="0" id="Image44" /></a>
			    <ul>
			      <li><a href="Mandrake9.0/mandrake9.0.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image46','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image46" width="120" height="26" border="0" id="Image46" alt="" /></a></li>
                  <li><a href="fedora_4/fc4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image47','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image47" width="120" height="26" border="0" id="Image47" alt="" /></a></li>
                  <li><a href="linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image48','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image48" width="120" height="26" border="0" id="Image48" alt="" /></a></li>
                </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_20.png" alt="" width="42" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar2" class="MenuBarHorizontal">
	  <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image45','','image/title/title_21.png',1)"><img src="image/title/title3_21.png" name="Image45" width="125" height="33" border="0" id="Image45" /></a>
			    <ul>
			      <li><a href="../linux_server/linux_redhat9/redhat9.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image43','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image43" width="120" height="26" border="0" id="Image43" alt=""/></a></li>
			      <li><a href="../linux_server/centos4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image49','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image49" width="120" height="26" border="0" id="Image49" alt="" /></a></li>
			      <li><a href="../linux_server/index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image50','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image50" width="120" height="26" border="0" id="Image50" alt="" /></a></li>
		        </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_22.png" alt="" width="47" height="33" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/Spacer.gif" width="101" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="263" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="53" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="15" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="91" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="27" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="5" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="42" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="60" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="37" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="28" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="47" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="35" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="74" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="22" height="1" alt=""></td>
	</tr>
</table>
<!-- End ImageReady Slices -->
<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</div>
<table summary="本文内容的排版" style="width: 898px;" border="0" cellpadding="0" cellspacing="0">
<tbody><tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
<tr><td style="width: 16px; font-size: 6px;">　</td>
    <td width="866">
<!-- 本文的档头部分 -->
<div style="text-align: center;">
    <a href="0240tarcompress.html">
    <span class="text_head0">第九章、文件与文件系统的压缩与打包</span></a><br>
</div>
    <div style="text-align: right;">
        <span class="text_history">最近升级日期：2009/08/20</span>
    </div>
<!-- 本文的连结区部分 -->
<div class="block1">
<span class="text_h1">
7. <a href="#hint">重点回顾</a><br>
8. <a href="#ex">本章习题</a><br>
9. <a href="#reference">参考数据与延伸阅读</a><br>
<span class="text_h2">
10. <a href="http://phorum.vbird.org/viewtopic.php?t=23882" target="_blank">针对本文的建议：http://phorum.vbird.org/viewtopic.php?t=23882</a>
</span>
</span></div>
<!-- 本文的正式部分 -->
<hr><a name="hint"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">重点回顾</span><br>
<div class="block1">
<ul class="text_import2">
	<li>压缩命令为透过一些运算方法去将原本的文件进行压缩，以减少文件所占用的磁碟容量。
		压缩前与压缩后的文件所占用的磁碟容量比值， 就可以被称为是『压缩比』</li>
	<li>压缩的好处是可以减少磁碟容量的浪费，在 WWW 网站也可以利用文件压缩的技术来进行数据的传送，好让网站频宽的可利用率上升喔</li>
	<li>压缩文件的扩展名大多是：『*.tar, *.tar.gz, *.tgz, *.gz, *.Z, *.bz2』</li>
	<li>常见的压缩命令有 gzip  与 bzip2 ，其中 bzip2 压缩比较之 gzip 还要更好，建议使用 bzip2 ！</li>
	<li>tar 可以用来进行文件打包，并可支持 gzip 或 bzip2 的压缩。</li>
	<li>压　缩：tar -jcv -f filename.tar.bz2 要被压缩的文件或目录名称</li>
	<li>查　询：tar -jtv -f filename.tar.bz2</li>
	<li>解压缩：tar -jxv -f filename.tar.bz2 -C 欲解压缩的目录</li>
	<li>dump 命令可备份文件系统或单一目录</li>
	<li>dump 的备份若针对文件系统时，可进行 0-9 的 level 差异备份！其中 level 0 为完整备份；</li>
	<li>restore 命令可还原被 dump 建置的备份档；</li>
	<li>要创建光盘烧录数据时，可透过 mkisofs 命令来建置；</li>
	<li>可透过 cdrecord 来写入 CD  或 DVD 烧录机</li>
	<li>dd 可备份完整的 partition 或 disk ，因为 dd 可读取磁碟的 sector 表面数据</li>
	<li>cpio 为相当优秀的备份命令，不过必须要搭配类似 find 命令来读入欲备份的档名数据，方可进行备份动作。</li>
</ul>
</div>


<hr><a name="ex"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">本章习题</span><br>
(要看答案请将鼠标移动到『答：』底下的空白处，按下左键圈选空白处即可察看)
<div class="block1">
<ul>
	<li>情境模拟题一：你想要让系统恢复到第八章情境模拟后的结果，亦即仅剩下 /dev/hdc6 以前的 partition，
		本章练习产生的 partition 都需要恢复原状。因此 /dev/hdc8, /dev/hdc9 (在本章练习过程中产生的)
		请将他删除！删除的方法同第八章的情境模拟题一所示。<br><br></li>

	<li>情境模拟题二：你想要逐时备份 /srv/myproject 这个目录内的数据，又担心每次备份的资讯太多，
		因此想要使用 dump 的方式来逐一备份数据到 /backups 这个目录下。该如何处理？<br><br>
		<ul>
		<li>目标：了解到 dump 以及各个不同 level 的作用；</li>
		<li>前提：被备份的数据为单一 partition ，亦即本例中的 /srv/myproject</li>
		<li>需求：/srv/myproject 为单一 filesystem ，且在 /etc/fstab 内此挂载点的 dump 栏位为 1</li>
		</ul><br>

		实际处理的方法其实还挺简单的！我们可以这样做看看：<br><br>

		<ol>
		<li>先替该目录制作一些数据，亦即复制一些东西过去吧！<br>
		<span class="text_import1">cp -a /etc /boot /srv/myproject</span><br><br></li>

		<li>开始进行 dump ，记得，一开始是使用 level 0 的完整备份喔！<br>
		<span class="text_import1">mkdir /backups<br>
		dump -0u -j -f /backups/myproject.dump /srv/myproject</span><br>
		上面多了个 -j 的选项，目的是为了要进行压缩，减少备份的数据量。<br><br></li>

		<li>尝试将 /srv/myproject 这个文件系统加大，将 /var/log/ 的数据复制进去吧！<br>
		<span class="text_import1">cp -a /var/log/ /srv/myproject</span><br>
		此时原本的 /srv/myproject 已经被改变了！继续进行备份看看！<br><br></li>

		<li>将 /srv/myproject 以 level 1 来进行备份：<br>
		<span class="text_import1">dump -1u -j -f /backups/myproject.dump.1 /srv/myproject<br>
		ls -l /backups</span><br>
		你应该就会看到两个文件，其中第二个文件 (myproject.dump.1) 会小的多！这样就搞定罗备份数据！</li>
		</ol><br></li>

		<li>情境模拟三：假设过了一段时间后，你的 /srv/myproject 变的怪怪的，你想要将该 filesystem 以刚刚的备份数据还原，
		此时该如何处理呢？你可以这样做的：<br><br>

		<ol>
		<li>先将 /srv/myproject 卸载，并且将该 partition 重新格式化！<br>
		<span class="text_import1">umount /dev/hdc6<br>
		mkfs -t ext3 /dev/hdc6</span><br><br></li>
		<li>重新挂载原本的 partition ，此时该目录内容应该是空的！<br>
		<span class="text_import1">mount -a</span><br>
		你可以自行使用 df 以及 ls -l /srv/myproject 查阅一下该目录的内容，是空的啦！<br><br></li>
		<li>将完整备份的 level 0 的文件 /backups/myproject.dump 还原回来：<br>
		<span class="text_import1">cd /srv/myproject<br>
		restore -r -f /backups/myproject.dump</span><br>
		此时该目录的内容为第一次备份的状态！还需要进行后续的处理才行！<br><br></li>
		<li>将后续的 level 1 的备份也还原回来：<br>
		<span class="text_import1">cd /srv/myproject<br>
		restore -r -f /backups/myproject.dump.1</span><br>
		此时才是恢复到最后一次备份的阶段！如果还有 level 2, level 3 时，就得要一个一个的依序还原才行！</li>
		</ol></li>
</ul>
</div>


<hr><a name="reference"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">参考数据与延伸阅读</span><br>
<div class="block1">
<ul>
	<li>台湾学术网络管理文件：Backup Tools in UNIX(Linux):<br><a href="http://nmc.nchu.edu.tw/tanet/backup_tools_in_unix.htm" target="_blank">http://nmc.nchu.edu.tw/tanet/backup_tools_in_unix.htm</a><br></li>
	<li>中文 How to 文件计画 (CLDP)：<a href="http://www.linux.org.tw/CLDP/HOWTO/hardware/CD-Writing-HOWTO/CD-Writing-HOWTO-3.html" target="_blank">http://www.linux.org.tw/CLDP/HOWTO/hardware/CD-Writing-HOWTO/CD-Writing-HOWTO-3.html</a></li>
	<li>熊宝贝工作记录之： Linux 烧录实作：<a href="http://csc.ocean-pioneer.com/docum/linux_burn.html" target="_blank">http://csc.ocean-pioneer.com/docum/linux_burn.html</a></li>
	<li>PHP5 网管实验室： <a href="http://www.php5.idv.tw/html.php?mod=article&amp;do=show&amp;shid=26" target="_blank">http://www.php5.idv.tw/html.php?mod=article&amp;do=show&amp;shid=26</a></li>
	<li>CentOS 5.x 之 man dump</li>
	<li>CentOS 5.x 之 man restore</li>
</ul>
</div>
