<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-TW" lang="zh-TW"><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf8">
	<meta name="Author" content="VBird, 鸟哥">
	<meta name="Description" content="Dynamic Host Configuration Protocol 主机的设定问题(类似 IP 分享器的后端功能)">
	<title>鸟哥的 Linux 私房菜 -- DHCP 服务器</title>
    <script src="../script/SpryMenuBar.js" type="text/javascript"></script>
	<script src="../script/index.js" type="text/javascript"></script>
	<link href="../css/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
    <link href="../css/main.css" rel="stylesheet" type="text/css" />
    </head><body style="margin: 0pt; padding: 0pt;" class="table"onload="MM_preloadImages('../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html')">

<center>
<div id="apDiv5">
<div> <LINK REL="SHORTCUT ICON" HREF="../index-2.html">
<!-- ImageReady Slices (title3.ai) -->
<table id="___01" width="898" height="81" border="0" align="center" cellpadding="0" cellspacing="0";>
	<tr>
		<td colspan="15">
			<img src="image/title/title_01.png" width="900" height="1" alt=""></td>
	</tr>
	<tr>
		<td rowspan="4" bgcolor="#182448"><p><img src="http://linux.vbird.org/cgi-bin/Count.cgi?dd=C&amp;ft=5&amp;sh=T&amp;md=8&amp;pad=Y&amp;df=vbird.dic.ksu.edu.tw.dat" width="93" align="left" title="計數器" /></p>
	    <p><font color="#FFFFFF" size="-1">since2012/04/23</font></p></td>
		<td rowspan="4" align="left" valign="top"><a href="../index.html"><img src="image/title/title_03.png" alt="" width="263" height="79" border="0"></a></td>
		<td colspan="13">
			<img src="image/title/title_04.png" alt="" width="535" height="9" border="0"></td>
	</tr>
	<tr>
		<td rowspan="3">
			<img src="image/title/title_05.png" alt="" width="53" height="70" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../linux_basic/0110whatislinux.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image51','','image/title/title_06.png',1)"><img src="image/title/title3_06.png" name="Image51" width="106" height="25" border="0" id="Image51" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_07.png" alt="" width="27" height="37" border="0"></td>
		<td colspan="3" align="left" valign="top"><a href="0110network_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image52','','image/title/title_08.png',1)"><img src="image/title/title3_08.png" name="Image52" width="107" height="25" border="0" id="Image52" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_09.png" alt="" width="37" height="37" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../about.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image53','','image/title/title_10.png',1)"><img src="image/title/title3_10.png" name="Image53" width="75" height="25" border="0" id="Image53" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_11.png" alt="" width="35" height="70" border="0"></td>
		<td align="left" valign="top"><a href="mailto:vbird@mail.vbird.idv.tw" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image54','','image/title/title_12.png',1)"><img src="image/title/title3_12.png" name="Image54" width="74" height="25" border="0" id="Image54" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_13.png" alt="" width="21" height="70" border="0"></td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="image/title/title_14.png" alt="" width="106" height="12" border="0"></td>
		<td colspan="3">
			<img src="image/title/title_15.png" alt="" width="107" height="12" border="0"></td>
		<td colspan="2">
			<img src="image/title/title_16.png" width="75" height="12" alt=""></td>
		<td rowspan="2">
			<img src="image/title/title_17.png" alt="" width="74" height="45" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/title_18.png" alt="" width="15" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar1" class="MenuBarHorizontal">
	  <li><a href="../linux_basic/linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image44','','image/title/title_19.png',1)"><img src="image/title/title3_19.png" name="Image44" width="123" height="33" border="0" id="Image44" /></a>
			    <ul>
			      <li><a href="../linux_basic/Mandrake9.0/mandrake9.0.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image46','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image46" width="120" height="26" border="0" id="Image46" alt="" /></a></li>
                  <li><a href="../linux_basic/fedora_4/fc4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image47','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image47" width="120" height="26" border="0" id="Image47" alt="" /></a></li>
                  <li><a href="../linux_basic/linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image48','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image48" width="120" height="26" border="0" id="Image48" alt="" /></a></li>
                </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_20.png" alt="" width="42" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar2" class="MenuBarHorizontal">
	  <li><a href="index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image45','','image/title/title_21.png',1)"><img src="image/title/title3_21.png" name="Image45" width="125" height="33" border="0" id="Image45" /></a>
			    <ul>
			      <li><a href="linux_redhat9/redhat9.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image43','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image43" width="120" height="26" border="0" id="Image43" alt=""/></a></li>
			      <li><a href="centos4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image49','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image49" width="120" height="26" border="0" id="Image49" alt="" /></a></li>
			      <li><a href="index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image50','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image50" width="120" height="26" border="0" id="Image50" alt="" /></a></li>
		        </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_22.png" alt="" width="47" height="33" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/Spacer.gif" width="101" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="263" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="53" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="15" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="91" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="27" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="5" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="42" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="60" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="37" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="28" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="47" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="35" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="74" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="22" height="1" alt=""></td>
	</tr>
</table>
<!-- End ImageReady Slices -->
<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</div>
<table summary="本文内容的排版" style="width: 898px;" border="0" cellpadding="0" cellspacing="0">
<tbody><tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
<tr><td style="width: 16px; font-size: 6px;">　</td>
    <td width="866">

<!-- 本文的档头部分 -->
<div style="text-align:center">
    <a href="http://linux.vbird.org/linux_server/0340dhcp.php">
    <span class="text_head0">第十二章、网络参数控管者：<span class="text_head_en"> DHCP </span>服务器</span></a><br>
</div>
    <div style="text-align:right">
        <span class="text_history">最近更新日期：2011/07/27</span>
    </div>
<!-- 本文的连结区部分 -->
<div class="block1">
<span class="text_h1">
12.3 <a href="#client">DHCP 客户端的设定</a><br>
	<span class="text_h2">
	　　12.3.1 <a href="#client_linux">客户端是 Linux</a><br>
	　　12.3.2 <a href="#client_win">客户端是 Windows</a><br>
	</span>
</span></div>
<!-- 本文的正式部分 -->
<hr><a name="client"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">12.3 DHCP 客户端的设定</span><br>
<div class="block1">
	<p>DHCP 的客户端可以是 Windows 也可以是 Linux 呢！鸟哥的网域内使用三部计算机，就如图 3.2-1 所示的那样。
	Linux 与 Windows XP 的设定方式已经分别在第四章与第三章谈过了，底下就稍微介绍过而已。至于图示的部分，
	我们主要是以 Windows 7 来做介绍啰。<br><br></p>

	<hr><a name="client_linux"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">12.3.1 客户端是 Linux</span><br>
	<div class="block2">
		<p>Linux 的网络参数设定还记得吧？不记得的话就得要打屁股了！在<a href="http://linux.vbird.org/linux_server/0130internet_connect.php#connect_auto" target="_blank">第四章 (4.2.2)</a> 我们谈过自动取得 IP 的方式，设定真的很简单：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@clientlinux ~]# <span class="term_command">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span>
DEVICE=eth0
NM_CONTROLLED=no
ONBOOT=yes
<span class="term_write">BOOTPROTO=dhcp</span>  <span class="term_note">&lt;==就是他！指定这一个就对了！</span>

[root@clientlinux ~]# <span class="term_command">/etc/init.d/network restart</span>
</pre></td></tr></tbody></table>

		<p>同时记得要拿掉预设路由的设定喔！改完之后，就将我们的整个网络重新启动即可 
		(不要使用 ifdown 与 ifup ，因为还有预设路由要设定！)。请注意，如果你是在远程进行这个动作，
		你的联机『肯定会挂掉！』，因为网络卡被你关了嘛！呵呵！所以请在本机前面才进行喔！如果执行的结果有找到正确的 
		DHCP 主机，那么几个档案可能会被更动喔：</p>

<table class="term"><tbody><tr><td class="term"><pre><span class="term_hd"># 1. DNS 的 IP 会被更动呢！查阅一下 resolv.conf 先：</span>
[root@clientlinux ~]# <span class="term_command">cat /etc/resolv.conf</span>
search centos.vbird      <span class="term_note">&lt;==还记得设定过 domain-name 否？</span>
domain centos.vbird      <span class="term_note">&lt;==还记得设定过 domain-name 否？</span>
nameserver 168.95.1.1    <span class="term_note">&lt;==这就是我们在 dhcpd.conf内的设定值</span>
nameserver 139.175.10.20

<span class="term_hd"># 2. 观察一下路由啦！</span>
[root@clientlinux ~]# <span class="term_command">route -n</span>
Kernel IP routing table
Destination    Gateway         Genmask        Flags Metric Ref  Use Iface
192.168.100.0  0.0.0.0         255.255.255.0  U     0      0      0 eth0
0.0.0.0        <span class="term_write">192.168.100.254</span> 0.0.0.0        UG    0      0      0 eth0
<span class="term_say"># 嗯！没错！路由也被正确的捉到了！OK的啦！</span>

<span class="term_hd"># 3. 察看一下客户端的指令吧！</span>
[root@clientlinux ~]# <span class="term_command">netstat -tlunp | grep dhc</span>
Proto Recv-Q Send-Q Local Address  Foreign Address State  PID/Program name
udp        0      0 <span class="term_write">0.0.0.0:68</span>     0.0.0.0:*              1694/dhclient
<span class="term_say"># 你没看错！确实是有个小程序在监测 DHCP 的联机状态吶！</span>

<span class="term_hd"># 4. 看一看客户端租约所记载的信息吧！</span>
[root@clientlinux ~]# <span class="term_command">cat /var/lib/dhclient/dhclient*</span>
lease {
  interface "eth0";
  fixed-address 192.168.100.101; <span class="term_note">&lt;==取得的 IP 呦！</span>
  option subnet-mask 255.255.255.0;
  option routers 192.168.100.254;
  option dhcp-lease-time 259200;
  option dhcp-message-type 5;
  option domain-name-servers 168.95.1.1,139.175.10.20;
  option dhcp-server-identifier 192.168.100.254;
  option domain-name "centos.vbird";
  renew 4 2011/07/28 05:01:24; <span class="term_note">&lt;==下一次预计更新 (renew) 的时间点</span>
  rebind 5 2011/07/29 09:06:36;
  expire 5 2011/07/29 18:06:36;
}
<span class="term_say"># 这个档案会记录该适配卡所曾经要求过的 DHCP 信息喔！重要！
# 有没有看出来，他几乎就与你设定的 /etc/dhcp/dhcpd.conf 类似？ ^_^</span>
</pre></td></tr></tbody></table>

		<p>有没有发现其实你的客户端取得的数据都被记载在 /var/lib/dhclient/dhclient*-eth0.leases 里头啊？
		如果你有多张网卡，那么每张网卡自己的 DHCP 要求就会被写入到不同档名的档案当中去！
		观察该档案就知道你的数据是如何啰！这可也是挺重要的呦！</p>

		<div style="padding: 10pt 0pt 10pt 0pt ;" align="right"><table width="90%"><tbody><tr><td><b>Tips:</b><br><span style="color : #009000"><font size="-1">		你或许会问说， dhcp 不是都会随机取得 IP 吗？那为什么这部客户端 clientlinux.centos.vbird 每次都能够取得相同的固定 IP 呢？
		很简单，因为上头的 dhclient-eth0.leases 里面的 fixed-address 指定了想要固定 IP 的选项。如果 DHCP 
		服务器的该 IP 没有被用走，也在规定的 range 设定值内，那就会发放给你这个 IP 了。如果你想要不同的 IP 呢？
		那就将你想要的 IP 取代上述的设定值啦！
		</font></span></td><td><img src="0340dhcp_files/vbird_face.gif" alt="鸟哥的图示" title="鸟哥的图示"></td></tr></tbody></table></div>
<table width="90%" border="1" cellpadding="5" cellspacing="0"><tbody><tr><td>
例题：<div class="block2">
在文献中谈到，如果区网内有多个 DHCP 服务器 (假设有 DHCP1, DHCP2)，那么每次客户端对整个物理网络区段广播时，DHCP 服务器将是先抢先赢的局面。
但是若第一次取得 DHCP1 服务器的 IP 后，未来重新启动网络，都只会取得 DHCP1 的网络参数，这是为什么？
</div>
答：<div class="block2">
看到上述的 dhclient-eth0.leases 客户端档案了吗？因为你的主机想要取得上次取得的网络参数，因此将会对 DHCP1 要求网络参数。
如果你想要使用先抢先赢的方式来取得 IP ，或者想要使用 DHCP2 来取得 IP ，那么得要修订或者删除 dhclient-eth0.leases 才行。
</div>
</td></tr></tbody></table><br>
	</div>

	<hr><a name="client_win"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">12.3.2 客户端是 Windows</span><br>
	<div class="block2">
		<p>在 Windows 底下设定 DHCP 协议以取得 IP 实在是很简单喔！例如，你可以到第三章的
		<a href="http://linux.vbird.org/linux_server/0120intranet.php#protocol_win">3.2.2</a> 小节去瞧瞧如何设定的撷取图示。
		我们这里以 Windows 7 作为介绍好了。你可以依据『开始』--&gt;『控制台』--&gt;『检视网络状态及工作』
		--&gt;『变更适配卡设定』，在出现的图示中，选择属于你的相关网卡，然后连击两下之后，就开始底下的设定程序：</p>

		<ol>
		<li>如上所述，点击网络卡设定后，会出现如下图示：<br><br>

		<center><img src="0340dhcp_files/win7_1.gif" alt="局域网络的 Windows 7 系统设定 DHCP 的方式" title="局域网络的 Windows 7 系统设定 DHCP 的方式" border="1"><br>
		图 12.3-1、局域网络的 Windows 7 系统设定 DHCP 的方式<br><br></center></li>

		<li>在图 12.3-1 的地方按下箭头所指的『内容』处，就会出现如下画面啰：<br><br>

		<center><img src="0340dhcp_files/win7_2.gif" alt="局域网络的 Windows 7 系统设定 DHCP 的方式" title="局域网络的 Windows 7 系统设定 DHCP 的方式" border="1"><br>
		图 12.3-2、局域网络的 Windows 7 系统设定 DHCP 的方式<br><br></center>

		在上面的画面当中，先点选 TCP/IP4 第四版 IP 协议，然后按下『内容』就可以开始来修改网络参数啰！<br><br></li>

		<li>接下来如下图所示，你只要勾选『自动取得 IP 地址』那个项目，然后按下『确定』并离开设定画面，
		如此一来 Windows 就会开始自动取得 IP 的工作了。<br><br>

		<center><img src="0340dhcp_files/win7_3.gif" alt="局域网络的 Windows 7 系统设定 DHCP 的方式" title="局域网络的 Windows 7 系统设定 DHCP 的方式" border="1"><br>
		图 12.3-3、局域网络的 Windows 7 系统设定 DHCP 的方式<br><br></center></li>

		<li>那你如何确认你的 IP 已经被顺利的取得呢？如果是在早期的 Windows 95 ，你可以使用一个名为『 winipcfg 』
		来观察你的 IP 设定。不过在 windows 2000 以后，你可能需要使用命令提示字符来观察才行。你可以使用：
		『开始』--&gt;『所有程序』--&gt;『附属应用程序』--&gt;『命令提示字符』来取出终端机，然后这样处理看看：<br>

<table class="term"><tbody><tr><td class="term"><pre>C:\Users\win7&gt; <span class="term_command">ipconfig /all</span>
<span class="term_say">....(前面省略)....</span>
以太网络卡 区域联机:

   联机特定 DNS 后缀 . . . . . . . . : centos.vbird
   描述 . . . . . . . . . . . . . . .: Intel(R) PRO/1000 MT Desktop Adapter
   实体地址 . . . . . . . . . . . . .: 08-00-27-11-EB-C2
   DHCP 已启用 . . . . . . . . . . . : 是
   自动设定启用 . . . . . . . . . . .: 是
   链接-本机 IPv6 地址 . . . . . . . : fe80::ec92:b907:bc2a:a5fa%11(偏好选项)
   IPv4 地址 . . . . . . . . . . . . : 192.168.100.30(偏好选项) <span class="term_note">&lt;==这是取得的IP</span>
   子网掩码 . . . . . . . . . . . .: 255.255.255.0
   租用取得 . . . . . . . . . . . . .: 2011年7月27日 上午 11:59:18 <span class="term_note">&lt;==这是租约</span>
   租用到期 . . . . . . . . . . . . .: 2011年7月30日 上午 11:59:18
   预设网关 . . . . . . . . . . . . .: 192.168.100.254
   DHCP 服务器 . . . . . . . . . . . : 192.168.100.254  <span class="term_note">&lt;==这一部 DHCP 服务器</span>
   DNS 服务器 . . . . . . . . . . . .: 168.95.1.1       <span class="term_note">&lt;==取得的 DNS</span>
                                       139.175.10.20
   NetBIOS over Tcpip . . . . . . . .: 启用

C:\Users\win7&gt; <span class="term_command">ipconfig /renew</span>
<span class="term_say"># 这样可以立即要求更新 IP 信息喔！</span>
</pre></td></tr></tbody></table>

		这样就 OK 的啦！简单吧！</li>
		</ol>
	</div>
</div>
<hr />
    </td>
    <td style="width: 16px; font-size: 6px;">　</td></tr>
<tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
</tbody></table>

<div style="padding-top: 0px; text-align: center;">
<span style="font-size: 80%;">
	<a href="http://linux.vbird.org/" target="_top" title="前往鸟哥的首页">http://linux.vbird.org</a>
	is designed by <a href="mailto:vbird@mail.vbird.idv.tw" title="联络鸟哥(我不要广告信！)">VBird</a>
		during 2001-2011. <a href="http://www.ksu.edu.tw/" target="_blank">ksu.edu</a></span>
         ﻿<div id="apDiv4">
      <p>本网页主要以Firefox配合解析度 1024x768 作为设计依据&nbsp;&nbsp;&nbsp;&nbsp; 鸟哥自由软件整合应用研究室</p></div></div>
</div>
</center>
</body></html>
