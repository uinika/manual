<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-TW" lang="zh-TW"><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf8">
	<meta name="Author" content="VBird, 鸟哥">
	<meta name="Description" content="关于 domain name server 的设定方法介绍喔！">
	<title>鸟哥的 Linux 私房菜 -- DNS Server</title>
    <script src="../script/SpryMenuBar.js" type="text/javascript"></script>
	<script src="../script/index.js" type="text/javascript"></script>
	<link href="../css/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
    <link href="../css/main.css" rel="stylesheet" type="text/css" />
    </head><body style="margin: 0pt; padding: 0pt;" class="table"onload="MM_preloadImages('../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html')">

<center>
<div id="apDiv5">
<div> <LINK REL="SHORTCUT ICON" HREF="../index-2.html">
<!-- ImageReady Slices (title3.ai) -->
<table id="___01" width="898" height="81" border="0" align="center" cellpadding="0" cellspacing="0";>
	<tr>
		<td colspan="15">
			<img src="image/title/title_01.png" width="900" height="1" alt=""></td>
	</tr>
	<tr>
		<td rowspan="4" bgcolor="#182448"><p><img src="http://linux.vbird.org/cgi-bin/Count.cgi?dd=C&amp;ft=5&amp;sh=T&amp;md=8&amp;pad=Y&amp;df=vbird.dic.ksu.edu.tw.dat" width="93" align="left" title="計數器" /></p>
	    <p><font color="#FFFFFF" size="-1">since2012/04/23</font></p></td>
		<td rowspan="4" align="left" valign="top"><a href="../index.html"><img src="image/title/title_03.png" alt="" width="263" height="79" border="0"></a></td>
		<td colspan="13">
			<img src="image/title/title_04.png" alt="" width="535" height="9" border="0"></td>
	</tr>
	<tr>
		<td rowspan="3">
			<img src="image/title/title_05.png" alt="" width="53" height="70" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../linux_basic/0110whatislinux.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image51','','image/title/title_06.png',1)"><img src="image/title/title3_06.png" name="Image51" width="106" height="25" border="0" id="Image51" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_07.png" alt="" width="27" height="37" border="0"></td>
		<td colspan="3" align="left" valign="top"><a href="0110network_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image52','','image/title/title_08.png',1)"><img src="image/title/title3_08.png" name="Image52" width="107" height="25" border="0" id="Image52" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_09.png" alt="" width="37" height="37" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../about.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image53','','image/title/title_10.png',1)"><img src="image/title/title3_10.png" name="Image53" width="75" height="25" border="0" id="Image53" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_11.png" alt="" width="35" height="70" border="0"></td>
		<td align="left" valign="top"><a href="mailto:vbird@mail.vbird.idv.tw" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image54','','image/title/title_12.png',1)"><img src="image/title/title3_12.png" name="Image54" width="74" height="25" border="0" id="Image54" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_13.png" alt="" width="21" height="70" border="0"></td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="image/title/title_14.png" alt="" width="106" height="12" border="0"></td>
		<td colspan="3">
			<img src="image/title/title_15.png" alt="" width="107" height="12" border="0"></td>
		<td colspan="2">
			<img src="image/title/title_16.png" width="75" height="12" alt=""></td>
		<td rowspan="2">
			<img src="image/title/title_17.png" alt="" width="74" height="45" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/title_18.png" alt="" width="15" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar1" class="MenuBarHorizontal">
	  <li><a href="../linux_basic/linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image44','','image/title/title_19.png',1)"><img src="image/title/title3_19.png" name="Image44" width="123" height="33" border="0" id="Image44" /></a>
			    <ul>
			      <li><a href="../linux_basic/Mandrake9.0/mandrake9.0.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image46','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image46" width="120" height="26" border="0" id="Image46" alt="" /></a></li>
                  <li><a href="../linux_basic/fedora_4/fc4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image47','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image47" width="120" height="26" border="0" id="Image47" alt="" /></a></li>
                  <li><a href="../linux_basic/linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image48','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image48" width="120" height="26" border="0" id="Image48" alt="" /></a></li>
                </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_20.png" alt="" width="42" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar2" class="MenuBarHorizontal">
	  <li><a href="index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image45','','image/title/title_21.png',1)"><img src="image/title/title3_21.png" name="Image45" width="125" height="33" border="0" id="Image45" /></a>
			    <ul>
			      <li><a href="linux_redhat9/redhat9.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image43','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image43" width="120" height="26" border="0" id="Image43" alt=""/></a></li>
			      <li><a href="centos4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image49','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image49" width="120" height="26" border="0" id="Image49" alt="" /></a></li>
			      <li><a href="index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image50','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image50" width="120" height="26" border="0" id="Image50" alt="" /></a></li>
		        </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_22.png" alt="" width="47" height="33" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/Spacer.gif" width="101" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="263" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="53" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="15" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="91" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="27" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="5" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="42" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="60" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="37" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="28" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="47" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="35" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="74" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="22" height="1" alt=""></td>
	</tr>
</table>
<!-- End ImageReady Slices -->
<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</div>
<table summary="本文内容的排版" style="width: 898px;" border="0" cellpadding="0" cellspacing="0">
<tbody><tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
<tr><td style="width: 16px; font-size: 6px;">　</td>
    <td width="866">

<!-- 本文的档头部分 -->
<div style="text-align:center">
    <a href="http://linux.vbird.org/linux_server/0350dns.php">
    <span class="text_head0">第十九章、主机名控制者：<span class="text_head_en"> DNS </span>服务器</span></a><br>
</div>
    <div style="text-align:right">
        <span class="text_history">最近更新日期：2011/08/05</span>
    </div>
<!-- 本文的连结区部分 -->
<div class="block1">
<span class="text_h1">
19.2 <a href="#DNS_resolver">Client 端的设定</a><br>
	<span class="text_h2">
	　　19.2.1 <a href="#DNS_resolver_file">相关配置文件： /etc/hosts, /etc/resolv.conf, /etc/nsswitch.conf</a><br>
	　　19.2.2 <a href="#DNS_resolver_cmd">DNS 的正、反解查询指令</a>： <a href="#host">host</a>, 
		<a href="#nslookup">nslookup</a>, <a href="#dig">dig</a><br>
	　　19.2.3 <a href="#DNS_resolver_whois">查询领域管理者相关信息： whois</a><br>
	</span>
</span></div>
<!-- 本文的正式部分 -->
<hr><a name="DNS_resolver"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">19.2 Client 端的设定</span><br>
<div class="block1">
	<p>由于 DNS 是每部想要连上因特网的主机都得要设定的，因此我们就从简单的客户端设定谈起。因为未来架设好 DNS
	server 后，我们都会直接进行测试，所以，这个部分得先处理处理比较妥当啊！<br><br></p>

	<hr><a name="DNS_resolver_file"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">19.2.1 相关配置文件</span><br>
	<div class="block2">
		<p>从 <a href="#Whatisdns">19.1.1</a> 的说明当中我们晓得主机名对应到 IP 有两种方法，早期的方法是直接写在档案里面来对应，
		后来比较新的方法则是透过 DNS 架构！那么这两种方法分别使用什么配置文件？可不可以同时存在？
		若同时存在时，那个方法优先？嗯！我们先来谈一谈几个配置文件吧！</p>

		<ul class="text_import2">
		<li>/etc/hosts ：这个是最早的 hostname 对应 IP 的档案；</li>
		<li>/etc/resolv.conf ：这个重要！就是 ISP 的 DNS 服务器 IP 记录处；</li>
		<li>/etc/nsswitch.conf：这个档案则是在『决定』先要使用 /etc/hosts 还是 /etc/resolv.conf 的设定！</li>
		</ul>

		<p>一般而言， Linux 的预设主机名与 IP 的对应搜寻都以 /etc/hosts 为优先，为什么呢？你可以查看一下 
		/etc/nsswitch.conf ，并找到 hosts 的项目：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">vim /etc/nsswitch.conf</span>
hosts:      files dns
</pre></td></tr></tbody></table>

		<p><span class="text_import2">上面那个 files 就是使用 /etc/hosts，而最后的 dns 则是使用 /etc/resolv.conf 的 DNS 
		服务器来进行搜寻啦</span>！因此，你可以先以 /etc/hosts 来设定 IP 对应！当然啦，你也可以将他调换过来，不过，总是
		/etc/hosts 比较简单，所以将他摆在前面比较好啦！</p>

		<p>好啦，既然我们是要进行 DNS 测试的，那么就得要了解一下 /etc/resolv.conf 的内容，假设你在台湾，使用的是 hinet 的
		168.95.1.1 这部 DNS 服务器，所以你应该这样写：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">vim /etc/resolv.conf</span>
<span class="term_write">nameserver 168.95.1.1
nameserver 139.175.10.20</span>
</pre></td></tr></tbody></table>

		<p><span class="text_import2">DNS 服务器的 IP 可以设定多个，为什么要设定多个呢？因为当第一部 (照设定的顺序)
		DNS 挂点时，我们客户端可以使用第二部 (上述是 139.175.10.20) 来进行查询，这多少有点像 DNS 备援功能</span>。
		通常建议至少填写两部 DNS 服务器的 IP，不过在网络正常使用的情况下，<span class="text_import1">永远只有第一部
		DNS 服务器会被使用来查询</span>，其他的设定值只是在第一部出问题时才会被使用。</p>

		<div style="padding: 10pt 0pt 10pt 0pt ;" align="right"><table width="90%"><tbody><tr><td><b>Tips:</b><br><span style="color : #009000"><font size="-1">		尽量不要设定超过 3 部以上的 DNS IP 在 /etc/resolv.conf 中，因为如果是你的区网出问题，导致无法联机到 DNS 
		服务器，那么你的主机还是会向每部 DNS 服务器发出联机要求，每次联机都有 timeout 时间的等待，会导致浪费非常多的时间喔！
		</font></span></td><td><img src="0350dns_files/vbird_face.gif" alt="鸟哥的图示" title="鸟哥的图示"></td></tr></tbody></table></div>
<table width="90%" border="1" cellpadding="5" cellspacing="0"><tbody><tr><td>
例题：<div class="block2">
我的主机使用 DHCP 取得 IP ，很奇怪的，当我修改过 /etc/resolv.conf 之后，隔不多久这个档案又会恢复成原本的样子，这是什么原因？
该如何处理？
</div>
答：<div class="block2">
因为使用 DHCP 时，系统会主动的使用 DHCP 服务器传来的数据进行系统配置文件的修订。因此，你必须告知系统，不要使用 DHCP 传来的服务器设定值。
此时，你得要在 /etc/sysconfig/network-scripts/ifcfg-eth0 等相关档案内，增加一行：『PEERDNS=no』，然后重新启动网络即可。<br><br>
此外，如果你有启动 CentOS 6.x 的 NetworkManager 服务，有时候也可能会产生一些奇特的现象哩！所以鸟哥是建议关掉它的！^_^
</div>
</td></tr></tbody></table><br>
	</div>

	<hr><a name="DNS_resolver_cmd"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">19.2.2 DNS 的正、反解查询指令： host, 
	nslookup, dig</span><br>
	<div class="block2">
		<p>测试 DNS 的程序有很多，我们先来使用最简单的 host 吧！然后还有 nslookup 及 dig 哩！<br><br></p>

		<ul class="list1"><li class="text_import1"><a name="host"></a><hr>host</li></ul>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">host [-a] FQDN [server]</span>
[root@www ~]# <span class="term_command">host -l domain [server]</span>
<span class="term_say">选项与参数：
-a ：代表列出该主机所有的相关信息，包括 IP、TTL 与除错讯息等等
-l ：若后面接的那个 domain 设定允许 allow-transfer 时，则列出该 domain 
     所管理的所有主机名对应数据！
server：这个参数可有可无，当想要利用非 /etc/resolv.conf 内的 DNS 主机
        来查询主机名与 IP 的对应时，就可以利用这个参数了！</span>

<span class="term_hd"># 1. 使用默认值来查出 linux.vbird.org 的 IP </span>
[root@www ~]# <span class="term_command">host linux.vbird.org</span>
linux.vbird.org has address 140.116.44.180             <span class="term_note">&lt;==这是 IP</span>
linux.vbird.org mail is handled by 10 linux.vbird.org. <span class="term_note">&lt;==这是 MX (后续章节说明)</span>

<span class="term_hd"># 2. 查出 linux.vbird.org 的所有重要参数</span>
[root@www ~]# <span class="term_command">host -a linux.vbird.org</span>
Trying "linux.vbird.org"
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 56213
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 0

;; QUESTION SECTION:
<u>;linux.vbird.org.               IN      ANY</u>

;; ANSWER SECTION:
<u>linux.vbird.org.        145     IN      A       140.116.44.180</u>

;; AUTHORITY SECTION:
vbird.org.              145     IN      NS      dns.vbird.org.
vbird.org.              145     IN      NS      dns2.vbird.org.

<u>Received 86 bytes from 168.95.1.1#53 in 15 ms</u>  <span class="term_note">&lt;==果然是从 168.95.1.1 取得的资料</span>
<span class="term_say"># 看样子，不就是 dig 的输出结果？所以，我们才会说，使用 dig 才是王道！</span>

<span class="term_hd"># 3. 强制以 139.175.10.20 这部 DNS 主机来查询</span>
[root@www ~]# <span class="term_command">host linux.vbird.org 139.175.10.20</span>
Using domain server:
<span class="term_write">Name: 139.175.10.20
Address: 139.175.10.20#53</span>
Aliases:

linux.vbird.org has address 140.116.44.180
linux.vbird.org mail is handled by 10 linux.vbird.org.
</pre></td></tr></tbody></table>

		<p>看到最后一个范例，有注意到上面输出的特殊字体部分吗？很多朋友在测试自己的 DNS 时，常常会『指定到错误的 DNS 
		查询主机』了～因为他们的 /etc/reslov.conf 忘记改，所以老是找不到自己设定的数据库 IP 数据。所以你要仔细看啊！</p>

<table class="term"><tbody><tr><td class="term"><pre><span class="term_hd"># 4. 找出 vbird.org 领域的所有主机对应</span>
[root@www ~]# <span class="term_command">host -l vbird.org</span>
; Transfer failed.
Host vbird.org not found: 9(NOTAUTH)
; Transfer failed. <span class="term_note">&lt;==竟然失败了！请看底下的说明！</span>
</pre></td></tr></tbody></table>

		<p>怎么会无法响应呢？这样的响应是因为管理 vbird.org 领域的 DNS 并不许我们的领域查询，毕竟我们不是
		vbird.org 的系统管理员，当然没有权限可以读取整个 vbird.org 的领域设定啰！这个『 host -l 』是用在自己的 DNS
		服务器上，本章稍后谈到服务器设定后，使用这个选项就能够读取相关的数据了。<br><br></p>

		<ul class="list1"><li class="text_import1"><a name="nslookup"></a><hr>nslookup</li></ul>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">nslookup [FQDN] [server]</span>
[root@www ~]# <span class="term_command">nslookup</span>
<span class="term_say">选项与参数：
1. 可以直接在 nslookup 加上待查询的主机名或者是 IP ，[server] 可有可无；
2. 如果在 nslookup 后面没有加上任何主机名或 IP ，那将进入 nslookup 的查询功能
   在 nslookup 的查询功能当中，可以输入其他参数来进行特殊查询，例如：
   set type=any ：列出所有的信息『正解方面配置文件』
   set type=mx  ：列出与 mx 相关的信息！</span>

<span class="term_hd"># 1. 直接搜寻 mail.ksu.edu.tw 的 IP 信息 </span>
[root@www ~]# <span class="term_command">nslookup mail.ksu.edu.tw</span>
Server:         168.95.1.1
Address:        168.95.1.1#53  <span class="term_note">&lt;==还是请特别注意 DNS 的 IP 是否正确！</span>

Non-authoritative answer:
Name:   mail.ksu.edu.tw
Address: 120.114.100.20        <span class="term_note">&lt;==回报 IP 给你啰！</span>
</pre></td></tr></tbody></table>

		<p>nslookup 可单纯的将 hostname 与 IP 对应列出而已，不过，还是会将查询的 DNS 主机的 IP 列出来的！
		如果想要知道更多详细的参数，那可以直接进入 nslookup 这个软件的操作画面中，如下范例：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">nslookup</span>  <span class="term_note">&lt;==进入 nslookup 查询画面</span>
&gt; <span class="term_command">120.114.100.20</span>         <span class="term_note">&lt;==执行反解的查询</span>
&gt; <span class="term_command">www.ksu.edu.tw</span>         <span class="term_note">&lt;==执行正解的查询</span>
<span class="term_say"># 上面这两个仅列出正反解的信息，没有啥了不起的地方啦！</span>
&gt; <span class="term_command">set type=any  </span>         <span class="term_note">&lt;==变更查询，不是仅有 A，全部信息都列出来</span>
&gt; <span class="term_command">www.ksu.edu.tw</span>
Server:         168.95.1.1
Address:        168.95.1.1#53

Non-authoritative answer:
Name:   www.ksu.edu.tw
Address: 120.114.100.101  <span class="term_note">&lt;==这是答案</span>

Authoritative answers can be found from: <span class="term_note">&lt;==这是相关授权 DNS 说明</span>
ksu.edu.tw      nameserver = dns2.ksu.edu.tw.
ksu.edu.tw      nameserver = dns1.ksu.edu.tw.
dns1.ksu.edu.tw internet address = 120.114.50.1
dns2.ksu.edu.tw internet address = 120.114.150.1
&gt; <span class="term_command">exit</span> <span class="term_note">&lt;==离开吧！皮卡丘</span>
</pre></td></tr></tbody></table>

		<p>在上面的案例当中，请注意，如果你在 nslookup 的查询画面当中，输入 set type=any 或其他参数，
		那么就无法再进行反解的查询了！这是因为 any 或者是 mx 等等的标志都是记录在正解 zone 当中的缘故！<br><br></p>

		<ul class="list1"><li class="text_import1"><a name="dig"></a><hr>dig (未来的主流，请爱用他！)</li></ul>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">dig [options] FQDN [@server]</span>
<span class="term_say">选项与参数：
@server ：如果不以 /etc/resolv.conf 的设定来作为 DNS 查询，可在此填入其他的 IP
options：相关的参数很多，主要有 +trace, -t type 以及 -x 三者最常用
  +trace ：就是从 . 开始追踪，在 19.1.2 里面谈过了！回头瞧瞧去！
  -t type：查询的数据主要有 mx, ns, soa 等类型，相关类型 19.4 来介绍
  -x     ：查询反解信息，非常重要的项目！</span>

<span class="term_hd"># 1. 使用默认值查询 linux.vbird.org 吧！</span>
[root@www ~]# <span class="term_command">dig linux.vbird.org</span>
; &lt;&lt;&gt;&gt; DiG 9.7.0-P2-RedHat-9.7.0-5.P2.el6_0.1 &lt;&lt;&gt;&gt; linux.vbird.org
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 37415
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 0

;; <u>QUESTION SECTION:</u>     <span class="term_note">&lt;==提出的问题的部分</span>
;linux.vbird.org.               IN      A

;; <u>ANSWER SECTION:</u>       <span class="term_note">&lt;==主要的回答阶段</span>
linux.vbird.org.        600     IN      A       140.116.44.180

;; <u>AUTHORITY SECTION:</u>    <span class="term_note">&lt;==其他与此次回答有关的部分</span>
vbird.org.              600     IN      NS      dns.vbird.org.
vbird.org.              600     IN      NS      dns2.vbird.org.

;; Query time: 9 msec
;; <u>SERVER: 168.95.1.1#53(168.95.1.1)</u>
;; WHEN: Thu Aug  4 14:12:26 2011
;; MSG SIZE  rcvd: 86
</pre></td></tr></tbody></table>

		<p>在这个范例当中，我们可以看到整个显示出的讯息包括有几个部分：</p>

		<ul>
		<li>QUESTION(问题)：显示所要查询的内容，因为我们是查询 linux.vbird.org 的 IP，所以这里显示 A (Address)；</li>
		<li>ANSWER(回答)：依据刚刚的 QUESTION 去查询所得到的结果，答案就是回答 IP 啊！</li>
		<li>AUTHORITY(验证)：由这里我们可以知道 linux.vbird.org 是由哪部 DNS 服务器所提供的答案！
		结果是 dns.vbird.org 及 dns2.vbird.org 这两部主机管理的。另外，那个 600 是啥咚咚？<a href="#fig19.1-4">图 19.1-4</a>
		提到过的流程，就是允许查询者能够保留这笔记录多久的意思 (快取)，在 linux.vbird.org 的设定中，预设可以保留 600 秒。</li>
		</ul>

<table class="term"><tbody><tr><td class="term"><pre><span class="term_hd"># 2. 查询 linux.vbird.org 的 SOA 相关信息吧！</span>
[root@www ~]# <span class="term_command">dig -t soa linux.vbird.org</span>
; &lt;&lt;&gt;&gt; DiG 9.7.0-P2-RedHat-9.7.0-5.P2.el6_0.1 &lt;&lt;&gt;&gt; -t soa linux.vbird.org
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 57511
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 0

;; QUESTION SECTION:
;<u>linux.vbird.org.               IN      SOA</u>

;; AUTHORITY SECTION:
vbird.org.              600     IN      SOA     <u>dns.vbird.org. root.dns.vbird.org.
 2007091402 28800 7200 720000 86400</u>

;; Query time: 17 msec
;; SERVER: 168.95.1.1#53(168.95.1.1)
;; WHEN: Thu Aug  4 14:15:57 2011
;; MSG SIZE  rcvd: 78
</pre></td></tr></tbody></table>

		<p>由于 dig 的输出信息实在是太丰富了，又分成多个部分去进行回报，因此很适合作为 DNS 追踪回报的一个指令呢！
		你可以透过这个指令来了解一下你所设定的 DNS 数据库是否正确，并进行除错喔！ ^_^！此外，你也可以透过『 -t type 』
		的功能去查询其他服务器的设定值，可以方便你进行设定 DNS 服务器时的参考喔！正解查询完毕，接下来玩一玩反解吧！</p>

<table class="term"><tbody><tr><td class="term"><pre><span class="term_hd"># 3. 查询 120.114.100.20 的反解信息结果</span>
[root@www ~]# <span class="term_command">dig -x 120.114.100.20</span>
; &lt;&lt;&gt;&gt; DiG 9.7.0-P2-RedHat-9.7.0-5.P2.el6_0.1 &lt;&lt;&gt;&gt; -x 120.114.100.20
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 60337
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 3, ADDITIONAL: 3

;; QUESTION SECTION:
;<span class="term_write">20.100.114.120.in-addr.arpa.   IN      PTR</span>

;; ANSWER SECTION:
20.100.114.120.in-addr.arpa. 3600 IN    PTR     mail-out-r2.ksu.edu.tw.
20.100.114.120.in-addr.arpa. 3600 IN    PTR     mail-smtp-proxy.ksu.edu.tw.
20.100.114.120.in-addr.arpa. 3600 IN    PTR     mail.ksu.edu.tw.

;; AUTHORITY SECTION:
100.114.120.in-addr.arpa. 3600  IN      NS      dns1.ksu.edu.tw.
100.114.120.in-addr.arpa. 3600  IN      NS      dns3.twaren.net.
100.114.120.in-addr.arpa. 3600  IN      NS      dns2.ksu.edu.tw.

;; ADDITIONAL SECTION:
dns1.ksu.edu.tw.        3036    IN      A       120.114.50.1
dns2.ksu.edu.tw.        2658    IN      A       120.114.150.1
dns3.twaren.net.        449     IN      A       211.79.61.47

;; Query time: 29 msec
;; SERVER: 168.95.1.1#53(168.95.1.1)
;; WHEN: Thu Aug  4 14:17:58 2011
;; MSG SIZE  rcvd: 245
</pre></td></tr></tbody></table>

		<p>反解相当有趣！从上面的输出结果来看，<span class="text_import2">反解的查询目标竟然从 120.114.100.20 变成了 
		20.100.114.120.in-addr.arpa. 这个模样</span>～这是啥鬼东西？不要怕，这等我们讲到反解时再跟大家进一步解释。
		你现在要知道的是，反解的查询领域名，跟正解不太一样即可，尤其是那个怪异的 in-addr.arpa. 结尾的数据，可以先记下来。</p>
	</div>

	<hr><a name="DNS_resolver_whois"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">19.2.3 查询领域管理者相关信息：
	whois</span><br>
	<div class="block2">
		<p>上个小节谈到的是主机名的正反解查询指令，那如果你想要知道整个领域的设定，使用的是『 host -l 领域名 』去查，
		那如果你想要知道的是『这个领域是谁管的』的信息呢？那就得要使用 whois 这个指令才行喔！在 CentOS 6.x
		当中， whois  是由 jwhois 这个软件提供的，因此，如果找不到 whois 时，请用 yum 去安装这个软件吧！<br><br></p>

		<ul class="list1"><li class="text_import1"><hr>whois</li></ul>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">whois [domainname]</span>  <span class="term_say">&lt;==注意啊！是 domain 而不是 hostname</span>
[root@www ~]# <span class="term_command">whois centos.org</span>
[Querying whois.publicinterestregistry.net]
[whois.publicinterestregistry.net]
<span class="term_say"># 这中间是一堆 whois 服务器提供的讯息告知！底下是实际注册的数据</span>
Domain ID:D103409469-LROR
<span class="term_write">Domain Name:CENTOS.ORG
Created On:04-Dec-2003 12:28:30 UTC
Last Updated On:05-Dec-2010 01:23:25 UTC
Expiration Date:04-Dec-2011 12:28:30 UTC</span>  <span class="term_note">&lt;==记载了建立与与失效的日期</span>
Sponsoring Registrar:Key-Systems GmbH (R51-LROR)
Status:CLIENT TRANSFER PROHIBITED
Registrant ID:P-8686062
Registrant Name:CentOS Domain Administrator
Registrant Organization:The CentOS Project
Registrant Street1:Mechelsesteenweg 170
<span class="term_say"># 底下则是一堆联络方式，鸟哥将它取消了，免得多占篇幅～</span>
</pre></td></tr></tbody></table>

		<p>whois 这个指令可以查询到当初注册这个 domain 的用户的相关信息。不过，由于近年来很多网络信息安全的问题，这个 
		whois 所提供的信息真的是太详细了，为了保护使用者的隐私权，所以，目前这个 whois 
		所查询到的信息已经不见得是完全正确的了～而且，在显示出 whois 的信息之前，还会有一段宣告事项的告知呢～ ^_^y</p>

		<p>如果使用 whois 来检查鸟哥所注册的合法 domain 会是如何呢？看看：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">whois vbird.idv.tw</span>
[Querying whois.twnic.net]
[whois.twnic.net]           <span class="term_note">&lt;==这个 whois 服务器查到的数据</span>
Domain Name: vbird.idv.tw   <span class="term_note">&lt;==这个 domain 的信息</span>

   Contact:                 <span class="term_note">&lt;==联络者的联络方式</span>
      Der-Min Tsai
      vbird@pc510.ev.ncku.edu.tw

   <u>Record expires on 2018-09-17 (YYYY-MM-DD)</u>
   Record created on 2002-09-13 (YYYY-MM-DD)

Registration Service Provider: HINET
</pre></td></tr></tbody></table>

		<p>呵呵！这个 domain 会在 2018/09/17 失效的意思啦！报告完毕！无论如何，我们都可以透过 nslookup, host, dig 
		等等的指令来查询主机名与 IP 的对应，这些指令的用法可以请你以 man command 来查询更多的用法喔！</p>
	</div>
</div><hr />
    </td>
    <td style="width: 16px; font-size: 6px;">　</td></tr>
<tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
</tbody></table>

<div style="padding-top: 0px; text-align: center;">
<span style="font-size: 80%;">
	<a href="http://linux.vbird.org/" target="_top" title="前往鸟哥的首页">http://linux.vbird.org</a>
	is designed by <a href="mailto:vbird@mail.vbird.idv.tw" title="联络鸟哥(我不要广告信！)">VBird</a>
		during 2001-2011. <a href="http://www.ksu.edu.tw/" target="_blank">ksu.edu</a></span>
         ﻿<div id="apDiv4">
      <p>本网页主要以Firefox配合解析度 1024x768 作为设计依据&nbsp;&nbsp;&nbsp;&nbsp; 鸟哥自由软件整合应用研究室</p></div></div>
</div>
</center>
</body></html>
