<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-TW" lang="zh-TW"><head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf8">
	<meta name="Author" content="VBird, 鸟哥">
	<meta name="Description" content="使用 Routing 的功能，让 Linux Server 也可以当作 Router 来使用！此外，亦提到 IP aliases 这个好用的功能呢！">
	<title>鸟哥的 Linux 私房菜 -- 架设 Router</title>
    <script src="../script/SpryMenuBar.js" type="text/javascript"></script>
	<script src="../script/index.js" type="text/javascript"></script>
	<link href="../css/SpryMenuBarHorizontal.css" rel="stylesheet" type="text/css" />
    <link href="../css/main.css" rel="stylesheet" type="text/css" />
    </head><body style="margin: 0pt; padding: 0pt;" class="table"onload="MM_preloadImages('../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html','../index-2.html')">

<center>
<div id="apDiv5">
<div> <LINK REL="SHORTCUT ICON" HREF="../index-2.html">
<!-- ImageReady Slices (title3.ai) -->
<table id="___01" width="898" height="81" border="0" align="center" cellpadding="0" cellspacing="0";>
	<tr>
		<td colspan="15">
			<img src="image/title/title_01.png" width="900" height="1" alt=""></td>
	</tr>
	<tr>
		<td rowspan="4" bgcolor="#182448"><p><img src="http://linux.vbird.org/cgi-bin/Count.cgi?dd=C&amp;ft=5&amp;sh=T&amp;md=8&amp;pad=Y&amp;df=vbird.dic.ksu.edu.tw.dat" width="93" align="left" title="計數器" /></p>
	    <p><font color="#FFFFFF" size="-1">since2012/04/23</font></p></td>
		<td rowspan="4" align="left" valign="top"><a href="../index.html"><img src="image/title/title_03.png" alt="" width="263" height="79" border="0"></a></td>
		<td colspan="13">
			<img src="image/title/title_04.png" alt="" width="535" height="9" border="0"></td>
	</tr>
	<tr>
		<td rowspan="3">
			<img src="image/title/title_05.png" alt="" width="53" height="70" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../linux_basic/0110whatislinux.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image51','','image/title/title_06.png',1)"><img src="image/title/title3_06.png" name="Image51" width="106" height="25" border="0" id="Image51" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_07.png" alt="" width="27" height="37" border="0"></td>
		<td colspan="3" align="left" valign="top"><a href="0110network_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image52','','image/title/title_08.png',1)"><img src="image/title/title3_08.png" name="Image52" width="107" height="25" border="0" id="Image52" alt=""/></a></td>
		<td rowspan="2">
			<img src="image/title/title_09.png" alt="" width="37" height="37" border="0"></td>
		<td colspan="2" align="left" valign="top"><a href="../about.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image53','','image/title/title_10.png',1)"><img src="image/title/title3_10.png" name="Image53" width="75" height="25" border="0" id="Image53" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_11.png" alt="" width="35" height="70" border="0"></td>
		<td align="left" valign="top"><a href="mailto:vbird@mail.vbird.idv.tw" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image54','','image/title/title_12.png',1)"><img src="image/title/title3_12.png" name="Image54" width="74" height="25" border="0" id="Image54" alt=""/></a></td>
		<td rowspan="3">
			<img src="image/title/title_13.png" alt="" width="21" height="70" border="0"></td>
	</tr>
	<tr>
		<td colspan="2">
			<img src="image/title/title_14.png" alt="" width="106" height="12" border="0"></td>
		<td colspan="3">
			<img src="image/title/title_15.png" alt="" width="107" height="12" border="0"></td>
		<td colspan="2">
			<img src="image/title/title_16.png" width="75" height="12" alt=""></td>
		<td rowspan="2">
			<img src="image/title/title_17.png" alt="" width="74" height="45" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/title_18.png" alt="" width="15" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar1" class="MenuBarHorizontal">
	  <li><a href="../linux_basic/linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image44','','image/title/title_19.png',1)"><img src="image/title/title3_19.png" name="Image44" width="123" height="33" border="0" id="Image44" /></a>
			    <ul>
			      <li><a href="../linux_basic/Mandrake9.0/mandrake9.0.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image46','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image46" width="120" height="26" border="0" id="Image46" alt="" /></a></li>
                  <li><a href="../linux_basic/fedora_4/fc4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image47','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image47" width="120" height="26" border="0" id="Image47" alt="" /></a></li>
                  <li><a href="../linux_basic/linux_basic.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image48','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image48" width="120" height="26" border="0" id="Image48" alt="" /></a></li>
                </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_20.png" alt="" width="42" height="33" border="0"></td>
		<td colspan="3" align="left" valign="top"><ul id="MenuBar2" class="MenuBarHorizontal">
	  <li><a href="index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image45','','image/title/title_21.png',1)"><img src="image/title/title3_21.png" name="Image45" width="125" height="33" border="0" id="Image45" /></a>
			    <ul>
			      <li><a href="linux_redhat9/redhat9.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image43','','image/title/title_26.png',1)"><img src="image/title/title_23.png" name="Image43" width="120" height="26" border="0" id="Image43" alt=""/></a></li>
			      <li><a href="centos4.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image49','','image/title/title_27.png',1)"><img src="image/title/title_24.png" name="Image49" width="120" height="26" border="0" id="Image49" alt="" /></a></li>
			      <li><a href="index.html" onmouseout="MM_swapImgRestore()" onmouseover="MM_swapImage('Image50','','image/title/title_28.png',1)"><img src="image/title/title_25.png" name="Image50" width="120" height="26" border="0" id="Image50" alt="" /></a></li>
		        </ul>
		      </li>
		</ul></td>
		<td>
			<img src="image/title/title_22.png" alt="" width="47" height="33" border="0"></td>
	</tr>
	<tr>
		<td>
			<img src="image/title/Spacer.gif" width="101" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="263" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="53" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="15" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="91" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="27" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="5" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="42" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="60" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="37" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="28" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="47" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="35" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="74" height="1" alt=""></td>
		<td>
			<img src="image/title/Spacer.gif" width="22" height="1" alt=""></td>
	</tr>
</table>
<!-- End ImageReady Slices -->
<script type="text/javascript">
<!--
var MenuBar1 = new Spry.Widget.MenuBar("MenuBar1", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
var MenuBar2 = new Spry.Widget.MenuBar("MenuBar2", {imgDown:"SpryAssets/SpryMenuBarDownHover.gif", imgRight:"SpryAssets/SpryMenuBarRightHover.gif"});
//-->
</script>
</div>
<table summary="本文内容的排版" style="width: 898px;" border="0" cellpadding="0" cellspacing="0">
<tbody><tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
<tr><td style="width: 16px; font-size: 6px;">　</td>
    <td width="866">

<!-- 本文的档头部分 -->
<div style="text-align:center">
    <a href="http://linux.vbird.org/linux_server/0230router.php">
    <span class="text_head0">第八章、路由观念与路由器设定</span></a><br>
</div>
    <div style="text-align:right">
        <span class="text_history">最近更新日期：2011/07/22</span>
    </div>
<!-- 本文的连结区部分 -->
<div class="block1">
<span class="text_h1">
8.1 <a href="#routing">路由</a><br>
	<span class="text_h2">
	　　8.1.1 <a href="#routing_table">路由表产生的类型</a><br>
	　　8.1.2 <a href="#routing_ip_alias">一个网卡绑多个 IP：IP Alias 的测试功能</a><br>
	　　8.1.3 <a href="#routing_double">重复路由的问题</a><br>
	</span>
</span></div>
<!-- 本文的正式部分 -->
<hr><a name="routing"></a><img src="../image/logo.png" alt="大标题的图示" width="35" align="middle" height="34"><span class="text_h1">8.1 路由</span><br>
<div class="block1">
	<p>我们在<a href="http://linux.vbird.org/linux_server/0110network_basic.php">第二章网络基础</a>里面谈到过<a href="http://linux.vbird.org/linux_server/0110network_basic.php#route">路由</a>的相关概念，
	他最大的功能就是在帮我们规划网络封包的传递方式与方向。至于路由的观察则可以使用
	<a href="http://linux.vbird.org/linux_server/0140networkcommand.php#route">route</a> 这个指令来查阅与设定。
	好了，那么路由的形式有哪些？你又该如何确认路由是否正确呢？<br><br></p>

	<hr><a name="routing_table"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">8.1.1 路由表产生的类型</span><br>
	<div class="block2">
		<p>如同第二章网络基础里面谈到的，<span class="text_import2">每一部主机都有自己的路由表</span>，
		也就是说，你必须要透过你自己的路由表来传递你主机的封包到下一个路由器上头。
		若传送出去后，该封包就得要透过下一个路由器的路由表来传送了，此时与你自己主机的路由表就没有关系啦！
		所以说，如果网络上面的某一部路由器设定错误，那...封包的流向就会发生很大的问题。
		我们就得要透过 <a href="http://linux.vbird.org/linux_server/0140networkcommand.php#traceroute">traceroute</a> 
		来尝试了解一下每个 router 的封包流向啰。</p>

		<p>OK！那你自己主机的路由表到底有哪些部分呢？我们以底下这个路由表来说明：</p>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">route -n</span>
Kernel IP routing table
Destination  Gateway        Genmask         Flags Metric Ref  Use Iface
192.168.1.0  0.0.0.0        255.255.255.0   U     0      0      0 eth0 <span class="term_note">&lt;== 1</span>
169.254.0.0  0.0.0.0        255.255.0.0     U     1002   0      0 eth0 <span class="term_note">&lt;== 2</span>
0.0.0.0      192.168.1.254  0.0.0.0         UG    0      0      0 eth0 <span class="term_note">&lt;== 3</span>
</pre></td></tr></tbody></table>

		<p>首先，我们得知道在 Linux 系统下的路由表<span class="text_import2">是由小网域排列到大网域</span>，
		例如上面的路由表当中，路由是由『 192.168.1.0/24 --&gt; 169.254.0.0/16 --&gt; 0.0.0.0/0 (预设路由) 』来排列的。
		而当主机的网络封包需要传送时，就会查阅上述的三个路由规则来了解如何将该封包传送出去。 
		那你会不会觉得奇怪，为什么会有这几个路由呢？其实路由表主要有这几种情况来设计的：</p>

		<ul style="padding-left: 20px">
		<li><span class="text_import1">依据网络接口产生的 IP 而存在的路由</span>：<br><br>

		例如 192.168.1.0/24 这个路由的存在是由于鸟哥的这部主机上面拥有 192.168.1.100 这个 IP 的关系！
		也就是说，你主机上面有几个网络接口的存在时，该网络接口就会存在一个路由才对。
		所以说，万一你的主机有两个网络接口时，例如 192.168.1.100, 192.168.2.100 时，那路由至少就会有：<br>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">ifconfig eth1 192.168.2.100</span>
[root@www ~]# <span class="term_command">route -n</span>
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
<u>192.168.2.0     0.0.0.0         255.255.255.0</u>   U     0      0        0 eth1
<u>192.168.1.0     0.0.0.0         255.255.255.0</u>   U     0      0        0 eth0
169.254.0.0     0.0.0.0         255.255.0.0     U     1002   0        0 eth0
0.0.0.0         192.168.1.254   0.0.0.0         UG    0      0        0 eth0
</pre></td></tr></tbody></table><br></li>

		<li><span class="text_import1">手动或预设路由(default route)</span>：<br><br>

		你可以使用 route 这个指令手动的给予额外的路由设定，例如那个预设路由 (0.0.0.0/0) 就是额外的路由。
		使用 route 这个指令时，最重要的一个概念是：『<span class="text_import2">你所规划的路由必须要是你的装置 
		(如 eth0) 或 IP 可以直接沟通 (broadcast) 的情况</span>』才行。举例来说，以上述的环境来看，
		我的环境里面仅有 192.168.1.100 及 192.168.2.100 ，那我如果想要连接到 192.168.5.254 这个路由器时，
		下达：<br>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">route add -net 192.168.5.0  \</span>
&gt; <span class="term_command">netmask 255.255.255.0 gw 192.168.5.254</span>
SIOCADDRT: No such process
</pre></td></tr></tbody></table>

		看吧！系统就会响应没有办法连接到该网域，因为我们的网络接口与 192.168.5.0/24 根本就没有关系嘛！
		那如果 192.168.5.254 真的是在我们的实体网络连接上，并且与我们的 eth0 连接在一起，那其实你应该是这样做：<br>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">route add -net 192.168.5.0  \</span>
&gt; <span class="term_command">netmask 255.255.255.0 dev eth0</span>
[root@www ~]# <span class="term_command">route -n</span>
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
<u>192.168.5.0     0.0.0.0         255.255.255.0   <span class="term_write">U</span>     0      0        0 eth0</u>
192.168.2.0     0.0.0.0         255.255.255.0   <span class="term_write">U</span>     0      0        0 eth1
192.168.1.0     0.0.0.0         255.255.255.0   <span class="term_write">U</span>     0      0        0 eth0
169.254.0.0     0.0.0.0         255.255.0.0     <span class="term_write">U</span>     1002   0        0 eth0
0.0.0.0         192.168.1.254   0.0.0.0         <span class="term_write">UG</span>    0      0        0 eth0
</pre></td></tr></tbody></table>

		这样你的主机就会直接用 eth0 这个装置去尝试连接 192.168.5.254 了！
		另外，上面路由输出的重点其实是那个『<span class="text_import2">Flags 的 G</span> 』了！因为那个 G 
		代表使用外部的装置作为 Gateway 的意思！而那个 Gateway (192.168.1.254) 必须要在我们的已存在的路由环境中。
		这可是很重要的概念喔！ ^_^<br><br></li>

		<li><span class="text_import1">动态路由的学习</span>：<br><br>

		除了上面这两种可以直接使用指令的方法来增加路由规则之外，还有一种透过路由器与路由器之间的协商以达成动态路由的环境，
		不过，那就需要额外的软件支持了，例如： <a href="http://www.zebra.org/what.html" target="_blank">zebra (http://www.zebra.org/)</a> 或 CentOS 上面的 
		<a href="http://www.quagga.net/about.php" target="_blank">Quagga (http://www.quagga.net/)</a> 这几个软件了！<br></li>
		</ul>

		<p>事实上，在 Linux 的路由规则都是透过核心来达成的，所以这些路由表的规则都是在核心功能内啊！也就是在内存当中喔！ ^_^</p>
	</div>

	<hr><a name="routing_ip_alias"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">8.1.2 一个网卡绑多个 IP： IP Alias 
	的测试用途</span><br>
	<div class="block2">
		<p>我们在<a href="http://linux.vbird.org/linux_server/0140networkcommand.php#ifconfig">第五章的 ifconfig</a> 指令里面谈过 eth0:0 
		这个装置吧？这个装置可以在原本的 eth0 上面模拟出一个虚拟接口出来，以让我们原本的网络卡具有多个 IP ，具有多个 IP 
		的功能就被称为 IP Alias 了。而这个 eth0:0 的装置可以透过 <a href="http://linux.vbird.org/linux_server/0140networkcommand.php#ifconfig">ifconfig</a> 或
		<a href="http://linux.vbird.org/linux_server/0140networkcommand.php#ip_cmd">ip</a> 这两个指令来达成，
		关于这两个指令的用途请翻回去之前的章节阅读，这里不再浪费篇幅啊！</p>

		<p>那你或许会问啊：『这个 IP Alias 有啥用途啊？』好问题！这个 IP Alias 最大的用途就是可以让你用来『应急』！
		怎么说呢？我们就来聊一聊他的几个常见的用途好了：</p>

		<ul style="padding-left:20px">

		<li><span class="text_import2">测试用</span>：<br><br>

		怎么说用来测试呢？举例来说，现在使用 IP 分享器的朋友很多吧，而 IP 分享器的设定通常是使用 WWW 接口来提供的。这个 
		IP 分享器通常会给予一个私有 IP 亦即是 192.168.0.1 来让用户开启 WWW 接口的浏览。问题来了，那你要如何连接上这部 
		IP 分享器呢？嘿嘿！在不更动既有的网络环境下，你可以直接利用：<br>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">ifconfig [device] [ IP ] netmask [netmask ip] [up|down]</span>
[root@www ~]# <span class="term_command">ifconfig eth0:0 192.168.0.100 netmask 255.255.255.0 up</span>
</pre></td></tr></tbody></table>

		来建立一个虚拟的网络接口，这样就可以立刻连接上 IP 分享器了，也不会更动到你原本的网络参数设定值哩！<br><br></li>

		<li><span class="text_import2">在一个实体网域中含有多个 IP 网域</span>：<br><br>

		另外，如果像是在补习班或者是学校单位的话，由于原本的主机网络设定最好不要随便修改，
		那如果要让同学们大家互通所有的计算机信息时，就可以让每个同学都透过 IP Alias 来设定同一网域的 IP ，
		如此大家就可以在同一个网段内进行各项网络服务的测试了，很不错吧！<br><br></li>

		<li><span class="text_import2">既有设备无法提供更多实体网卡时</span>：<br><br>

		如果你的这部主机需要连接多个网域，但该设备却无法提供安装更多的网卡时，你只好勉为其难的使用 IP Alias 
		来提供不同网段的联机服务了！</li>
		</ul>

		<p>不过，你需要知道的是：<span class="text_import2">所有的 IP Alias 都是由实体网卡仿真来的，所以当要启动 eth0:0 
		时，eth0 必须要先被启动才行。而当 eth0 被关闭后，所以 eth0:n 的模拟网卡将同时也被关闭</span>。这得先要了解才行，
		否则常常会搞错启动的装置啊！在路由规则的设定当中，常常需要进行一些测试，那这个 IP Alias 就派的上用场了。
		尤其是学校单位的练习环境当中！</p>

		<p>基本上，除非有特殊需求，否则建议你要有多个 IP 时，最好在不同的网卡上面达成，如果你真的要使用 IP Alias 
		时，那么如何在<span class="text_import2">开机的时候就启动 IP alias</span> 呢？方法有很多啦！包括将上面用 ifconfig 
		启动的指令写入 /etc/rc.d/rc.local 档案中 (但使用 /etc/init.d/network restart 时，该 IP alias 无法被重新启动)，
		但鸟哥个人比较建议使用如下的方式来处理：</p>

		<ul style="padding-left: 20px">

		<li><span class="text_import1">透过建立 /etc/sysconfig/network-scripts/ifcfg-eth0:0 配置文件</span><br><br>

		举例来说，你可以透过底下这个方法来建立一个虚拟设备的配置文件案：<br>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">cd /etc/sysconfig/network-scripts</span>
[root@www network-scripts]# <span class="term_command">vim ifcfg-eth0:0</span>
<span class="term_write">DEVICE=eth0:0            <span class="term_note">&lt;==相当重要！一定要与文件名相同的装置代号！</span>
ONBOOT=yes
BOOTPROTO=static
IPADDR=192.168.0.100
NETMASK=255.255.255.0</span>

[root@www network-scripts]# <span class="term_command">ifup eth0:0</span>
[root@www network-scripts]# <span class="term_command">ifdown eth0:0</span>
[root@www network-scripts]# <span class="term_command">/etc/init.d/network restart</span>
</pre></td></tr></tbody></table>

		关于装置的配置文件案内的更多参数说明，
		请参考<a href="http://linux.vbird.org/linux_server/0130internet_connect.php#connect_fix_IP">第四章 4.2.1 手动设定 IP 参数</a>的相关说明，
		在此不再叙述！使用这个方法有个好处，就是当你使用『 /etc/init.d/network restart 』时，系统依旧会使用你的 
		ifcfg-eth0:0 档案内的设定值来启动你的虚拟网卡喔！另外，不论 ifcfg-eth0:0 内的 ONBOOT 
		设定值为何，<span class="text_import2">只要 ifcfg-eth0 这个实体网卡的配置文件中，
		ONBOOT 为 yes 时，开机就会将全部的 eth0:n 都启动</span>。
		</li></ul>

		<p>透过这个简单的方法，你就可以在开机的时候启动你的虚拟接口而取得多个 IP 在同一张网卡上了。不过需要注意的是，
		如果你的这张网卡分别透过 DHCP 以及手动的方式来设定你的 IP 参数，那么 dhcp 的取得务必使用实体网卡，亦即是 eth0 
		之类的网卡代号，而手动的就以 eth0:0 之类的代号来设定较佳。</p>

		<div style="padding: 10pt 0pt 10pt 0pt ;" align="right"><table width="90%"><tbody><tr><td><b>Tips:</b><br><span style="color : #009000"><font size="-1">		在旧版的 CentOS 4.x 中，如果你的 eth0 是使用 DHCP 来取得 IP 参数的话，那么由于 ifup 及 /etc/init.d/network 
		这两个 script 内程序代码撰写的方式，将会导致 ifcfg-eth0:0 这个配置文件不会被使用到喔！不过这个问题在 CentOS 5.x
		以后的版本中已经被克服啰！
		</font></span></td><td><img src="0230router_files/vbird_face.gif" alt="鸟哥的图示" title="鸟哥的图示"></td></tr></tbody></table></div>	</div>

	<hr><a name="routing_double"></a><img src="../image/logo.png" alt="小标题的图示" width="24" align="middle" height="23"><span class="text_h2">8.1.3 重复路由的问题</span><br>
	<div class="block2">
		<p>很多朋友可能都有一个可爱的想法，那就是：『<span class="text_import2">我可不可以利用两张网卡，
		利用两个相同网域的 IP 来增加我这部主机的网络流量</span>』？事实上这是一个可行的方案，
		不过必须要透过许多的设定来达成，若你有需求的话，可以参考网中人大哥写的这一篇 (<a href="#ps1">注1</a>)：</p>

		<ul><li><a href="http://www.study-area.org/tips/multipath.htm" target="_blank">带宽负载平衡 (http://www.study-area.org/tips/multipath.htm)</a></li></ul>

		<p>如果只是单纯的以为设定好两张网卡的 IP 在同一个网域就能够增加你主机的两倍流量，那可就大错特错了～
		为什么呢？还记得我们在路由表规则里面提过网络封包的传递主要是依据主机内的路由表规则吧！
		那如果你有两张网络卡时，假设： (底下信息请思考，不用实作！)</p>

		<ul><li>eth0 : 192.168.0.100</li><li>eth1 : 192.168.0.200</li></ul>
		那你的路由规则会是如何呢？理论上会变成这样：<br>

<table class="term"><tbody><tr><td class="term"><pre>[root@www ~]# <span class="term_command">route -n</span>
Kernel IP routing table
Destination     Gateway   Genmask         Flags Metric Ref   Use Iface
192.168.0.0     0.0.0.0   255.255.255.0   U     0      0       0 <span class="term_write">eth1</span>
192.168.0.0     0.0.0.0   255.255.255.0   U     0      0       0 <span class="term_write">eth0</span>
</pre></td></tr></tbody></table>

		<p>也就是说，<span class="text_import2">(1)当要主动发送封包到 192.168.0.0/24 的网域时，都只会透过第一条规则
		，也就是透过 eth1 来传出去！ (2)在响应封包方面，不管是由 eth0 还是由 eth1 进来的网络封包，都会透过 eth1 
		来回传</span>！这可能会造成一些问题，尤其是一些防火墙的规则方面，很可能会发生一些严重的错误，
		如此一来，根本没有办法达成负载平衡，也不会有增加网络流量的效果！
		更惨的是，还可能发生封包传递错误的情况吶！所以说，同一部主机上面设定相同网域的 IP 时，
		得要特别留意你的路由规则，一般来说，<span class="text_import2">不应该设定同一的网段的不同 IP 在同一部主机上面</span>。
		例如上面的案例就是一个不好的示范啊！</p>

		<div style="padding: 10pt 0pt 10pt 0pt ;" align="right"><table width="90%"><tbody><tr><td><b>Tips:</b><br><span style="color : #009000"><font size="-1">		为什么会特别强调这个观念呢？大约 2000 年前后，鸟哥刚接触 Linux 时，由于当时的网络速度相当缓慢，
		为了提升网络流量鸟哥费尽心思啊～后来想到说，如果有两片网卡，不就可以增加流量了吗？于是就设定了两个同网域的 IP 
		在一部主机的两张网卡上，结果呢？很多服务都无法连通了！就是因为痛过，所以才有更强烈的印象啊！错误经验学习法则 ^_^！
		</font></span></td><td><img src="0230router_files/vbird_face.gif" alt="鸟哥的图示" title="鸟哥的图示"></td></tr></tbody></table></div>	</div>
</div><hr />
    </td>
    <td style="width: 16px; font-size: 6px;">　</td></tr>
<tr><td style="width: 16px; height: 16px;">　</td>
    <td style="width: 866px; height: 16px;">　</td>
    <td style="width: 16px; height: 16px;">　</td></tr>
</tbody></table>

<div style="padding-top: 0px; text-align: center;">
<span style="font-size: 80%;">
	<a href="http://linux.vbird.org/" target="_top" title="前往鸟哥的首页">http://linux.vbird.org</a>
	is designed by <a href="mailto:vbird@mail.vbird.idv.tw" title="联络鸟哥(我不要广告信！)">VBird</a>
		during 2001-2011. <a href="http://www.ksu.edu.tw/" target="_blank">ksu.edu</a></span>
         ﻿<div id="apDiv4">
      <p>本网页主要以Firefox配合解析度 1024x768 作为设计依据&nbsp;&nbsp;&nbsp;&nbsp; 鸟哥自由软件整合应用研究室</p></div></div>
</div>
</center>
</body></html>
