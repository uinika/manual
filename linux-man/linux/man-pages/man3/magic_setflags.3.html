
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
        "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
    <link rel="stylesheet" type="text/css" href="../../../style.css" title="style" />
    <link rel="stylesheet" type="text/css" href="../style.css" title="style" />
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />

    <title>libmagic(3) - Linux manual page</title>
</head>

<body>

<div class="page-top"><a id="top_of_page"></a></div>
<!--%%%TOP_BAR%%%-->
    <div class="nav-bar">
        <table class="nav-table">
            <tr>
                <td class="nav-cell">
                    <p class="nav-text">
                        <a href="http://man7.org/index.html">man7.org</a> &gt; Linux &gt; <a href="../index.html">man-pages</a>
                    </p>
                </td>
                <td class="training-cell">
                    <p class="training-text"><a class="training-link" href="http://man7.org/training/">Linux/UNIX system programming training</a></p>
                </td>
            </tr>
        </table>
    </div>

<hr class="nav-end" />

<!--%%%PAGE_START%%%-->


<table class="sec-table">
<tr>
    <td>
        <p class="section-dir">
<a href="#NAME">NAME</a> | <a href="#LIBRARY">LIBRARY</a> | <a href="#SYNOPSIS">SYNOPSIS</a> | <a href="#DESCRIPTION">DESCRIPTION</a> | <a href="#RETURN_VALUES">RETURN&nbsp;VALUES</a> | <a href="#FILES">FILES</a> | <a href="#SEE_ALSO">SEE&nbsp;ALSO</a> | <a href="#AUTHORS">AUTHORS</a> | <a href="#COLOPHON">COLOPHON</a>
        </p>
    </td>
    <td class="search-box">
        <div class="man-search-box">

            <form method="get" action="http://www.google.com/search">
                <fieldset class="man-search">
                    <input type="text" name="q" size="10" maxlength="255" value="" />
                    <input type="hidden" name="sitesearch" value="man7.org/linux/man-pages" />
                    <input type="submit" name="sa" value="Search online pages" />
                </fieldset>
            </form>

        </div>
    </td>
    <td> </td>
</tr>
</table>

<pre>
<span class="headline">LIBMAGIC(3)             BSD Library Functions Manual             LIBMAGIC(3)</span>
</pre>
<h2><a id="NAME" href="#NAME"></a>NAME  &nbsp; &nbsp; &nbsp; &nbsp; <a href="#top_of_page"><span class="top-link">top</span></a></h2><pre>
     <b>magic_open</b>, <b>magic_close</b>, <b>magic_error</b>, <b>magic_errno</b>, <b>magic_descriptor</b>,
     <b>magic_buffer</b>, <b>magic_getflags</b>, <b>magic_setflags</b>, <b>magic_check</b>,
     <b>magic_compile</b>, <b>magic_list</b>, <b>magic_load</b>, <b>magic_load_buffers</b>,
     <b>magic_setparam</b>, <b>magic_getparam</b>, <b>magic_version </b>— Magic number recogni‐
     tion library
</pre>
<h2><a id="LIBRARY" href="#LIBRARY"></a>LIBRARY  &nbsp; &nbsp; &nbsp; &nbsp; <a href="#top_of_page"><span class="top-link">top</span></a></h2><pre>
     Magic Number Recognition Library (libmagic, -lmagic)
</pre>
<h2><a id="SYNOPSIS" href="#SYNOPSIS"></a>SYNOPSIS  &nbsp; &nbsp; &nbsp; &nbsp; <a href="#top_of_page"><span class="top-link">top</span></a></h2><pre>
     <b>#include &lt;magic.h&gt;</b>

     <i>magic_t</i>
     <b>magic_open</b>(<i>int flags</i>);

     <i>void</i>
     <b>magic_close</b>(<i>magic_t cookie</i>);

     <i>const char *</i>
     <b>magic_error</b>(<i>magic_t cookie</i>);

     <i>int</i>
     <b>magic_errno</b>(<i>magic_t cookie</i>);

     <i>const char *</i>
     <b>magic_descriptor</b>(<i>magic_t cookie</i>, <i>int fd</i>);

     <i>const char *</i>
     <b>magic_file</b>(<i>magic_t cookie</i>, <i>const char *filename</i>);

     <i>const char *</i>
     <b>magic_buffer</b>(<i>magic_t cookie</i>, <i>const void *buffer</i>, <i>size_t length</i>);

     <i>int</i>
     <b>magic_getflags</b>(<i>magic_t cookie</i>);

     <i>int</i>
     <b>magic_setflags</b>(<i>magic_t cookie</i>, <i>int flags</i>);

     <i>int</i>
     <b>magic_check</b>(<i>magic_t cookie</i>, <i>const char *filename</i>);

     <i>int</i>
     <b>magic_compile</b>(<i>magic_t cookie</i>, <i>const char *filename</i>);

     <i>int</i>
     <b>magic_list</b>(<i>magic_t cookie</i>, <i>const char *filename</i>);

     <i>int</i>
     <b>magic_load</b>(<i>magic_t cookie</i>, <i>const char *filename</i>);

     <i>int</i>
     <b>magic_load_buffers</b>(<i>magic_t cookie</i>, <i>void **buffers</i>, <i>size_t *sizes</i>,
         <i>size_t nbuffers</i>);

     <i>int</i>
     <b>magic_getparam</b>(<i>magic_t cookie</i>, <i>int param</i>, <i>void *value</i>);

     <i>int</i>
     <b>magic_setparam</b>(<i>magic_t cookie</i>, <i>int param</i>, <i>const void *value</i>);

     <i>int</i>
     <b>magic_version</b>(<i>void</i>);
</pre>
<h2><a id="DESCRIPTION" href="#DESCRIPTION"></a>DESCRIPTION  &nbsp; &nbsp; &nbsp; &nbsp; <a href="#top_of_page"><span class="top-link">top</span></a></h2><pre>
     These functions operate on the magic database file which is described
     in magic(4).

     The function <b>magic_open</b>() creates a magic cookie pointer and returns
     it.  It returns NULL if there was an error allocating the magic cookie.
     The <i>flags</i> argument specifies how the other magic functions should
     behave:

     MAGIC_NONE      No special handling.

     MAGIC_DEBUG     Print debugging messages to stderr.

     MAGIC_SYMLINK   If the file queried is a symlink, follow it.

     MAGIC_COMPRESS  If the file is compressed, unpack it and look at the
                     contents.

     MAGIC_DEVICES   If the file is a block or character special device,
                     then open the device and try to look in its contents.

     MAGIC_MIME_TYPE
                     Return a MIME type string, instead of a textual
                     description.

     MAGIC_MIME_ENCODING
                     Return a MIME encoding, instead of a textual descrip‐
                     tion.

     MAGIC_MIME      A shorthand for MAGIC_MIME_TYPE | MAGIC_MIME_ENCODING.

     MAGIC_CONTINUE  Return all matches, not just the first.

     MAGIC_CHECK     Check the magic database for consistency and print
                     warnings to stderr.

     MAGIC_PRESERVE_ATIME
                     On systems that support utime(3) or utimes(2), attempt
                     to preserve the access time of files analysed.

     MAGIC_RAW       Don't translate unprintable characters to a \ooo octal
                     representation.

     MAGIC_ERROR     Treat operating system errors while trying to open
                     files and follow symlinks as real errors, instead of
                     printing them in the magic buffer.

     MAGIC_APPLE     Return the Apple creator and type.

     MAGIC_EXTENSION
                     Return a slash-separated list of extensions for this
                     file type.

     MAGIC_COMPRESS_TRANSP
                     Don't report on compression, only report about the
                     uncompressed data.

     MAGIC_NO_CHECK_APPTYPE
                     Don't check for EMX application type (only on EMX).

     MAGIC_NO_CHECK_CDF
                     Don't get extra information on MS Composite Document
                     Files.

     MAGIC_NO_CHECK_COMPRESS
                     Don't look inside compressed files.

     MAGIC_NO_CHECK_ELF
                     Don't print ELF details.

     MAGIC_NO_CHECK_ENCODING
                     Don't check text encodings.

     MAGIC_NO_CHECK_SOFT
                     Don't consult magic files.

     MAGIC_NO_CHECK_TAR
                     Don't examine tar files.

     MAGIC_NO_CHECK_TEXT
                     Don't check for various types of text files.

     MAGIC_NO_CHECK_TOKENS
                     Don't look for known tokens inside ascii files.

     The <b>magic_close</b>() function closes the magic(4) database and deallocates
     any resources used.

     The <b>magic_error</b>() function returns a textual explanation of the last
     error, or NULL if there was no error.

     The <b>magic_errno</b>() function returns the last operating system error num‐
     ber (errno(2)) that was encountered by a system call.

     The <b>magic_file</b>() function returns a textual description of the contents
     of the <i>filename</i> argument, or NULL if an error occurred.  If the
     <i>filename</i> is NULL, then stdin is used.

     The <b>magic_descriptor</b>() function returns a textual description of the
     contents of the <i>fd</i> argument, or NULL if an error occurred.

     The <b>magic_buffer</b>() function returns a textual description of the con‐
     tents of the <i>buffer</i> argument with <i>length</i> bytes size.

     The <b>magic_getflags</b>() functions returns a value representing current
     <i>flags</i> set.

     The <b>magic_setflags</b>() function sets the <i>flags</i> described above.  Note
     that using both MIME flags together can also return extra information
     on the charset.

     The <b>magic_check</b>() function can be used to check the validity of entries
     in the colon separated database files passed in as <i>filename</i>, or NULL
     for the default database.  It returns 0 on success and -1 on failure.

     The <b>magic_compile</b>() function can be used to compile the colon separated
     list of database files passed in as <i>filename</i>, or NULL for the default
     database.  It returns 0 on success and -1 on failure.  The compiled
     files created are named from the basename(1) of each file argument with
     “.mgc” appended to it.

     The <b>magic_list</b>() function dumps all magic entries in a human readable
     format, dumping first the entries that are matched against binary files
     and then the ones that match text files.  It takes and optional
     <i>filename</i> argument which is a colon separated list of database files, or
     NULL for the default database.

     The <b>magic_load</b>() function must be used to load the colon separated list
     of database files passed in as <i>filename</i>, or NULL for the default data‐
     base file before any magic queries can performed.

     The default database file is named by the MAGIC environment variable.
     If that variable is not set, the default database file name is
     /usr/local/share/misc/magic.  <b>magic_load</b>() adds “.mgc” to the database
     filename as appropriate.

     The <b>magic_load_buffers</b>() function takes an array of size <i>nbuffers</i> of
     <i>buffers</i> with a respective size for each in the array of <i>sizes</i> loaded
     with the contents of the magic databases from the filesystem.  This
     function can be used in environment where the magic library does not
     have direct access to the filesystem, but can access the magic database
     via shared memory or other IPC means.

     The <b>magic_getparam</b>() and <b>magic_setparam</b>() allow getting and setting
     various limits related to the magic library.

           <b>Parameter                    Type      Default</b>
           MAGIC_PARAM_INDIR_MAX        size_t    15
           MAGIC_PARAM_NAME_MAX         size_t    30
           MAGIC_PARAM_ELF_NOTES_MAX    size_t    256
           MAGIC_PARAM_ELF_PHNUM_MAX    size_t    128
           MAGIC_PARAM_ELF_SHNUM_MAX    size_t    32768
           MAGIC_PARAM_REGEX_MAX        size_t    8192
           MAGIC_PARAM_BYTES_MAX        size_t    1048576

     The MAGIC_PARAM_INDIR_RECURSION parameter controls how many levels of
     recursion will be followed for indirect magic entries.

     The MAGIC_PARAM_NAME_RECURSION parameter controls how many levels of
     recursion will be followed for for name/use calls.

     The MAGIC_PARAM_NAME_MAX parameter controls the maximum number of calls
     for name/use.

     The MAGIC_PARAM_NOTES_MAX parameter controls how many ELF notes will be
     processed.

     The MAGIC_PARAM_PHNUM_MAX parameter controls how many ELF program sec‐
     tions will be processed.

     The MAGIC_PARAM_SHNUM_MAX parameter controls how many ELF sections will
     be processed.

     The <b>magic_version</b>() command returns the version number of this library
     which is compiled into the shared library using the constant
     MAGIC_VERSION from &lt;<i>magic.h</i>&gt;.  This can be used by client programs to
     verify that the version they compile against is the same as the version
     that they run against.
</pre>
<h2><a id="RETURN_VALUES" href="#RETURN_VALUES"></a>RETURN VALUES  &nbsp; &nbsp; &nbsp; &nbsp; <a href="#top_of_page"><span class="top-link">top</span></a></h2><pre>
     The function <b>magic_open</b>() returns a magic cookie on success and NULL on
     failure setting errno to an appropriate value.  It will set errno to
     EINVAL if an unsupported value for flags was given.  The <b>magic_list</b>(),
     <b>magic_load</b>(), <b>magic_compile</b>(), and <b>magic_check</b>() functions return 0 on
     success and -1 on failure.  The <b>magic_buffer</b>(), <b>magic_getpath</b>(), and
     <b>magic_file</b>(), functions return a string on success and NULL on failure.
     The <b>magic_error</b>() function returns a textual description of the errors
     of the above functions, or NULL if there was no error.  The
     <b>magic_version</b>() always returns the version number of the library.
     Finally, <b>magic_setflags</b>() returns -1 on systems that don't support
     utime(3), or utimes(2) when MAGIC_PRESERVE_ATIME is set.
</pre>
<h2><a id="FILES" href="#FILES"></a>FILES  &nbsp; &nbsp; &nbsp; &nbsp; <a href="#top_of_page"><span class="top-link">top</span></a></h2><pre>
     /usr/local/share/misc/magic      The non-compiled default magic data‐
                                      base.
     /usr/local/share/misc/magic.mgc  The compiled default magic database.
</pre>
<h2><a id="SEE_ALSO" href="#SEE_ALSO"></a>SEE ALSO  &nbsp; &nbsp; &nbsp; &nbsp; <a href="#top_of_page"><span class="top-link">top</span></a></h2><pre>
     file(1), magic(4)
</pre>
<h2><a id="AUTHORS" href="#AUTHORS"></a>AUTHORS  &nbsp; &nbsp; &nbsp; &nbsp; <a href="#top_of_page"><span class="top-link">top</span></a></h2><pre>
     Måns Rullgård Initial libmagic implementation, and configuration.
     Christos Zoulas API cleanup, error code and allocation handling.
</pre>
<h2><a id="COLOPHON" href="#COLOPHON"></a>COLOPHON  &nbsp; &nbsp; &nbsp; &nbsp; <a href="#top_of_page"><span class="top-link">top</span></a></h2><pre>
     This page is part of the <i>file</i> (a file type guesser) project.  Informa‐
     tion about the project can be found at <a href="http://www.darwinsys.com/file/">http://www.darwinsys.com/file/</a>.
     If you have a bug report for this manual page, see
     <a href="http://bugs.gw.com/my_view_page.php">http://bugs.gw.com/my_view_page.php</a>.  This page was obtained from the
     project's upstream Git read-only mirror of the CVS repository
     <a href="https://github.com/glensc/file">https://github.com/glensc/file</a> on 2017-07-05.  If you discover any ren‐
     dering problems in this HTML version of the page, or you believe there
     is a better or more up-to-date source for the page, or you have correc‐
     tions or improvements to the information in this COLOPHON (which is <i>not</i>
     part of the original manual page), send a mail to man-pages@man7.org

<span class="footline">BSD                             May 23, 2017                             BSD</span>
</pre>

<hr class="end-man-text" />

 
<hr class="start-footer" />

<div class="footer"> 

<table class="colophon-table">
    <tr>
    <td class="pub-info">
        <p>
            HTML rendering created 2017-07-13
            by <a href="http://man7.org/mtk/index.html">Michael Kerrisk</a>, 
            author of 
            <a href="http://man7.org/tlpi/"><em>The Linux Programming Interface</em></a>, 
            maintainer of the 
            <a href="https://www.kernel.org/doc/man-pages/">Linux <em>man-pages</em> project</a>.
        </p>
        <p>
            For details of in-depth
            <strong>Linux/UNIX system programming training courses</strong>
            that I teach, look <a href="http://man7.org/training/">here</a>.
        </p>
        <p>
            Hosting by <a href="http://www.jambit.com/index_en.html">jambit GmbH</a>.
        </p>
        <p>
            <a href="http://validator.w3.org/check?uri=referer">
            <img src="http://www.w3.org/Icons/valid-xhtml11"
                alt="Valid XHTML 1.1" height="31" width="88" />
            </a>
        </p>
    </td>
    <td class="colophon-divider">
    </td>
    <td class="tlpi-cover">
        <a href="http://man7.org/tlpi/"><img src="../../../tlpi/cover/TLPI-front-cover-vsmall.png" alt="Cover of TLPI" /></a>
    </td>
    </tr>
</table>

</div>

<hr class="end-footer" />



<!--BEGIN-SITETRACKING-->
<!-- SITETRACKING.man7.org_linux_man-pages -->

<!-- Start of StatCounter Code (xhtml) -->

<script type="text/javascript">
//<![CDATA[
var sc_project=7422636; 
var sc_invisible=1; 
var sc_security="9b6714ff"; 
//]]>
</script>
<script type="text/javascript"
src="../../../../www.statcounter.com/counter/counter_xhtml.js"></script>
<noscript><div class="statcounter"><a title="website
statistics" href="http://statcounter.com/"
class="statcounter"><img class="statcounter"
src="http://c.statcounter.com/7422636/0/9b6714ff/1/"
alt="website statistics" /></a></div></noscript>

<!-- End of StatCounter Code -->


<!-- Start of Google Analytics Code -->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-9830363-8']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<!-- End of Google Analytics Code -->

<!--END-SITETRACKING-->

</body>
</html>
